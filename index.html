<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talent Scout - AI Sourcing Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Shopify Brand Colors */
            --shopify-green: #008060;
            --shopify-green-dark: #004C3F;
            --shopify-green-light: #95BF47;
            --shopify-black: #000000;
            --shopify-white: #FFFFFF;
            
            /* Extended Palette */
            --primary: var(--shopify-green);
            --primary-dark: var(--shopify-green-dark);
            --primary-light: #00A47C;
            --secondary: #5C6AC4;
            --background: #F6F6F7;
            --surface: #FFFFFF;
            --surface-dark: #F1F2F3;
            --text-primary: #202223;
            --text-secondary: #6D7175;
            --border: #E1E3E5;
            --success: #008060;
            --warning: #B98900;
            --error: #D82C0D;
            --diversity: #9C6ADE;
            --info: #0091E2;
            
            /* Platform Colors */
            --linkedin: #0A66C2;
            --github: #24292E;
            --stackoverflow: #F48024;
            --twitter: #000000;
            --meta: #0866FF;
            --scholar: #4285F4;
            --dribbble: #EA4C89;
            --behance: #1769FF;
            --angellist: #000000;
            --kaggle: #20BEFF;
        }

        .dark-mode {
            --background: #0D1117;
            --surface: #161B22;
            --surface-dark: #21262D;
            --text-primary: #F0F6FC;
            --text-secondary: #8B949E;
            --border: #30363D;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Header */
        .header {
            background: var(--shopify-black);
            color: white;
            padding: 20px 32px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 88px;
            height: 88px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Waving animation */
        @keyframes wave {
            0%, 100% { transform: rotate(0deg); }
            10% { transform: rotate(14deg); }
            20% { transform: rotate(-8deg); }
            30% { transform: rotate(14deg); }
            40% { transform: rotate(-4deg); }
            50% { transform: rotate(10deg); }
            60% { transform: rotate(0deg); }
        }

        .logo h1 {
            font-size: 22px;
            font-weight: 700;
        }

        .logo-tagline {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-stats {
            display: flex;
            gap: 20px;
            padding-right: 20px;
            border-right: 1px solid rgba(255,255,255,0.2);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--shopify-green-light);
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dark-mode-toggle {
            background: rgba(255,255,255,0.1);
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
        }

        .dark-mode-toggle:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px;
        }

        /* Quick Templates */
        .ai-search-section {
            background: linear-gradient(135deg, rgba(92, 106, 196, 0.06) 0%, rgba(139, 92, 246, 0.06) 100%);
            border: 1px solid rgba(92, 106, 196, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }
        .ai-search-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 8px 0;
        }
        .ai-search-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0 0 16px 0;
            line-height: 1.45;
        }
        .ai-search-input-wrap {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .ai-search-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .ai-search-input {
            width: 100%;
            min-height: 80px;
            padding: 12px 14px;
            font-size: 14px;
            line-height: 1.5;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--surface);
            color: var(--text-primary);
            resize: vertical;
            font-family: inherit;
        }
        .ai-search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 128, 96, 0.15);
        }
        .ai-search-error {
            margin-top: 10px;
            font-size: 13px;
            color: var(--error, #c53030);
        }
        .ai-search-context {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }
        @media (max-width: 640px) {
            .ai-search-context { grid-template-columns: 1fr; }
        }
        .ai-search-context-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        .ai-search-context-input {
            width: 100%;
            min-height: 56px;
            padding: 8px 12px;
            font-size: 13px;
            line-height: 1.4;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--surface);
            color: var(--text-primary);
            resize: vertical;
            font-family: inherit;
        }
        .ai-search-context-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        .ai-search-context-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.8;
        }

        .templates-section {
            margin-bottom: 24px;
        }

        .templates-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 0;
        }

        .templates-header h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0;
        }

        .templates-dropdown {
            min-width: 220px;
            max-width: 320px;
            padding: 10px 14px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            appearance: auto;
        }

        .templates-dropdown:hover {
            border-color: var(--primary-light);
        }

        .templates-dropdown:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 128, 96, 0.2);
        }

        /* Platform Tabs */
        .platform-tabs {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .platform-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 13px;
            color: var(--text-primary);
        }

        .platform-tab:hover {
            border-color: var(--primary-light);
            transform: translateY(-1px);
        }

        .platform-tab.active {
            border-color: var(--primary);
            background: rgba(0, 128, 96, 0.08);
        }

        .platform-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .platform-more-wrap {
            position: relative;
        }

        .platform-more-select {
            padding: 10px 32px 10px 14px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 10px;
            font-weight: 500;
            font-size: 13px;
            color: var(--text-primary);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%238B949E' stroke-width='2'%3E%3Cpolyline points='6,9 12,15 18,9'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            min-width: 160px;
            transition: border-color 0.2s ease;
        }

        .platform-more-select:hover {
            border-color: var(--primary-light);
        }

        .platform-more-wrap.active .platform-more-select {
            border-color: var(--primary);
            background-color: rgba(0, 128, 96, 0.08);
        }


        /* Search Card */
        .search-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 28px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .search-card h2 {
            font-size: 18px;
            margin-bottom: 8px;
        }
        .search-card-tldr {
            font-size: 13px;
            color: var(--text-secondary);
            margin: 0 0 24px 0;
            line-height: 1.4;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .form-label .help-icon {
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s ease;
        }

        .form-label .help-icon:hover {
            opacity: 1;
        }

        /* Multi-select dropdown */
        select[multiple] {
            min-height: 100px;
        }

        select[multiple] option {
            padding: 8px 12px;
        }

        select[multiple] option:checked {
            background: linear-gradient(0deg, var(--primary) 0%, var(--primary) 100%);
            color: white;
        }

        .form-input, .form-select {
            padding: 12px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s ease;
            background: var(--surface);
            color: var(--text-primary);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 128, 96, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        .job-title-autocomplete-wrap {
            position: relative;
        }
        .job-title-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin: 4px 0 0;
            padding: 6px 0;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            max-height: 220px;
            overflow-y: auto;
            z-index: 50;
            list-style: none;
            display: none;
        }
        .job-title-dropdown.show {
            display: block;
        }
        .job-title-dropdown li {
            padding: 10px 14px;
            font-size: 13px;
            color: var(--text-primary);
            cursor: pointer;
        }
        .job-title-dropdown li:hover,
        .job-title-dropdown li[aria-selected="true"] {
            background: var(--surface-dark);
        }

        .skills-autocomplete-wrap { position: relative; }
        .skills-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin: 4px 0 0;
            padding: 6px 0;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            max-height: 220px;
            overflow-y: auto;
            z-index: 50;
            list-style: none;
            display: none;
        }
        .skills-dropdown.show { display: block; }
        .skills-dropdown li {
            padding: 10px 14px;
            font-size: 13px;
            color: var(--text-primary);
            cursor: pointer;
        }
        .skills-dropdown li:hover,
        .skills-dropdown li[aria-selected="true"] { background: var(--surface-dark); }

        /* Company Targeting Section */
        .company-targeting-section {
            background: linear-gradient(135deg, rgba(0, 128, 96, 0.05) 0%, rgba(149, 191, 71, 0.05) 100%);
            border: 1px solid rgba(0, 128, 96, 0.2);
            border-radius: 10px;
            padding: 16px;
            margin-top: 20px;
        }

        .company-targeting-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .company-targeting-header h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .company-ai-block {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .company-ai-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.45;
        }

        .company-ai-prompt-wrap {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .company-ai-prompt-wrap textarea {
            flex: 1;
            min-height: 72px;
            padding: 10px 12px;
            font-size: 13px;
            font-family: inherit;
            border: 1px solid var(--border);
            border-radius: 8px;
            resize: vertical;
            background: var(--surface);
            color: var(--text-primary);
        }

        .company-ai-prompt-wrap textarea::placeholder {
            color: var(--text-secondary);
        }

        .company-ai-prompt-wrap textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 128, 96, 0.15);
        }

        .company-ai-results-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            margin-top: 12px;
        }

        .company-ai-results-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .company-ai-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 12px;
            color: var(--text-primary);
        }

        .company-ai-chip .add-company-btn {
            padding: 2px 8px;
            font-size: 11px;
            border-radius: 4px;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .company-ai-chip .add-company-btn:hover {
            background: var(--primary-dark);
        }

        /* Tech stack hover tooltip on company chips */
        .company-ai-chip.chip-with-tech {
            position: relative;
            cursor: default;
        }
        .company-ai-chip .chip-tech-tooltip {
            position: absolute;
            bottom: 100%;
            left: 0;
            margin-bottom: 6px;
            padding: 8px 10px;
            background: #1e293b;
            color: #e2e8f0;
            font-size: 11px;
            line-height: 1.4;
            border-radius: 6px;
            white-space: normal;
            max-width: 220px;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.15s ease, visibility 0.15s ease;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        }
        .company-ai-chip .chip-tech-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 12px;
            border: 5px solid transparent;
            border-top-color: #1e293b;
        }
        .company-ai-chip:hover .chip-tech-tooltip {
            opacity: 1;
            visibility: visible;
        }
        .company-ai-chip .chip-tech-tooltip strong {
            display: block;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-bottom: 4px;
            color: #94a3b8;
        }

        .company-list-or {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-style: italic;
        }

        .toast-message {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 18px;
            background: var(--text-primary);
            color: var(--background);
            font-size: 13px;
            font-weight: 500;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }
        .toast-message.show {
            opacity: 1;
            visibility: visible;
        }

        .company-list-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }

        .education-experience-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            margin-bottom: 12px;
        }
        .education-experience-header:hover .form-label { color: var(--primary); }
        .education-experience-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .education-experience-grid .form-label { font-size: 12px; }

        .company-list-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .company-list-card:hover {
            border-color: var(--primary);
        }

        .company-list-card.selected {
            border-color: var(--primary);
            background: rgba(0, 128, 96, 0.08);
        }

        .company-list-card h5 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .company-list-card p {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .selected-companies {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .company-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: var(--primary);
            color: white;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .company-chip .remove {
            cursor: pointer;
            opacity: 0.8;
        }

        .company-chip .remove:hover {
            opacity: 1;
        }

        /* GitHub Filters */
        .github-filters {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .github-filter-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
        }

        .github-filter-option:hover {
            border-color: var(--github);
        }

        .github-filter-option input[type="checkbox"] {
            accent-color: var(--github);
            width: 16px;
            height: 16px;
        }

        .github-filter-option input[type="checkbox"]:checked + span {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Seniority Chips */
        .seniority-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .seniority-chip {
            padding: 8px 14px;
            border: 1px solid var(--border);
            border-radius: 20px;
            background: var(--surface);
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .seniority-chip:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .seniority-chip.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Candidate Signals Section */
        .signals-section {
            background: linear-gradient(135deg, rgba(0, 145, 226, 0.08) 0%, rgba(0, 128, 96, 0.08) 100%);
            border: 1px solid rgba(0, 145, 226, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .signals-header {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .signals-header h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--info);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .signals-badge {
            background: var(--info);
            color: white;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 600;
        }

        .signals-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            margin-top: 12px;
        }

        .signals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
        }

        .signal-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .signal-option:hover {
            border-color: var(--info);
        }

        .signal-option.selected {
            border-color: var(--info);
            background: rgba(0, 145, 226, 0.1);
        }

        .signal-checkbox {
            margin-top: 2px;
            accent-color: var(--info);
        }

        .signal-option-content h5 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .signal-option-content p {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Diversity Section */
        .diversity-section {
            background: linear-gradient(135deg, rgba(156, 106, 222, 0.08) 0%, rgba(92, 106, 196, 0.08) 100%);
            border: 1px solid rgba(156, 106, 222, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .diversity-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            cursor: pointer;
        }

        .diversity-header h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--diversity);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .diversity-badge {
            background: var(--diversity);
            color: white;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 600;
        }

        /* Find similar candidates — yellow accent (distinct from diversity) */
        .profile-similar-section-wrap {
            background: linear-gradient(135deg, rgba(185, 137, 0, 0.08) 0%, rgba(255, 183, 0, 0.06) 100%);
            border: 1px solid rgba(185, 137, 0, 0.35);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .profile-similar-section-wrap .diversity-header h4 {
            color: var(--warning);
        }
        .profile-similar-section-wrap .diversity-header:hover h4 {
            color: #8B6914;
        }

        /* Similar tech stack — teal accent */
        .tech-stack-section-wrap {
            background: linear-gradient(135deg, rgba(0, 128, 128, 0.08) 0%, rgba(0, 145, 140, 0.06) 100%);
            border: 1px solid rgba(0, 128, 128, 0.35);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .tech-stack-section-wrap .diversity-header h4 {
            color: #0d7377;
        }
        .tech-stack-section-wrap .diversity-header:hover h4 {
            color: #0a5c5f;
        }

        /* Keywords from intake form — amber/orange accent */
        .intake-section-wrap {
            background: linear-gradient(135deg, rgba(217, 119, 6, 0.08) 0%, rgba(234, 88, 12, 0.06) 100%);
            border: 1px solid rgba(217, 119, 6, 0.35);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .intake-section-wrap .diversity-header h4 {
            color: #b45309;
        }
        .intake-section-wrap .diversity-header:hover h4 {
            color: #92400e;
        }

        /* Find similar portfolios — violet accent */
        .portfolio-section-wrap {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.08) 0%, rgba(139, 92, 246, 0.06) 100%);
            border: 1px solid rgba(124, 58, 237, 0.35);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .portfolio-section-wrap .diversity-header h4 {
            color: #6d28d9;
        }
        .portfolio-section-wrap .diversity-header:hover h4 {
            color: #5b21b6;
        }

        .diversity-description {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .diversity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .diversity-option {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: var(--surface);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .diversity-option:hover {
            border-color: var(--diversity);
        }

        .diversity-option.selected {
            border-color: var(--diversity);
            background: rgba(156, 106, 222, 0.1);
        }

        .diversity-option input {
            margin-top: 2px;
            accent-color: var(--diversity);
        }

        .diversity-option-content h5 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .diversity-option-content p {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Find similar to profile */
        .profile-similar-section {
            background: linear-gradient(135deg, rgba(92, 106, 196, 0.08) 0%, rgba(0, 145, 226, 0.08) 100%);
            border: 1px solid rgba(92, 106, 196, 0.25);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .profile-similar-section h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-similar-desc {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.45;
        }

        .profile-paste-wrap {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .profile-paste-wrap textarea {
            flex: 1;
            min-height: 100px;
            padding: 12px;
            font-size: 13px;
            font-family: inherit;
            border: 1px solid var(--border);
            border-radius: 8px;
            resize: vertical;
            background: var(--surface);
            color: var(--text-primary);
        }

        .profile-paste-wrap textarea::placeholder {
            color: var(--text-secondary);
        }

        .profile-result-block {
            margin-top: 16px;
            padding: 14px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 13px;
        }

        .profile-result-block .profile-feedback {
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: 10px;
        }

        .profile-result-block .profile-suggestions {
            margin: 10px 0;
        }

        .profile-result-block .profile-query-wrap {
            margin-top: 12px;
        }

        .profile-result-block .profile-query-wrap label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
        }

        .profile-result-block .profile-query-text {
            display: block;
            margin-top: 4px;
            padding: 8px;
            background: var(--background);
            border-radius: 6px;
            font-size: 12px;
            word-break: break-word;
        }

        .profile-result-actions {
            margin-top: 12px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .profile-input-row {
            margin-bottom: 12px;
        }

        .profile-input-row label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .profile-input-row input[type="text"],
        .profile-input-row input[type="url"] {
            width: 100%;
            max-width: 480px;
            padding: 8px 12px;
            font-size: 13px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--surface);
            color: var(--text-primary);
        }

        .profile-upload-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .profile-upload-row input[type="file"] {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .profile-upload-row .upload-hint {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Toggle Switch */
        .toggle-group {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
        }

        .toggle {
            position: relative;
            width: 44px;
            height: 24px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .toggle input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        .toggle input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* Chips/Tags */
        .chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(0, 128, 96, 0.1);
            border-radius: 16px;
            font-size: 13px;
            font-weight: 500;
            color: var(--primary-dark);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .chip:hover {
            background: rgba(0, 128, 96, 0.2);
        }

        .chip.selected {
            background: var(--primary);
            color: white;
        }

        .chip .remove {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(0,0,0,0.1);
            font-size: 12px;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            background: rgba(0, 128, 96, 0.05);
        }

        .btn-ai {
            background: linear-gradient(135deg, #5C6AC4 0%, #8B5CF6 100%);
            color: white;
        }

        .btn-ai:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(92, 106, 196, 0.4);
        }

        .btn-small {
            padding: 8px 14px;
            font-size: 12px;
        }

        /* Results Section */
        .results-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 12px;
        }

        .results-header h3 {
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .results-actions {
            display: flex;
            gap: 8px;
        }

        .query-display {
            background: var(--surface-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-primary);
            word-break: break-all;
            position: relative;
        }

        .query-display .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 6px 10px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s ease;
            color: var(--text-primary);
        }

        .query-display .copy-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .query-display .copy-btn.copied {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .query-textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            padding-right: 80px;
            margin-top: 8px;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            resize: vertical;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .query-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 128, 96, 0.1);
        }

        .query-textarea:hover {
            border-color: var(--primary-light);
        }

        .query-edit-hint {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .query-edit-hint svg {
            opacity: 0.7;
        }

        /* AI Optimize Section */
        .ai-optimize-section {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .ai-optimize-hint {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .ai-optimized-result {
            margin-top: 16px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(92, 106, 196, 0.08) 0%, rgba(139, 92, 246, 0.08) 100%);
            border: 1px solid rgba(92, 106, 196, 0.2);
            border-radius: 10px;
        }

        .ai-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .ai-result-header h4 {
            font-size: 14px;
            font-weight: 600;
            color: #5C6AC4;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
        }

        .ai-optimized-query {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 12px;
            line-height: 1.5;
            word-break: break-word;
            margin-bottom: 12px;
        }

        .ai-explanation {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .ai-explanation strong {
            color: var(--text-primary);
        }

        .btn-ai.loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .btn-ai.loading svg {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Suggestions Panel */
        .suggestions-panel {
            background: linear-gradient(135deg, rgba(92, 106, 196, 0.08) 0%, rgba(139, 92, 246, 0.08) 100%);
            border: 1px solid rgba(92, 106, 196, 0.2);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .suggestions-panel h4 {
            font-size: 13px;
            color: #5C6AC4;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .suggestion-section {
            margin-bottom: 14px;
        }
        .suggestion-section:last-child { margin-bottom: 0; }
        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .suggestion-chip {
            padding: 6px 12px;
            background: var(--surface);
            border: 1px solid rgba(92, 106, 196, 0.3);
            border-radius: 16px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #5C6AC4;
        }

        .suggestion-chip:hover {
            background: #5C6AC4;
            color: white;
            border-color: #5C6AC4;
        }

        /* Email Generator */
        .email-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .email-section h3 {
            font-size: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Top Candidates Section */
        .candidates-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }
        .candidates-section.hidden { display: none; }
        .candidates-section h3 {
            font-size: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .candidates-count {
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }
        .candidates-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .candidates-table-wrap {
            overflow-x: auto;
            border: 1px solid var(--border);
            border-radius: 8px;
        }
        .candidates-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .candidates-table th {
            text-align: left;
            padding: 10px 12px;
            background: var(--surface-dark);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            color: var(--text-primary);
        }
        .candidates-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
        }
        .candidates-table tr:last-child td { border-bottom: none; }
        .candidates-table tr:hover { background: rgba(0, 128, 96, 0.04); }
        .candidates-table a { color: var(--primary); text-decoration: none; }
        .candidates-table a:hover { text-decoration: underline; }
        .candidate-score {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 12px;
        }
        .candidate-score.high { background: rgba(0, 128, 96, 0.15); color: var(--success); }
        .candidate-score.mid { background: rgba(92, 106, 196, 0.15); color: var(--secondary); }
        .candidate-score.low { background: var(--surface-dark); color: var(--text-secondary); }

        .email-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .tone-btn {
            padding: 8px 16px;
            background: var(--surface-dark);
            border: 1px solid var(--border);
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            color: var(--text-primary);
        }

        .tone-btn:hover {
            border-color: var(--primary);
        }

        .tone-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .tone-btn.ai-tone {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tone-btn.ai-tone:hover {
            background: linear-gradient(135deg, #5a6fd6 0%, #6a4190 100%);
            transform: translateY(-1px);
        }

        .ai-email-options {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .ai-email-options.hidden {
            display: none;
        }

        .ai-email-options .form-label {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 12px;
            display: block;
        }

        .ai-email-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        @media (max-width: 768px) {
            .ai-email-inputs {
                grid-template-columns: 1fr;
            }
        }

        .ai-email-options .btn-ai {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .ai-email-options .btn-ai:hover {
            background: linear-gradient(135deg, #5a6fd6 0%, #6a4190 100%);
        }

        .ai-email-options .btn-ai.loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .email-template {
            background: var(--surface-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            font-size: 14px;
            line-height: 1.8;
            white-space: pre-wrap;
            position: relative;
        }

        .email-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        /* Boolean Cheat Sheet */
        .cheatsheet-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .cheatsheet-section h3 {
            font-size: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .cheatsheet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .cheatsheet-item {
            background: var(--surface-dark);
            border-radius: 8px;
            padding: 14px;
        }

        .cheatsheet-item code {
            display: block;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            color: var(--primary);
            margin-bottom: 6px;
        }

        .cheatsheet-item p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Saved Searches */
        .saved-searches {
            background: var(--surface);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .saved-searches h3 {
            font-size: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .saved-search-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            background: var(--surface-dark);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .saved-search-item:hover {
            border-color: var(--primary);
            background: rgba(0, 128, 96, 0.05);
        }

        .saved-search-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .saved-search-platform {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: var(--surface);
        }

        .saved-search-text {
            font-size: 14px;
            font-weight: 500;
        }

        .saved-search-delete {
            padding: 6px 8px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .saved-search-delete:hover {
            background: rgba(216, 44, 13, 0.1);
            color: var(--error);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--surface);
            border-radius: 16px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.visible .modal {
            transform: scale(1);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--shopify-green) 0%, var(--shopify-green-dark) 100%);
            color: white;
            padding: 24px 28px;
            border-radius: 16px 16px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header-content {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .modal-header img {
            width: 80px;
            height: 80px;
            border-radius: 14px;
        }

        .modal-overlay.visible .modal-header img {
            animation: wave 1.5s ease-in-out;
            transform-origin: 70% 70%;
        }

        .modal-header h2 {
            font-size: 22px;
            font-weight: 700;
        }

        .modal-header p {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            transition: background 0.2s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal-body {
            padding: 28px;
        }

        .guide-divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 20px 0;
            color: var(--text-secondary);
            font-size: 12px;
        }

        .guide-divider::before,
        .guide-divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--border);
        }

        .guide-divider span {
            padding: 0 12px;
        }

        /* Boolean Section in Guide */
        .guide-boolean-section {
            background: linear-gradient(135deg, rgba(216, 44, 13, 0.05) 0%, rgba(255, 184, 0, 0.05) 100%);
            border: 1px solid rgba(216, 44, 13, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 8px;
        }

        .guide-boolean-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .guide-boolean-header h4 {
            font-size: 16px;
            font-weight: 700;
            color: #D82C0D;
            margin: 0;
        }

        .guide-boolean-intro {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .guide-boolean-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .guide-boolean-item {
            background: var(--surface);
            border-radius: 8px;
            padding: 10px 12px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .guide-boolean-item code {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
        }

        .guide-boolean-item span {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .guide-boolean-example {
            background: var(--surface);
            border-radius: 8px;
            padding: 12px;
            font-size: 12px;
        }

        .guide-boolean-example strong {
            color: var(--text-primary);
        }

        .guide-boolean-example code {
            display: block;
            margin-top: 6px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 11px;
            color: var(--text-secondary);
            word-break: break-all;
        }

        @media (max-width: 500px) {
            .guide-boolean-grid {
                grid-template-columns: 1fr;
            }
        }

        .guide-step {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .guide-step:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .step-number {
            width: 36px;
            height: 36px;
            background: var(--shopify-green);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }

        .step-content h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .step-content p {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .step-content .tip {
            background: rgba(0, 128, 96, 0.08);
            border-left: 3px solid var(--shopify-green);
            padding: 10px 14px;
            margin-top: 10px;
            border-radius: 0 8px 8px 0;
            font-size: 13px;
            color: var(--primary-dark);
        }

        .guide-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .guide-feature {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--surface-dark);
            border-radius: 10px;
        }

        .guide-feature-icon {
            font-size: 20px;
        }

        .guide-feature-text {
            font-size: 13px;
            font-weight: 500;
        }

        .modal-footer {
            padding: 20px 28px;
            background: var(--surface-dark);
            border-radius: 0 0 16px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }

        .modal-footer-text {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .modal-footer .btn {
            min-width: 140px;
            justify-content: center;
        }

        .dont-show-again {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .dont-show-again input {
            accent-color: var(--shopify-green);
        }

        .logo-icon {
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .logo-icon:hover {
            transform: scale(1.05);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 32px;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .footer a {
            color: var(--primary);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Hidden */
        .hidden {
            display: none !important;
        }

        /* Collapsible */
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.open {
            max-height: 2000px;
        }

        .collapse-icon {
            transition: transform 0.3s ease;
        }

        .collapse-icon.open {
            transform: rotate(180deg);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 16px;
            }

            .header-stats {
                border-right: none;
                padding-right: 0;
                border-bottom: 1px solid rgba(255,255,255,0.2);
                padding-bottom: 16px;
            }

            .main-container {
                padding: 20px;
            }

            .search-card {
                padding: 20px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                justify-content: center;
            }

            .results-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .results-actions {
                width: 100%;
            }

            .results-actions .btn {
                flex: 1;
            }

            .platform-tabs {
                gap: 6px;
            }

            .platform-tab {
                padding: 8px 12px;
                font-size: 12px;
            }
        }
    </style>
    <!-- Quick Client for Database -->
    <script src="/client/quick.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon" onclick="showGuide()" title="Click for How to Use Guide">
                    <img src="logo.png" alt="Talent Scout Logo">
                </div>
                <div>
                    <h1>Talent Scout</h1>
                    <div class="logo-tagline">Your powerful sourcing tool</div>
                </div>
            </div>
            <div class="header-actions">
                <div class="header-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="searchCount">0</div>
                        <div class="stat-label">Searches</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="savedCount">0</div>
                        <div class="stat-label">Saved</div>
                    </div>
                </div>
                <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle dark mode">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="darkModeIcon">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
                <button class="dark-mode-toggle" onclick="window.location.reload()" title="Refresh page">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23,4 23,10 17,10"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <main class="main-container">
        <!-- Quick Templates -->
        <div class="templates-section">
            <div class="templates-header">
                <h3>Quick Templates</h3>
                <select class="templates-dropdown" id="quickTemplatesSelect" onchange="onTemplateSelect(this)">
                    <option value="">Choose a role template...</option>
                    <option value="software-engineer">👩‍💻 Software Engineer</option>
                    <option value="product-manager">📊 Product Manager</option>
                    <option value="designer">🎨 Designer</option>
                    <option value="data-scientist">🔬 Data Scientist</option>
                    <option value="engineering-manager">👔 Engineering Manager</option>
                    <option value="devops">☁️ DevOps / SRE</option>
                    <option value="data-engineer">🔧 Data Engineer</option>
                </select>
            </div>
        </div>

        <!-- Platform Selection: 4 primary tabs + More dropdown -->
        <div class="platform-tabs">
            <button class="platform-tab linkedin active" data-platform="linkedin">
                <div class="platform-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="#0A66C2">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                </div>
                LinkedIn
            </button>
            <button class="platform-tab github" data-platform="github">
                <div class="platform-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="#24292E">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                </div>
                GitHub
            </button>
            <button class="platform-tab twitter" data-platform="twitter">
                <div class="platform-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="#000000">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </div>
                X
            </button>
            <button class="platform-tab kaggle" data-platform="kaggle">
                <div class="platform-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="#20BEFF">
                        <path d="M18.825 23.859c-.022.092-.117.141-.281.141h-3.139c-.187 0-.351-.082-.492-.248l-5.178-6.589-1.448 1.374v5.111c0 .235-.117.352-.351.352H5.505c-.236 0-.354-.117-.354-.352V.353c0-.233.118-.353.354-.353h2.431c.234 0 .351.12.351.353v14.343l6.203-6.272c.165-.165.33-.246.495-.246h3.239c.144 0 .236.06.285.18.046.149.034.255-.036.315l-6.555 6.344 6.836 8.507c.095.104.117.208.071.312"/>
                    </svg>
                </div>
                Kaggle
            </button>
            <div class="platform-more-wrap" id="platformMoreWrap">
                <select class="platform-more-select" id="platformMoreSelect" title="More platforms">
                    <option value="">More platforms</option>
                    <option value="reddit">Reddit</option>
                    <option value="stackoverflow">Stack Overflow</option>
                    <option value="scholar">Google Scholar</option>
                    <option value="dribbble">Dribbble</option>
                    <option value="behance">Behance</option>
                    <option value="wellfound">Wellfound</option>
                    <option value="substack">Substack</option>
                    <option value="devto">Dev.to</option>
                    <option value="producthunt">Product Hunt</option>
                    <option value="polywork">Polywork</option>
                    <option value="bluesky">Bluesky</option>
                    <option value="quora">Quora</option>
                    <option value="speakerdeck">Speaker Deck</option>
                    <option value="gitlab">GitLab</option>
                    <option value="bitbucket">Bitbucket</option>
                    <option value="codepen">CodePen</option>
                    <option value="stackexchange">Stack Exchange</option>
                    <option value="hackernews">Hacker News</option>
                    <option value="hashnode">Hashnode</option>
                    <option value="hired">Hired</option>
                    <option value="dice">Dice</option>
                    <option value="indeed">Indeed</option>
                    <option value="glassdoor">Glassdoor</option>
                    <option value="levelsfyi">Levels.fyi</option>
                    <option value="otta">Otta</option>
                    <option value="indiehackers">Indie Hackers</option>
                    <option value="meetup">Meetup</option>
                    <option value="eventbrite">Eventbrite</option>
                    <option value="twitch">Twitch</option>
                    <option value="youtube">YouTube</option>
                    <option value="mastodon">Mastodon</option>
                    <option value="leetcode">LeetCode</option>
                    <option value="hackerrank">HackerRank</option>
                    <option value="womenwhocode">Women Who Code</option>
                    <option value="sourceforge">SourceForge</option>
                </select>
            </div>
        </div>

        <!-- AI Search: describe who you're looking for (below platform tabs) -->
        <div class="ai-search-section" id="aiSearchSection">
            <div class="ai-search-header">
                <h3>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#5C6AC4" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                    Describe who you're looking for
                </h3>
                <p class="ai-search-description">Tell us in plain language (e.g. “Senior data scientist from Meta in the Bay Area”) and we’ll fill in the search fields for you.</p>
            </div>
            <div class="ai-search-input-wrap">
                <textarea id="aiSearchInput" class="ai-search-input" placeholder="e.g., I'm looking for a senior data scientist who worked at Meta in the Bay Area, or a product designer with fintech experience in Toronto..." rows="3"></textarea>
                <div class="ai-search-context">
                    <div>
                        <div class="ai-search-context-label">📋 Intake notes (optional)</div>
                        <textarea id="aiSearchIntakeNotes" class="ai-search-context-input" placeholder="Paste intake call notes, must-haves, nice-to-haves..." rows="2"></textarea>
                    </div>
                    <div>
                        <div class="ai-search-context-label">🏢 Team context (optional)</div>
                        <textarea id="aiSearchTeamContext" class="ai-search-context-input" placeholder="Current team members, seniority, or other context..." rows="2"></textarea>
                    </div>
                </div>
                <div class="ai-search-buttons">
                    <button type="button" class="btn btn-primary" id="aiSearchBtn" onclick="fillSearchFromDescription()">
                        <span id="aiSearchBtnText">Fill search from description</span>
                        <span id="aiSearchBtnLoading" class="hidden">Filling search...</span>
                    </button>
                    <button type="button" class="btn btn-secondary" id="aiCandidatesBtn" onclick="generateTopCandidates()">
                        <span id="aiCandidatesBtnText">Generate top candidates</span>
                        <span id="aiCandidatesBtnLoading" class="hidden">Generating...</span>
                    </button>
                </div>
            </div>
            <div id="aiSearchError" class="ai-search-error hidden"></div>
        </div>

        <!-- Search Form -->
        <div class="search-card" id="searchCard">
            <h2>
                <span id="platform-title-icon">🔍</span>
                <span id="platform-title">Search LinkedIn Profiles</span>
            </h2>
            <p class="search-card-tldr">Start typing in any field to see suggestions—click one to add it to your search.</p>

            <div class="form-grid">
                <!-- Job Title -->
                <div class="form-group">
                    <label class="form-label">
                        Job Title / Role
                        <span class="help-icon" onclick="showFieldHelp('jobTitle')" title="Click for tips">ℹ️</span>
                    </label>
                    <div class="job-title-autocomplete-wrap">
                        <input type="text" class="form-input" id="jobTitle" placeholder="e.g., Software Engineer, Product Manager" autocomplete="off" oninput="onJobTitleInput()" onfocus="onJobTitleFocus()" onkeydown="onJobTitleKeydown(event)">
                        <ul class="job-title-dropdown" id="jobTitleDropdown" role="listbox"></ul>
                    </div>
                </div>

                <!-- Seniority Level -->
                <div class="form-group">
                    <label class="form-label">
                        Seniority Level
                        <span class="help-icon" onclick="showFieldHelp('seniority')" title="Click for tips">ℹ️</span>
                    </label>
                    <div class="seniority-chips" id="seniorityChips">
                        <button type="button" class="seniority-chip" data-level="entry" onclick="toggleSeniority(this)">Entry/Junior</button>
                        <button type="button" class="seniority-chip" data-level="mid" onclick="toggleSeniority(this)">Mid-Level</button>
                        <button type="button" class="seniority-chip selected" data-level="senior" onclick="toggleSeniority(this)">Senior</button>
                        <button type="button" class="seniority-chip" data-level="staff" onclick="toggleSeniority(this)">Staff</button>
                        <button type="button" class="seniority-chip" data-level="principal" onclick="toggleSeniority(this)">Principal</button>
                        <button type="button" class="seniority-chip" data-level="director" onclick="toggleSeniority(this)">Director+</button>
                    </div>
                </div>

                <!-- Location -->
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <div class="skills-autocomplete-wrap" data-ac-field="location">
                        <input type="text" class="form-input" id="locationInput" placeholder="e.g., San Francisco, Toronto, Remote" autocomplete="off" oninput="onAcInput('location')" onfocus="onAcFocus('location')" onkeydown="onAcKeydown('location', event)">
                        <ul class="skills-dropdown" id="locationDropdown" role="listbox"></ul>
                    </div>
                </div>

                <!-- Country (All Platforms) -->
                <div class="form-group">
                    <label class="form-label">Country (Ctrl/Cmd+click for multiple)</label>
                    <select class="form-select" id="country" multiple size="4">
                        <option value="ca" selected>🇨🇦 Canada</option>
                        <option value="us">🇺🇸 United States</option>
                        <option value="uk">🇬🇧 United Kingdom</option>
                        <option value="de">🇩🇪 Germany</option>
                        <option value="fr">🇫🇷 France</option>
                        <option value="au">🇦🇺 Australia</option>
                        <option value="in">🇮🇳 India</option>
                        <option value="sg">🇸🇬 Singapore</option>
                        <option value="nl">🇳🇱 Netherlands</option>
                        <option value="ie">🇮🇪 Ireland</option>
                    </select>
                </div>

                <!-- Current Employer -->
                <div class="form-group linkedin-field reddit-field wellfound-field substack-field devto-field producthunt-field polywork-field bluesky-field quora-field speakerdeck-field gitlab-field bitbucket-field codepen-field stackexchange-field hackernews-field hashnode-field hired-field dice-field indeed-field glassdoor-field levelsfyi-field otta-field indiehackers-field meetup-field eventbrite-field twitch-field youtube-field mastodon-field leetcode-field hackerrank-field womenwhocode-field sourceforge-field">
                    <label class="form-label">Current Company</label>
                    <div class="skills-autocomplete-wrap" data-ac-field="currentEmployer">
                        <input type="text" class="form-input" id="currentEmployerInput" placeholder="e.g., Google, Shopify, Meta" autocomplete="off" oninput="onAcInput('currentEmployer')" onfocus="onAcFocus('currentEmployer')" onkeydown="onAcKeydown('currentEmployer', event)">
                        <ul class="skills-dropdown" id="currentEmployerDropdown" role="listbox"></ul>
                    </div>
                </div>

                <!-- Skills and Assessments (LinkedIn) -->
                <div class="form-group linkedin-field hidden">
                    <label class="form-label">Skills and assessments</label>
                    <div class="skills-autocomplete-wrap">
                        <input type="text" class="form-input" id="linkedinSkillsInput" placeholder="e.g., Python, Leadership, Project Management, AWS" autocomplete="off" oninput="onSkillsInput()" onfocus="onSkillsFocus()" onkeydown="onSkillsKeydown(event)">
                        <ul class="skills-dropdown" id="skillsDropdown" role="listbox"></ul>
                    </div>
                </div>

                <!-- Qualifications (LinkedIn) -->
                <div class="form-group linkedin-field hidden">
                    <label class="form-label">Qualifications</label>
                    <div class="skills-autocomplete-wrap" data-ac-field="qualifications">
                        <input type="text" class="form-input" id="qualificationsInput" placeholder="e.g., PMP, CPA, CFA, Google Cloud certified" autocomplete="off" oninput="onAcInput('qualifications')" onfocus="onAcFocus('qualifications')" onkeydown="onAcKeydown('qualifications', event)">
                        <ul class="skills-dropdown" id="qualificationsDropdown" role="listbox"></ul>
                    </div>
                </div>

                <!-- Skills (GitHub/Kaggle) -->
                <div class="form-group github-field kaggle-field hidden">
                    <label class="form-label">Programming Languages / Skills</label>
                    <input type="text" class="form-input" id="skills" placeholder="e.g., Python, React, Kubernetes">
                </div>

                <!-- GitHub-specific: Hireable Filter -->
                <div class="form-group github-field hidden">
                    <label class="form-label">GitHub Profile Filters</label>
                    <div class="github-filters">
                        <label class="github-filter-option">
                            <input type="checkbox" id="githubHireable" checked>
                            <span>🟢 Hireable (has "available for hire" enabled)</span>
                        </label>
                        <label class="github-filter-option">
                            <input type="checkbox" id="githubActiveContributor">
                            <span>📊 Active (10+ repos, 5+ followers)</span>
                        </label>
                    </div>
                </div>

                <!-- Research Area (Scholar) -->
                <div class="form-group scholar-field hidden">
                    <label class="form-label">Research Area / Field</label>
                    <input type="text" class="form-input" id="researchArea" placeholder="e.g., machine learning, NLP, computer vision">
                </div>

                <!-- Design Style (Dribbble/Behance) -->
                <div class="form-group dribbble-field behance-field hidden">
                    <label class="form-label">Design Specialty</label>
                    <input type="text" class="form-input" id="designStyle" placeholder="e.g., UI design, branding, illustration">
                </div>

                <!-- Tags (Stack Overflow) -->
                <div class="form-group stackoverflow-field hidden">
                    <label class="form-label">Technology Tags</label>
                    <input type="text" class="form-input" id="soTags" placeholder="e.g., python, javascript, aws">
                </div>

                <!-- Bio keywords (Twitter) -->
                <div class="form-group twitter-field hidden">
                    <label class="form-label">Bio Keywords</label>
                    <input type="text" class="form-input" id="bioKeywords" placeholder="e.g., engineer, developer, hiring">
                </div>

                <!-- Keywords to Include -->
                <div class="form-group">
                    <label class="form-label">Keywords to Include</label>
                    <div class="skills-autocomplete-wrap" data-ac-field="includeKeywords">
                        <input type="text" class="form-input" id="includeKeywordsInput" placeholder="e.g., machine learning, fintech, SaaS" autocomplete="off" oninput="onAcInput('includeKeywords'); updateSearchTips();" onfocus="onAcFocus('includeKeywords')" onkeydown="onAcKeydown('includeKeywords', event)">
                        <ul class="skills-dropdown" id="includeKeywordsDropdown" role="listbox"></ul>
                    </div>
                </div>

                <!-- Keywords to Exclude -->
                <div class="form-group">
                    <label class="form-label">Keywords to Exclude</label>
                    <div class="skills-autocomplete-wrap" data-ac-field="excludeKeywords">
                        <input type="text" class="form-input" id="excludeKeywordsInput" placeholder="e.g., recruiter, HR, sales" autocomplete="off" oninput="onAcInput('excludeKeywords'); updateSearchTips();" onfocus="onAcFocus('excludeKeywords')" onkeydown="onAcKeydown('excludeKeywords', event)">
                        <ul class="skills-dropdown" id="excludeKeywordsDropdown" role="listbox"></ul>
                    </div>
                </div>

                <!-- Experience (LinkedIn) -->
                <div class="form-group linkedin-field hidden" id="experienceWrap">
                    <div class="education-experience-header" onclick="toggleExperience()">
                        <label class="form-label" style="margin-bottom: 0;">Experience</label>
                        <svg class="collapse-icon" id="experienceIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6,9 12,15 18,9"/></svg>
                    </div>
                    <div class="collapsible-content" id="experienceContent">
                        <div class="education-experience-grid">
                            <div class="form-group">
                                <label class="form-label">Years in current position</label>
                                <input type="text" class="form-input" id="yearsCurrentPosition" placeholder="e.g., 1+, 2-5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Years of experience</label>
                                <input type="text" class="form-input" id="yearsExperience" placeholder="e.g., 5+, 3-7">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Years in current company</label>
                                <input type="text" class="form-input" id="yearsCurrentCompany" placeholder="e.g., 2+, 1-4">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Industry</label>
                                <input type="text" class="form-input" id="industries" placeholder="e.g., Technology, Retail, Finance">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Education (LinkedIn) -->
                <div class="form-group linkedin-field hidden" id="educationWrap">
                    <div class="education-experience-header" onclick="toggleEducation()">
                        <label class="form-label" style="margin-bottom: 0;">Education</label>
                        <svg class="collapse-icon" id="educationIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6,9 12,15 18,9"/></svg>
                    </div>
                    <div class="collapsible-content" id="educationContent">
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label class="form-label">Education level</label>
                            <div class="skills-autocomplete-wrap" data-ac-field="education">
                                <input type="text" class="form-input" id="educationInput" placeholder="e.g., Bachelor's, Master's, PhD" autocomplete="off" oninput="onAcInput('education')" onfocus="onAcFocus('education')" onkeydown="onAcKeydown('education', event)">
                                <ul class="skills-dropdown" id="educationDropdown" role="listbox"></ul>
                            </div>
                        </div>
                        <div id="selectedEducationContainer" class="hidden" style="margin-bottom: 12px;">
                            <label class="form-label" style="margin-bottom: 8px;">Selected education:</label>
                            <div class="chips-container" id="selectedEducationChips"></div>
                        </div>
                        <div class="education-experience-grid">
                            <div class="form-group">
                                <label class="form-label">Field of study</label>
                                <input type="text" class="form-input" id="fieldsOfStudy" placeholder="e.g., Computer Science, Business">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Year of graduation</label>
                                <input type="text" class="form-input" id="graduationYear" placeholder="e.g., 2015-2020, 2022+">
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label class="form-label">Schools</label>
                                <input type="text" class="form-input" id="schools" placeholder="e.g., University of Toronto, MIT">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Similar Roles Toggle -->
                <div class="form-group linkedin-field reddit-field wellfound-field substack-field devto-field producthunt-field polywork-field bluesky-field quora-field speakerdeck-field gitlab-field bitbucket-field codepen-field stackexchange-field hackernews-field hashnode-field hired-field dice-field indeed-field glassdoor-field levelsfyi-field otta-field indiehackers-field meetup-field eventbrite-field twitch-field youtube-field mastodon-field leetcode-field hackerrank-field womenwhocode-field sourceforge-field">
                    <label class="form-label">Include Similar Job Titles</label>
                    <div class="toggle-group">
                        <label class="toggle">
                            <input type="checkbox" id="includeSimilar" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <span style="font-size: 13px; color: var(--text-secondary);">Auto-expand with related titles</span>
                    </div>
                </div>
            </div>

            <!-- Selected Similar Titles -->
            <div id="similarTitlesContainer" class="hidden" style="margin-top: 16px;">
                <label class="form-label" style="margin-bottom: 8px;">Selected Similar Titles:</label>
                <div class="chips-container" id="selectedTitles"></div>
            </div>

            <!-- Selected Skills (LinkedIn; visibility controlled in updateSelectedSkills) -->
            <div id="similarSkillsContainer" class="hidden" style="margin-top: 16px;">
                <label class="form-label" style="margin-bottom: 8px;">Selected skills:</label>
                <div class="chips-container" id="selectedSkills"></div>
            </div>

            <div id="selectedLocationsContainer" class="hidden" style="margin-top: 16px;">
                <label class="form-label" style="margin-bottom: 8px;">Selected locations:</label>
                <div class="chips-container" id="selectedLocationsChips"></div>
            </div>
            <div id="selectedEmployersContainer" class="hidden" style="margin-top: 16px;">
                <label class="form-label" style="margin-bottom: 8px;">Selected current companies:</label>
                <div class="chips-container" id="selectedEmployersChips"></div>
            </div>
            <div id="selectedQualificationsContainer" class="hidden" style="margin-top: 16px;">
                <label class="form-label" style="margin-bottom: 8px;">Selected qualifications:</label>
                <div class="chips-container" id="selectedQualificationsChips"></div>
            </div>
            <div id="selectedIncludeKeywordsContainer" class="hidden" style="margin-top: 16px;">
                <label class="form-label" style="margin-bottom: 8px;">Selected keywords to include:</label>
                <div class="chips-container" id="selectedIncludeKeywordsChips"></div>
            </div>
            <div id="selectedExcludeKeywordsContainer" class="hidden" style="margin-top: 16px;">
                <label class="form-label" style="margin-bottom: 8px;">Selected keywords to exclude:</label>
                <div class="chips-container" id="selectedExcludeKeywordsChips"></div>
            </div>

            <!-- AI Suggestions -->
            <div class="ai-suggestions-block" style="margin-bottom: 16px; display: flex; align-items: center; flex-wrap: wrap; gap: 8px;">
                <button type="button" class="btn btn-ai" id="aiSuggest" onclick="getAISuggestions()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                    AI Suggestions
                </button>
                <span class="form-hint" style="font-size: 12px; color: var(--text-secondary);">Get suggestions for similar titles, qualifications, and skills based on your job title.</span>
            </div>
            <div class="suggestions-panel hidden" id="suggestionsPanel">
                <h4>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#5C6AC4" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                    AI Suggestions (click to add)
                </h4>
                <div class="suggestion-section">
                    <label class="form-label" style="font-size: 12px; margin-bottom: 6px;">Similar titles</label>
                    <div class="suggestion-chips" id="suggestionChips"></div>
                </div>
                <div class="suggestion-section">
                    <label class="form-label" style="font-size: 12px; margin-bottom: 6px;">Qualifications</label>
                    <div class="suggestion-chips" id="suggestionQualChips"></div>
                </div>
                <div class="suggestion-section">
                    <label class="form-label" style="font-size: 12px; margin-bottom: 6px;">Skills &amp; assessments</label>
                    <div class="suggestion-chips" id="suggestionSkillChips"></div>
                </div>
            </div>

            <!-- Company Targeting Section -->
            <div class="company-targeting-section" id="targetCompaniesSection">
                <div class="company-targeting-header" onclick="toggleCompanySection()">
                    <h4>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4z"/>
                        </svg>
                        Target Companies
                    </h4>
                    <svg class="collapse-icon open" id="companyIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: auto;">
                        <polyline points="6,9 12,15 18,9"/>
                    </svg>
                </div>
                <div class="collapsible-content open" id="companyContent">
                    <div class="company-ai-block">
                        <p class="company-ai-description">Describe what you're looking for — AI will suggest target companies to add to your search.</p>
                        <div class="company-ai-prompt-wrap">
                            <textarea id="companyAiPrompt" placeholder="e.g., Series B fintech startups in Toronto, or companies known for strong design culture, or FAANG alternatives in Europe..."></textarea>
                            <button type="button" class="btn btn-primary" id="companyAiBtn" onclick="getAiCompanySuggestions()">
                                <span id="companyAiBtnText">Get company suggestions</span>
                            </button>
                        </div>
                        <div id="companyAiLoading" class="hidden" style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">Finding companies...</div>
                        <div id="companyAiResults" class="hidden">
                            <div class="company-ai-results-label">Suggested companies — add to your search:</div>
                            <div class="company-ai-results-chips" id="companyAiResultsChips"></div>
                            <button type="button" class="btn" id="companyAiAddAllBtn" onclick="addAllAiCompanies()" style="margin-top: 10px; font-size: 12px;">Add all</button>
                        </div>
                    </div>
                    <p class="company-list-or">Or choose from preset lists:</p>
                    <div class="company-list-grid">
                        <div class="company-list-card" onclick="toggleCompanyList(this, 'faang')">
                            <h5>🏢 FAANG / Big Tech</h5>
                            <p>Google, Meta, Amazon, Apple, Netflix, Microsoft</p>
                        </div>
                        <div class="company-list-card" onclick="toggleCompanyList(this, 'ecommerce')">
                            <h5>🛒 E-commerce / Fintech</h5>
                            <p>Stripe, Square, BigCommerce, Klarna, Affirm</p>
                        </div>
                        <div class="company-list-card" onclick="toggleCompanyList(this, 'highgrowth')">
                            <h5>🚀 High-Growth Startups</h5>
                            <p>Figma, Notion, Linear, Vercel, Supabase, Retool</p>
                        </div>
                        <div class="company-list-card" onclick="toggleCompanyList(this, 'canadian')">
                            <h5>🍁 Canadian Tech</h5>
                            <p>Wealthsimple, 1Password, Clio, Hootsuite, Cohere</p>
                        </div>
                        <div class="company-list-card" onclick="toggleCompanyList(this, 'consulting')">
                            <h5>💼 Tech Consulting</h5>
                            <p>Thoughtworks, Pivotal, Slalom, Accenture, Deloitte Digital</p>
                        </div>
                        <div class="company-list-card" onclick="toggleCompanyList(this, 'ai')">
                            <h5>🤖 AI / ML Companies</h5>
                            <p>OpenAI, Anthropic, Cohere, Scale AI, Hugging Face</p>
                        </div>
                    </div>
                    <div class="selected-companies" id="selectedCompanies" style="display: none;"></div>
                </div>
            </div>

            <!-- Candidate Signals Section -->
            <div class="signals-section">
                <div class="signals-header" onclick="toggleSignalsSection()">
                    <h4>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        Candidate Activity Signals
                    </h4>
                    <svg class="collapse-icon" id="signalsIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: auto;">
                        <polyline points="6,9 12,15 18,9"/>
                    </svg>
                </div>
                <div class="collapsible-content" id="signalsContent">
                    <p class="signals-description">
                        Find candidates showing signs of being open to new opportunities (passive vs active signals).
                    </p>
                    <div class="signals-grid">
                        <label class="signal-option" onclick="toggleSignalOption(this)">
                            <input type="checkbox" value="open_to_work" class="signal-checkbox">
                            <div class="signal-option-content">
                                <h5>🟢 Open to Work</h5>
                                <p>LinkedIn "Open to Work" badge, actively looking</p>
                            </div>
                        </label>
                        <label class="signal-option" onclick="toggleSignalOption(this)">
                            <input type="checkbox" value="recent_change" class="signal-checkbox">
                            <div class="signal-option-content">
                                <h5>🔄 Recent Job Change</h5>
                                <p>Changed roles in last 6-18 months (may be open again)</p>
                            </div>
                        </label>
                        <label class="signal-option" onclick="toggleSignalOption(this)">
                            <input type="checkbox" value="speaker" class="signal-checkbox">
                            <div class="signal-option-content">
                                <h5>🎤 Conference Speaker</h5>
                                <p>Speaks at conferences, high visibility talent</p>
                            </div>
                        </label>
                        <label class="signal-option" onclick="toggleSignalOption(this)">
                            <input type="checkbox" value="content_creator" class="signal-checkbox">
                            <div class="signal-option-content">
                                <h5>✍️ Content Creator</h5>
                                <p>Writes blogs, creates videos, thought leadership</p>
                            </div>
                        </label>
                        <label class="signal-option" onclick="toggleSignalOption(this)">
                            <input type="checkbox" value="open_source" class="signal-checkbox">
                            <div class="signal-option-content">
                                <h5>🔓 Open Source Contributor</h5>
                                <p>Active GitHub contributions, maintainer</p>
                            </div>
                        </label>
                        <label class="signal-option" onclick="toggleSignalOption(this)">
                            <input type="checkbox" value="layoff" class="signal-checkbox">
                            <div class="signal-option-content">
                                <h5>📋 Recently Laid Off</h5>
                                <p>Affected by recent tech layoffs, actively seeking</p>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Diversity Sourcing Section -->
            <div class="diversity-section">
                <div class="diversity-header" onclick="toggleDiversitySection()">
                    <h4>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        Diversity Sourcing
                    </h4>
                    <svg class="collapse-icon" id="diversityIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: auto;">
                        <polyline points="6,9 12,15 18,9"/>
                    </svg>
                </div>
                <div class="collapsible-content" id="diversityContent">
                    <p class="diversity-description">
                        Find candidates affiliated with diversity-focused organizations, HBCUs, professional groups, and conferences.
                    </p>
                    <div class="diversity-grid">
                        <label class="diversity-option" onclick="toggleDiversityOption(this)">
                            <input type="checkbox" value="hbcu" class="diversity-checkbox">
                            <div class="diversity-option-content">
                                <h5>HBCUs</h5>
                                <p>Historically Black Colleges and Universities</p>
                            </div>
                        </label>
                        <label class="diversity-option" onclick="toggleDiversityOption(this)">
                            <input type="checkbox" value="wit" class="diversity-checkbox">
                            <div class="diversity-option-content">
                                <h5>Women in Tech</h5>
                                <p>Women Who Code, AnitaB, Grace Hopper</p>
                            </div>
                        </label>
                        <label class="diversity-option" onclick="toggleDiversityOption(this)">
                            <input type="checkbox" value="bipoc" class="diversity-checkbox">
                            <div class="diversity-option-content">
                                <h5>BIPOC in Tech</h5>
                                <p>/dev/color, NSBE, SHPE, Techqueria</p>
                            </div>
                        </label>
                        <label class="diversity-option" onclick="toggleDiversityOption(this)">
                            <input type="checkbox" value="lgbtq" class="diversity-checkbox">
                            <div class="diversity-option-content">
                                <h5>LGBTQ+ in Tech</h5>
                                <p>Lesbians Who Tech, Out in Tech, oSTEM</p>
                            </div>
                        </label>
                        <label class="diversity-option" onclick="toggleDiversityOption(this)">
                            <input type="checkbox" value="veterans" class="diversity-checkbox">
                            <div class="diversity-option-content">
                                <h5>Veterans</h5>
                                <p>VetsinTech, Hiring Our Heroes</p>
                            </div>
                        </label>
                        <label class="diversity-option" onclick="toggleDiversityOption(this)">
                            <input type="checkbox" value="firstgen" class="diversity-checkbox">
                            <div class="diversity-option-content">
                                <h5>First-Gen / Non-Traditional</h5>
                                <p>Bootcamp grads, career changers</p>
                            </div>
                        </label>
                        <label class="diversity-option" onclick="toggleDiversityOption(this)">
                            <input type="checkbox" value="disability" class="diversity-checkbox">
                            <div class="diversity-option-content">
                                <h5>Disability & Neurodiversity</h5>
                                <p>Disability:IN, Lime Connect, Neurodiversity in Tech</p>
                            </div>
                        </label>
                        <label class="diversity-option" onclick="toggleDiversityOption(this)">
                            <input type="checkbox" value="parents" class="diversity-checkbox">
                            <div class="diversity-option-content">
                                <h5>Parents & Returners</h5>
                                <p>Path Forward, reacHIRE, Mother Coders, iRelaunch</p>
                            </div>
                        </label>
                        <label class="diversity-option" onclick="toggleDiversityOption(this)">
                            <input type="checkbox" value="immigrants" class="diversity-checkbox">
                            <div class="diversity-option-content">
                                <h5>Immigrants & Newcomers</h5>
                                <p>TRIEC, Upwardly Global, NPower, skilled immigrants</p>
                            </div>
                        </label>
                        <label class="diversity-option" onclick="toggleDiversityOption(this)">
                            <input type="checkbox" value="indigenous" class="diversity-checkbox">
                            <div class="diversity-option-content">
                                <h5>Indigenous in Tech</h5>
                                <p>AISES, Indigenous in Tech, NACME</p>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Find similar to a profile -->
            <div class="diversity-section profile-similar-section-wrap">
                <div class="diversity-header" onclick="toggleProfileSimilarSection()">
                    <h4>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Find similar candidates
                    </h4>
                    <svg class="collapse-icon" id="profileSimilarIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: auto;">
                        <polyline points="6,9 12,15 18,9"/>
                    </svg>
                </div>
                <div class="collapsible-content" id="profileSimilarContent">
                    <p class="profile-similar-tldr" style="font-weight: 600; font-size: 13px; margin-bottom: 8px; color: var(--text-primary);">Found someone great? Use their profile to find more candidates like them.</p>
                    <p class="diversity-description" style="margin-bottom: 12px;">
                        LinkedIn doesn’t let us read profiles from here — so we work with PDFs or pasted text. Save the profile as a PDF (Print → Save as PDF in your browser), upload it below, and we’ll suggest search terms to find similar people. You can also paste profile text or upload a resume.
                    </p>
                    <div class="profile-input-row">
                        <label for="profileLinkedInUrl">LinkedIn profile URL</label>
                        <input type="url" id="profileLinkedInUrl" placeholder="https://www.linkedin.com/in/...">
                        <span class="upload-hint" style="display: block; margin-top: 4px;">We’ll open it in a new tab so you can save the profile as a PDF.</span>
                    </div>
                    <div id="profileLinkedInOnlyMessage" class="hidden" style="margin-bottom: 12px; padding: 12px; background: rgba(10, 102, 194, 0.1); border: 1px solid rgba(10, 102, 194, 0.3); border-radius: 8px; font-size: 13px; color: var(--text-primary);">
                        We’ve opened the profile in a new tab. Save it as a PDF (Print → Save as PDF), then upload the PDF below and click <strong>Analyze & get search terms</strong>.
                    </div>
                    <div class="profile-upload-row">
                        <input type="file" id="profilePdfInput" accept=".pdf,application/pdf" onchange="handleProfilePdfUpload(event)">
                        <span class="upload-hint">Upload a PDF (profile or resume) and we’ll pull out the text for you.</span>
                    </div>
                    <div class="profile-paste-wrap">
                        <textarea id="profilePasteInput" placeholder="Or paste profile or resume text here. If you upload a PDF, we’ll fill this for you."></textarea>
                        <button type="button" class="btn btn-primary" id="profileAnalyzeBtn" onclick="analyzeProfileFromPaste()">
                            <span id="profileAnalyzeBtnText">Analyze & get search terms</span>
                        </button>
                    </div>
                    <div id="profileAnalyzeLoading" class="hidden" style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">Analyzing profile...</div>
                    <div id="profileResultBlock" class="hidden" style="margin-top: 12px;">
                        <div class="profile-result-block">
                            <div class="profile-feedback" id="profileFeedback"></div>
                            <div class="profile-suggestions" id="profileSuggestions"></div>
                            <div class="profile-query-wrap">
                                <label>Search query to find similar candidates</label>
                                <pre class="profile-query-text" id="profileQueryText"></pre>
                            </div>
                            <div class="profile-result-actions">
                                <button type="button" class="btn btn-primary" onclick="applyProfileSuggestions()">Use in search</button>
                                <button type="button" class="btn btn-secondary" onclick="copyProfileQuery(event)">Copy query</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Keywords from intake form -->
            <div class="diversity-section intake-section-wrap">
                <div class="diversity-header" onclick="toggleIntakeSection()">
                    <h4>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10,9 9,9 8,9"/>
                        </svg>
                        Keywords from intake form
                    </h4>
                    <svg class="collapse-icon" id="intakeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: auto;">
                        <polyline points="6,9 12,15 18,9"/>
                    </svg>
                </div>
                <div class="collapsible-content" id="intakeContent">
                    <p class="profile-similar-tldr" style="font-weight: 600; font-size: 13px; margin-bottom: 8px; color: var(--text-primary);">Use role intakes from hiring managers to prefill your search.</p>
                    <p class="diversity-description" style="margin-bottom: 12px;">
                        Upload a PDF or paste intake form text (role description, requirements) and we’ll extract job title, keywords, and a boolean query.
                    </p>
                    <div class="profile-upload-row" style="margin-bottom: 12px;">
                        <input type="file" id="intakePdfInput" accept=".pdf,application/pdf" onchange="handleIntakePdfUpload(event)">
                        <span class="upload-hint">Upload an intake form PDF and we’ll pull out the text for you.</span>
                    </div>
                    <div class="profile-paste-wrap">
                        <textarea id="intakePasteInput" placeholder="Paste intake form or role description here, or upload a PDF above." style="min-height: 100px;"></textarea>
                        <button type="button" class="btn btn-primary" id="intakeExtractBtn" onclick="extractFromIntakeForm()">
                            <span id="intakeExtractBtnText">Extract keywords & apply to search</span>
                        </button>
                    </div>
                    <div id="intakeExtractLoading" class="hidden" style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">Extracting from intake form...</div>
                </div>
            </div>

            <!-- Find similar portfolios -->
            <div class="diversity-section portfolio-section-wrap">
                <div class="diversity-header" onclick="togglePortfolioSection()">
                    <h4>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21,15 16,10 5,21"/>
                        </svg>
                        Find similar portfolios
                    </h4>
                    <svg class="collapse-icon" id="portfolioSimilarIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: auto;">
                        <polyline points="6,9 12,15 18,9"/>
                    </svg>
                </div>
                <div class="collapsible-content" id="portfolioSimilarContent">
                    <p class="profile-similar-tldr" style="font-weight: 600; font-size: 13px; margin-bottom: 8px; color: var(--text-primary);">Design talent often shows up in portfolios, not on LinkedIn. Share links to designers you’ve already hired and we’ll help you find more like them.</p>
                    <p class="diversity-description" style="margin-bottom: 12px;">
                        Add portfolio URLs—Dribbble, Behance, or personal sites—from designers you’ve hired or want to match. We’ll build a search you can run in Google to surface similar candidates.
                    </p>
                    <div class="form-group" style="margin-bottom: 10px;">
                        <label class="form-label">Portfolio URLs (one per line)</label>
                        <textarea id="portfolioUrlsInput" placeholder="https://dribbble.com/username&#10;https://behance.net/designer&#10;https://johndoe.com" style="min-height: 80px; width: 100%; padding: 10px 12px; font-size: 13px; border: 1px solid var(--border); border-radius: 8px; background: var(--surface); color: var(--text-primary); resize: vertical;"></textarea>
                    </div>
                    <button type="button" class="btn btn-primary" id="portfolioSimilarBtn" onclick="findSimilarPortfolios()">
                        <span id="portfolioSimilarBtnText">Find similar portfolios</span>
                    </button>
                    <div id="portfolioSimilarLoading" class="hidden" style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">Building your search...</div>
                    <div id="portfolioSimilarResult" class="hidden" style="margin-top: 12px;">
                        <div class="profile-result-block">
                            <div class="profile-query-wrap">
                                <label>Your Google search</label>
                                <pre class="profile-query-text" id="portfolioSimilarQuery"></pre>
                            </div>
                            <div style="margin-top: 10px;">
                                <label style="font-size: 12px; color: var(--text-secondary);">Or use Google’s “related” search to find pages similar to each URL:</label>
                                <pre class="profile-query-text" id="portfolioRelatedQuery" style="margin-top: 4px; font-size: 12px;"></pre>
                            </div>
                            <div class="profile-result-actions" style="margin-top: 12px;">
                                <button type="button" class="btn btn-primary" onclick="openPortfolioSearch('keyword')">Open in Google</button>
                                <button type="button" class="btn btn-secondary" onclick="openPortfolioSearch('related')">Open related search in Google</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Similar tech stack -->
            <div class="diversity-section tech-stack-section-wrap">
                <div class="diversity-header" onclick="toggleTechStackSection()">
                    <h4>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 18 22 12 16 6"/>
                            <polyline points="8 6 2 12 8 18"/>
                        </svg>
                        Similar tech stack
                    </h4>
                    <svg class="collapse-icon" id="techStackIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: auto;">
                        <polyline points="6,9 12,15 18,9"/>
                    </svg>
                </div>
                <div class="collapsible-content" id="techStackContent">
                    <p class="diversity-description" style="margin-bottom: 14px;">
                        Discover companies to add to your search in two ways: name a company you like and we’ll find others with a similar stack, or list the technologies you care about (e.g. Ruby, React).
                    </p>
                    <div class="tech-stack-block">
                        <label class="form-label" style="margin-bottom: 6px; font-size: 12px;">Companies like this one</label>
                        <div class="company-ai-prompt-wrap">
                            <input type="text" class="form-input" id="techStackCompanyInput" placeholder="e.g., Shopify, Stripe, Vercel..." style="flex: 1; min-width: 0;">
                            <button type="button" class="btn btn-primary" id="techStackBtn" onclick="getTechStackCompanySuggestions()">
                                <span id="techStackBtnText">Find similar companies</span>
                            </button>
                        </div>
                    </div>
                    <p class="company-list-or" style="margin: 14px 0 8px;">Or</p>
                    <div class="tech-stack-block">
                        <label class="form-label" style="margin-bottom: 6px; font-size: 12px;">Companies using these technologies</label>
                        <div class="company-ai-prompt-wrap">
                            <input type="text" class="form-input" id="techStackTechInput" placeholder="e.g., Ruby, Python, React, PostgreSQL, AWS..." style="flex: 1; min-width: 0;">
                            <button type="button" class="btn btn-primary" id="techByTechBtn" onclick="getCompaniesByTechSuggestions()">
                                <span id="techByTechBtnText">Find companies</span>
                            </button>
                        </div>
                    </div>
                    <div id="techStackLoading" class="hidden" style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;"></div>
                    <div id="techStackResults" class="hidden">
                        <div class="company-ai-results-label" id="techStackResultsLabel">Hover a company to see its tech. Use <strong>Add</strong> to send any of them to your Target Companies list above.</div>
                        <div class="company-ai-results-chips" id="techStackResultsChips"></div>
                        <div style="display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn" id="techStackAddAllBtn" onclick="addAllTechStackCompanies()" style="font-size: 12px;">Add all</button>
                            <button type="button" class="btn btn-secondary" id="techStackRefreshBtn" onclick="refreshTechStackSuggestions()" style="font-size: 12px;" title="Get a different set of companies (less obvious picks)">Refresh for more</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" id="generateSearch" onclick="generateSearch()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    Generate Search
                </button>
                <button class="btn btn-secondary" onclick="clearForm()">
                    Clear
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section hidden" id="resultsSection">
            <div class="results-header">
                <h3>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                    </svg>
                    Generated Search Query
                </h3>
                <div class="results-actions">
                    <button class="btn btn-secondary btn-small" onclick="saveSearch()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/>
                        </svg>
                        Save
                    </button>
                    <button class="btn btn-primary btn-small" id="openSearchBtn" onclick="openSearch()">
                        Open in Google
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/>
                            <polyline points="15,3 21,3 21,9"/>
                            <line x1="10" y1="14" x2="21" y2="3"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="query-display" id="queryDisplay">
                <button class="copy-btn" onclick="copyQuery()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                    </svg>
                    Copy
                </button>
                <textarea id="queryText" class="query-textarea" rows="4" oninput="updateCurrentQuery(this.value)" placeholder="Your search query will appear here..."></textarea>
                <p class="query-edit-hint">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    You can edit this query before opening
                </p>
            </div>

            <!-- AI Optimize Button -->
            <div class="ai-optimize-section">
                <button class="btn btn-ai" onclick="optimizeQueryWithAI()" id="aiOptimizeBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    <span id="aiOptimizeBtnText">AI Optimize Query</span>
                </button>
                <span class="ai-optimize-hint">Let AI analyze and improve your search</span>
            </div>

            <!-- AI Optimized Result -->
            <div class="ai-optimized-result hidden" id="aiOptimizedResult">
                <div class="ai-result-header">
                    <h4>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#5C6AC4" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5"/>
                            <path d="M2 12l10 5 10-5"/>
                        </svg>
                        AI-Optimized Query
                    </h4>
                    <button class="btn btn-primary btn-small" onclick="useOptimizedQuery()">
                        Use This Query
                    </button>
                </div>
                <div class="ai-optimized-query" id="aiOptimizedQuery"></div>
                <div class="ai-explanation" id="aiExplanation"></div>
            </div>
        </div>

        <!-- Email Generator -->
        <div class="email-section hidden" id="emailSection">
            <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <polyline points="22,6 12,13 2,6"/>
                </svg>
                Outreach Email Template
            </h3>
            <div class="email-controls">
                <button class="tone-btn active" data-tone="professional" onclick="setEmailTone('professional')">Professional</button>
                <button class="tone-btn" data-tone="casual" onclick="setEmailTone('casual')">Casual</button>
                <button class="tone-btn" data-tone="enthusiastic" onclick="setEmailTone('enthusiastic')">Enthusiastic</button>
                <button class="tone-btn" data-tone="concise" onclick="setEmailTone('concise')">Concise</button>
                <button class="tone-btn ai-tone" data-tone="ai" onclick="generateAIEmail()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    AI Generate
                </button>
            </div>
            <div class="ai-email-options hidden" id="aiEmailOptions">
                <label class="form-label">Customize AI Email (optional)</label>
                <div class="ai-email-inputs">
                    <input type="text" class="form-input" id="candidateName" placeholder="Candidate's name (optional)">
                    <input type="text" class="form-input" id="specificSkill" placeholder="Specific skill to mention (optional)">
                    <select class="form-select" id="aiEmailTone">
                        <option value="professional">Professional tone</option>
                        <option value="friendly">Friendly tone</option>
                        <option value="enthusiastic">Enthusiastic tone</option>
                        <option value="brief">Brief & direct</option>
                    </select>
                </div>
                <button class="btn btn-ai btn-small" onclick="generateAIEmailWithOptions()" id="aiEmailBtn">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    <span id="aiEmailBtnText">Generate with AI</span>
                </button>
            </div>
            <div class="email-template" id="emailTemplate"></div>
            <div class="email-actions">
                <button class="btn btn-secondary btn-small" onclick="regenerateEmail()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                    </svg>
                    Regenerate
                </button>
                <button class="btn btn-primary btn-small" onclick="copyEmail()">
                    Copy Email
                </button>
            </div>
        </div>

        <!-- Top Candidates (AI-generated) -->
        <div class="candidates-section hidden" id="candidatesSection">
            <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
                </svg>
                Top candidates <span id="candidatesCount" class="candidates-count"></span>
            </h3>
            <div class="candidates-actions">
                <button type="button" class="btn btn-secondary btn-small" onclick="exportCandidatesCSV()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Export CSV
                </button>
                <button type="button" class="btn btn-primary btn-small" onclick="sendCandidatesToSlack()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M5.042 15.165a2.528 2.528 0 01-2.52 2.523A2.528 2.528 0 010 15.165a2.527 2.527 0 012.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 012.521-2.52 2.527 2.527 0 012.521 2.52v6.313A2.528 2.528 0 018.834 24a2.528 2.528 0 01-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 01-2.521-2.52A2.528 2.528 0 018.834 0a2.528 2.528 0 012.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 012.521 2.521 2.528 2.528 0 01-2.521 2.521 2.527 2.527 0 01-2.521-2.521 2.527 2.527 0 012.521-2.521zM18.956 8.834a2.528 2.528 0 012.522 2.521 2.528 2.528 0 01-2.522 2.521 2.527 2.527 0 01-2.521-2.521 2.527 2.527 0 012.521-2.521zM15.165 8.834a2.527 2.527 0 012.521-2.521 2.528 2.528 0 012.521 2.521v6.313A2.528 2.528 0 0117.686 24a2.528 2.528 0 01-2.521-2.522V8.834zM12.458 5.042a2.528 2.528 0 01-2.521-2.52A2.528 2.528 0 0112.458 0a2.528 2.528 0 012.521 2.522v2.52h-2.521zM12.458 6.313a2.528 2.528 0 012.521 2.521 2.528 2.528 0 01-2.521 2.521 2.527 2.527 0 01-2.521-2.521 2.527 2.527 0 012.521-2.521zM24 18.956a2.528 2.528 0 01-2.522 2.522 2.528 2.528 0 01-2.521-2.522v-2.522h2.521A2.528 2.528 0 0124 18.956z"/></svg>
                    Send to Slack
                </button>
            </div>
            <div class="candidates-table-wrap">
                <table class="candidates-table" id="candidatesTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Title</th>
                            <th>Company</th>
                            <th>Location</th>
                            <th>Score</th>
                            <th>LinkedIn</th>
                        </tr>
                    </thead>
                    <tbody id="candidatesTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Boolean Cheat Sheet -->
        <div class="cheatsheet-section">
            <h3 onclick="toggleCheatsheet()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                Boolean Search Cheat Sheet
                <svg class="collapse-icon" id="cheatsheetIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: auto;">
                    <polyline points="6,9 12,15 18,9"/>
                </svg>
            </h3>
            <div class="collapsible-content" id="cheatsheetContent">
                <div class="cheatsheet-grid" style="margin-top: 16px;">
                    <div class="cheatsheet-item">
                        <code>"exact phrase"</code>
                        <p>Search for an exact phrase, e.g. "software engineer"</p>
                    </div>
                    <div class="cheatsheet-item">
                        <code>AND</code>
                        <p>Must contain both terms: Python AND "machine learning"</p>
                    </div>
                    <div class="cheatsheet-item">
                        <code>OR</code>
                        <p>Match either term: "engineer" OR "developer"</p>
                    </div>
                    <div class="cheatsheet-item">
                        <code>-</code> or <code>NOT</code>
                        <p>Exclude a term: engineer -recruiter or engineer NOT recruiter</p>
                    </div>
                    <div class="cheatsheet-item">
                        <code>(grouping)</code>
                        <p>Group terms: (engineer OR developer) AND Toronto</p>
                    </div>
                    <div class="cheatsheet-item">
                        <code>site:domain.com</code>
                        <p>Search only that site, e.g. site:linkedin.com/in/ or site:github.com</p>
                    </div>
                    <div class="cheatsheet-item">
                        <code>intitle:</code>
                        <p>Term in page title: intitle:"senior engineer"</p>
                    </div>
                    <div class="cheatsheet-item">
                        <code>inurl:</code>
                        <p>Term in URL: inurl:engineer</p>
                    </div>
                    <div class="cheatsheet-item">
                        <code>*</code> (wildcard)
                        <p>Match any word: "software * engineer"</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Saved Searches -->
        <div class="saved-searches" id="savedSearchesSection">
            <h3>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/>
                </svg>
                Saved Searches
            </h3>
            <div id="savedSearchesList">
                <p style="color: var(--text-secondary); font-size: 14px;">No saved searches yet. Generate a search and save it!</p>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>Built with 💚 for Shopify Hiring Managers | Hosted on <a href="https://quick.shopify.io" target="_blank">Quick</a></p>
        <p style="margin-top: 8px;">Need help? Reach out to your recruiter</p>
    </footer>

    <!-- How to Use Guide Modal -->
    <div class="modal-overlay" id="guideModal" onclick="closeGuideOnOverlay(event)">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-header-content">
                    <img src="logo.png" alt="Talent Scout">
                    <div>
                        <h2>Welcome to Talent Scout!</h2>
                        <p>Your AI-powered sourcing assistant</p>
                    </div>
                </div>
                <button class="modal-close" onclick="closeGuide()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="guide-divider">
                    <span>How it works</span>
                </div>

                <div class="guide-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Pick a platform</h4>
                        <p>Choose where to search: LinkedIn, Reddit, GitHub, GitLab, Bitbucket, CodePen, SourceForge, Stack Overflow, Stack Exchange, Hacker News, X, Scholar, Dribbble, Behance, Kaggle, Wellfound, Substack, Dev.to, Hashnode, Product Hunt, Indie Hackers, Polywork, Bluesky, Mastodon, Quora, Speaker Deck, Hired, Dice, Indeed, Glassdoor, Levels.fyi, Otta, Meetup, Eventbrite, Twitch, YouTube, LeetCode, HackerRank, Women Who Code.</p>
                    </div>
                </div>

                <div class="guide-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Job details</h4>
                        <p>Use <strong>Quick Templates</strong> to load a role, then add title, location, and keywords. Specific = better results.</p>
                    </div>
                </div>

                <div class="guide-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Target Companies</h4>
                        <p>Describe what you want and hit <strong>Get company suggestions</strong>, or use preset lists. Add companies to your search—they show up in your query.</p>
                    </div>
                </div>

                <div class="guide-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Similar tech stack</h4>
                        <p>Enter a company name <em>or</em> a list of tech (e.g. Ruby, React). Hover chips to see tech; Add sends them to Target Companies. <strong>Refresh for more</strong> gets a different set.</p>
                    </div>
                </div>

                <div class="guide-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h4>Find similar candidates</h4>
                        <p>Paste a profile or upload a PDF, then <strong>Analyze</strong>. Use in search fills the form so you can find more people like them.</p>
                    </div>
                </div>

                <div class="guide-step">
                    <div class="step-number">6</div>
                    <div class="step-content">
                        <h4>Find similar portfolios</h4>
                        <p>For design roles: use the <strong>Find similar portfolios</strong> section (below Keywords from intake form). Paste Dribbble, Behance, or personal portfolio URLs of people you’ve hired and we’ll generate a Google search to discover similar designer profiles.</p>
                    </div>
                </div>

                <div class="guide-step">
                    <div class="step-number">7</div>
                    <div class="step-content">
                        <h4>Diversity Sourcing</h4>
                        <p>Add terms for Disability & Neurodiversity, Parents & Returners, Immigrants & Newcomers, or Indigenous in Tech.</p>
                    </div>
                </div>

                <div class="guide-step">
                    <div class="step-number">8</div>
                    <div class="step-content">
                        <h4>Generate & search</h4>
                        <p><strong>Generate Search</strong> builds your query. <strong>Open in Google</strong> (or the platform button) runs it. Save for later; switch tabs to try another platform.</p>
                    </div>
                </div>

                <div class="guide-step">
                    <div class="step-number">9</div>
                    <div class="step-content">
                        <h4>Reach out</h4>
                        <p>Use the email template below. Pick a tone, regenerate if you want something different, then copy and personalize.</p>
                    </div>
                </div>

                <!-- Boolean search basics -->
                <div class="guide-boolean-section">
                    <div class="guide-boolean-header">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#D82C0D" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="12"/>
                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                        </svg>
                        <h4>Boolean search basics</h4>
                    </div>
                    <p class="guide-boolean-intro">These operators power your search. Get to know them:</p>
                    
                    <div class="guide-boolean-grid">
                        <div class="guide-boolean-item">
                            <code>"exact phrase"</code>
                            <span>Search for exact words together</span>
                        </div>
                        <div class="guide-boolean-item">
                            <code>AND</code>
                            <span>Must contain both terms</span>
                        </div>
                        <div class="guide-boolean-item">
                            <code>OR</code>
                            <span>Match either term (more results)</span>
                        </div>
                        <div class="guide-boolean-item">
                            <code>-</code> or <code>NOT</code>
                            <span>Exclude / remove unwanted results</span>
                        </div>
                        <div class="guide-boolean-item">
                            <code>(grouping)</code>
                            <span>Group terms together</span>
                        </div>
                        <div class="guide-boolean-item">
                            <code>site:domain.com</code>
                            <span>Search only that site (e.g. LinkedIn, GitHub)</span>
                        </div>
                        <div class="guide-boolean-item">
                            <code>intitle:</code>
                            <span>Term appears in page title</span>
                        </div>
                        <div class="guide-boolean-item">
                            <code>inurl:</code>
                            <span>Term appears in the URL</span>
                        </div>
                        <div class="guide-boolean-item">
                            <code>*</code>
                            <span>Wildcard — matches any word</span>
                        </div>
                    </div>

                    <div class="guide-boolean-example">
                        <strong>Example:</strong> <code>site:linkedin.com/in/ ("Software Engineer" OR "Developer") AND Python -recruiter</code>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <label class="dont-show-again">
                    <input type="checkbox" id="dontShowAgain">
                    Don't show this again
                </label>
                <button class="btn btn-primary" onclick="closeGuide()">
                    Get Started
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentPlatform = 'linkedin';
        let currentQuery = '';
        let savedSearches = [];
        let selectedSimilarTitles = [];
        let selectedSkills = [];
        const skillSuggestionsList = ['Python', 'JavaScript', 'TypeScript', 'React', 'Node.js', 'Ruby', 'Ruby on Rails', 'Java', 'Go', 'Kubernetes', 'AWS', 'Docker', 'SQL', 'GraphQL', 'REST API', 'Machine learning', 'Data analysis', 'Product management', 'Agile', 'Scrum', 'Figma', 'User research', 'System design', 'CI/CD', 'PostgreSQL', 'Redis', 'Elasticsearch', 'React Native', 'Vue.js', 'Leadership', 'Mentorship', 'Technical writing', 'Public speaking', 'A/B testing', 'Growth', 'E-commerce', 'SaaS', 'Fintech', 'API design', 'Microservices', 'Distributed systems', 'Security', 'DevOps', 'SRE', 'Frontend', 'Backend', 'Full stack', 'Mobile development', 'Data engineering', 'Data science', 'UX design', 'UI design', 'Design systems'].sort();

        let selectedLocations = [];
        let selectedEmployers = [];
        let selectedEducationLevels = [];
        let selectedQualifications = [];
        let selectedIncludeKeywords = [];
        let selectedExcludeKeywords = [];
        const acSuggestions = {
            location: ['Toronto', 'San Francisco', 'New York', 'Vancouver', 'Montreal', 'Remote', 'Austin', 'Seattle', 'London', 'Berlin', 'Amsterdam', 'Sydney', 'Singapore', 'Dubai', 'Chicago', 'Boston', 'Denver', 'Los Angeles', 'Ottawa', 'Calgary', 'Hybrid'].sort(),
            currentEmployer: ['Google', 'Meta', 'Amazon', 'Apple', 'Microsoft', 'Shopify', 'Stripe', 'Netflix', 'Spotify', 'Slack', 'Figma', 'Notion', 'Airbnb', 'Uber', 'Lyft', 'Square', 'Salesforce', 'Adobe', 'Oracle', 'IBM', 'GitHub', 'Atlassian', 'Twilio', 'Snowflake', 'Datadog', 'Vercel', 'Linear', 'Webflow'].sort(),
            education: ["Bachelor's Degree", "Master's Degree", 'MBA', 'PhD', 'Doctoral Degree', 'Bootcamp', 'B.S.', 'B.A.', 'M.S.', 'M.A.', 'BEng', 'MEng', 'Associate Degree'].sort(),
            qualifications: ['PMP', 'CFA', 'PMP certified', '5+ years experience', '10+ years', 'Leadership experience', 'Team lead', 'Technical leadership', 'Cross-functional', 'Startup experience', 'FAANG', 'Scaled systems', 'Public speaking', 'Mentorship', 'Open source contributor'].sort(),
            includeKeywords: ['machine learning', 'fintech', 'SaaS', 'B2B', 'e-commerce', 'API', 'React', 'Python', 'Ruby', 'Go', 'distributed systems', 'microservices', 'agile', 'scrum', 'product-led', 'growth', 'data-driven', 'startup', 'scale-up', 'remote-first', 'design systems', 'user research', 'A/B testing', 'experimentation'].sort(),
            excludeKeywords: ['recruiter', 'HR', 'sales', 'agency', 'consultant', 'freelance', 'intern', 'student', 'junior', 'entry level'].sort()
        };
        const acFieldConfig = {
            location: { inputId: 'locationInput', dropdownId: 'locationDropdown', containerId: 'selectedLocationsContainer', chipsId: 'selectedLocationsChips' },
            currentEmployer: { inputId: 'currentEmployerInput', dropdownId: 'currentEmployerDropdown', containerId: 'selectedEmployersContainer', chipsId: 'selectedEmployersChips' },
            education: { inputId: 'educationInput', dropdownId: 'educationDropdown', containerId: 'selectedEducationContainer', chipsId: 'selectedEducationChips' },
            qualifications: { inputId: 'qualificationsInput', dropdownId: 'qualificationsDropdown', containerId: 'selectedQualificationsContainer', chipsId: 'selectedQualificationsChips' },
            includeKeywords: { inputId: 'includeKeywordsInput', dropdownId: 'includeKeywordsDropdown', containerId: 'selectedIncludeKeywordsContainer', chipsId: 'selectedIncludeKeywordsChips' },
            excludeKeywords: { inputId: 'excludeKeywordsInput', dropdownId: 'excludeKeywordsDropdown', containerId: 'selectedExcludeKeywordsContainer', chipsId: 'selectedExcludeKeywordsChips' }
        };
        function getAcSelected(field) {
            const m = { location: selectedLocations, currentEmployer: selectedEmployers, education: selectedEducationLevels, qualifications: selectedQualifications, includeKeywords: selectedIncludeKeywords, excludeKeywords: selectedExcludeKeywords };
            return m[field];
        }
        let currentAcField = null;
        let searchCount = parseInt(localStorage.getItem('talentScoutSearchCount') || '0');
        let isDarkMode = localStorage.getItem('talentScoutDarkMode') === 'true';
        let currentEmailTone = 'professional';
        let currentJobTitle = '';
        let selectedCompanyLists = [];
        let selectedCompanies = [];
        let aiGeneratedCandidates = [];

        // Quick Database for shared saved searches
        let searchesDB = null;
        
        async function initDatabase() {
            try {
                if (typeof quick !== 'undefined' && quick.db) {
                    searchesDB = quick.db.collection('saved_searches');
                    await loadSavedSearches();
                } else {
                    // Fallback to localStorage if not on Quick
                    savedSearches = JSON.parse(localStorage.getItem('talentScoutSearches') || '[]');
                    renderSavedSearches();
                    updateStats();
                }
            } catch (error) {
                console.error('Database init error:', error);
                savedSearches = JSON.parse(localStorage.getItem('talentScoutSearches') || '[]');
                renderSavedSearches();
                updateStats();
            }
        }

        async function loadSavedSearches() {
            try {
                if (searchesDB) {
                    const results = await searchesDB.find();
                    savedSearches = results.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    renderSavedSearches();
                }
                updateStats();
            } catch (error) {
                console.error('Load searches error:', error);
                updateStats();
            }
        }

        // Company lists
        const companyLists = {
            'faang': ['Google', 'Meta', 'Amazon', 'Apple', 'Netflix', 'Microsoft', 'Alphabet'],
            'ecommerce': ['Stripe', 'Square', 'BigCommerce', 'Klarna', 'Affirm', 'PayPal', 'Adyen', 'Checkout.com'],
            'highgrowth': ['Figma', 'Notion', 'Linear', 'Vercel', 'Supabase', 'Retool', 'Airtable', 'Miro', 'Canva'],
            'canadian': ['Wealthsimple', '1Password', 'Clio', 'Hootsuite', 'Cohere', 'Ada', 'Clearco', 'ApplyBoard', 'Dialogue'],
            'consulting': ['Thoughtworks', 'Pivotal Labs', 'Slalom', 'Accenture', 'Deloitte Digital', 'McKinsey Digital'],
            'ai': ['OpenAI', 'Anthropic', 'Cohere', 'Scale AI', 'Hugging Face', 'Stability AI', 'Midjourney', 'Runway']
        };


        // Seniority level prefixes for boolean search
        const seniorityPrefixes = {
            'entry': ['Junior', 'Entry', 'Associate', 'I ', ' I"', 'New Grad'],
            'mid': ['Mid', 'II ', ' II"', 'Level 2', 'Intermediate'],
            'senior': ['Senior', 'Sr', 'III', 'Lead', 'Level 3'],
            'staff': ['Staff', 'IV', 'Level 4', 'Principal'],
            'principal': ['Principal', 'Distinguished', 'V ', 'Fellow', 'Architect'],
            'director': ['Director', 'VP', 'Vice President', 'Head of', 'Chief', 'CTO', 'CIO', 'CDO']
        };

        // Candidate activity signals for sourcing
        const candidateSignals = {
            'open_to_work': ['"open to work"', '"looking for"', '"seeking"', '"available for"', '"open to opportunities"', '#opentowork'],
            'recent_change': ['"started new position"', '"joined"', '"new role"', '"excited to announce"', '"just started"'],
            'speaker': ['"speaker"', '"keynote"', '"conference"', '"presented at"', '"panelist"', '"tech talk"', 'TEDx'],
            'content_creator': ['"blog"', '"author"', '"writes about"', '"newsletter"', '"YouTube"', '"podcast"', '"technical writing"'],
            'open_source': ['"open source"', '"maintainer"', '"contributor"', '"GitHub"', '"OSS"', '"Apache"', '"CNCF"'],
            'layoff': ['"laid off"', '"affected by layoffs"', '"looking for next"', '#opentowork', '"recently departed"', '"exploring opportunities"']
        };

        let selectedSeniorityLevels = ['senior'];
        let selectedSignals = [];

        // Flat list of job title suggestions for autocomplete (from synonyms + templates)
        let jobTitleSuggestionsList = [];

        // Job title synonyms database
        const jobTitleSynonyms = {
            'software engineer': ['software developer', 'programmer', 'full stack developer', 'backend engineer', 'frontend engineer', 'web developer', 'full-stack engineer', 'senior software engineer', 'staff software engineer', 'principal engineer', 'platform engineer'],
            'product manager': ['product owner', 'pm', 'product lead', 'product director', 'technical product manager', 'senior product manager', 'group product manager', 'principal product manager'],
            'data scientist': ['machine learning engineer', 'ml engineer', 'data analyst', 'ai engineer', 'research scientist', 'applied scientist', 'senior data scientist', 'staff data scientist', 'product data scientist'],
            'designer': ['ux designer', 'ui designer', 'product designer', 'visual designer', 'interaction designer', 'ux/ui designer', 'senior designer', 'staff designer', 'design lead'],
            'devops': ['site reliability engineer', 'sre', 'platform engineer', 'infrastructure engineer', 'cloud engineer', 'devops engineer', 'senior devops engineer', 'staff sre'],
            'engineering manager': ['engineering lead', 'tech lead', 'development manager', 'software engineering manager', 'eng manager', 'director of engineering', 'senior engineering manager', 'vp engineering'],
            'data engineer': ['data platform engineer', 'analytics engineer', 'etl developer', 'big data engineer', 'senior data engineer', 'staff data engineer', 'data infrastructure engineer'],
            'security engineer': ['cybersecurity engineer', 'infosec engineer', 'application security engineer', 'security analyst', 'appsec engineer', 'senior security engineer', 'staff security engineer'],
            'mobile developer': ['ios developer', 'android developer', 'mobile engineer', 'react native developer', 'flutter developer', 'swift developer', 'senior mobile engineer', 'staff mobile engineer'],
            'qa engineer': ['quality assurance engineer', 'test engineer', 'sdet', 'automation engineer', 'quality engineer', 'test automation engineer', 'senior qa engineer'],
            'frontend': ['frontend engineer', 'frontend developer', 'ui developer', 'react developer', 'vue developer', 'javascript developer', 'senior frontend engineer'],
            'backend': ['backend engineer', 'backend developer', 'server engineer', 'api developer', 'senior backend engineer', 'staff backend engineer'],
            'recruiter': ['talent acquisition', 'technical recruiter', 'sourcer', 'recruiting coordinator', 'talent partner', 'senior recruiter'],
            'product analyst': ['business analyst', 'data analyst', 'analytics manager', 'senior product analyst', 'insights analyst'],
            'technical writer': ['documentation engineer', 'content developer', 'docs writer', 'senior technical writer']
        };

        // Diversity search terms
        const diversityTerms = {
            'hbcu': ['Howard University', 'Spelman College', 'Morehouse College', 'Hampton University', 'Tuskegee University', 'Florida A&M', 'HBCU'],
            'wit': ['Women Who Code', 'AnitaB.org', 'Grace Hopper', 'Girls Who Code', 'Women in Tech', 'PyLadies'],
            'bipoc': ['/dev/color', 'NSBE', 'SHPE', 'Techqueria', 'Black in Tech', 'ColorStack', 'Code2040'],
            'lgbtq': ['Lesbians Who Tech', 'Out in Tech', 'oSTEM', 'Pride in Tech', 'Queer in Tech'],
            'veterans': ['VetsinTech', 'Hiring Our Heroes', 'Operation Code', 'Military Veteran'],
            'firstgen': ['bootcamp', 'Flatiron School', 'General Assembly', 'Hack Reactor', 'App Academy', 'career changer'],
            'disability': ['Disability:IN', 'Lime Connect', 'Neurodiversity in Tech', 'AbilityNet', 'autism at work', 'disability inclusion'],
            'parents': ['Path Forward', 'reacHIRE', 'Mother Coders', 'iRelaunch', 'returnship', 'career reentry'],
            'immigrants': ['TRIEC', 'Upwardly Global', 'NPower', 'skilled immigrant', 'newcomer', 'refugee professional'],
            'indigenous': ['AISES', 'Indigenous in Tech', 'NACME', 'American Indian Science', 'First Nations', 'Indigenous tech']
        };

        // Email templates by tone
        const emailTemplates = {
            professional: (jobTitle) => `Hi [Candidate Name],

I came across your profile and was impressed by your background as a ${jobTitle}. I'm reaching out from Shopify — we're building commerce infrastructure that powers millions of businesses worldwide.

We're currently looking for talented ${jobTitle}s to join our team, and your experience caught my attention.

Would you be open to a brief conversation to learn more about what we're working on?

Best regards,
[Your Name]
Shopify`,
            casual: (jobTitle) => `Hey [Candidate Name]!

I stumbled across your profile and had to reach out — your work as a ${jobTitle} is really impressive!

We're hiring at Shopify and I think you'd be a great fit. Any chance you'd be up for a quick chat?

Cheers,
[Your Name]
Shopify`,
            enthusiastic: (jobTitle) => `Hi [Candidate Name]!

I just came across your profile and I'm genuinely excited to reach out! Your experience as a ${jobTitle} is exactly what we're looking for at Shopify.

I'd love to tell you more about the amazing projects we're working on. Would you be open to a quick call?

Best,
[Your Name]
Shopify`,
            concise: (jobTitle) => `Hi [Candidate Name],

Saw your ${jobTitle} experience — impressive background.

Shopify is hiring for this role. Interested in chatting?

[Your Name]
Shopify`
        };

        // Templates
        const templates = {
            'software-engineer': { 
                jobTitle: 'Software Engineer', 
                location: 'Toronto', 
                includeKeywords: 'Ruby, Python, Go, React, microservices', 
                excludeKeywords: 'recruiter, HR',
                customQuery: 'site:linkedin.com/in/ ("Software Engineer" OR "Senior Software Engineer" OR "Staff Software Engineer" OR "Backend Engineer" OR "Full Stack Engineer" OR "Platform Engineer") AND (Ruby OR Python OR Go OR Java OR "Ruby on Rails" OR React) AND ("system design" OR "microservices" OR "distributed systems" OR "scalable systems" OR architecture) AND (SaaS OR "e-commerce" OR fintech OR "tech company") AND ("cross-functional" OR "product development" OR mentorship OR "technical leadership")'
            },
            'product-manager': { jobTitle: 'Product Manager', location: 'Toronto', includeKeywords: 'SaaS, B2B, e-commerce', excludeKeywords: 'recruiter, sales' },
            'designer': { jobTitle: 'Product Designer', location: 'Toronto', includeKeywords: 'Figma, user research, design systems', excludeKeywords: 'graphic design, print' },
            'data-scientist': { 
                jobTitle: 'Data Scientist', 
                location: 'Toronto', 
                includeKeywords: 'Python, SQL, experimentation, A/B testing, product analytics', 
                excludeKeywords: 'recruiter, intern',
                customQuery: 'site:linkedin.com/in/ ("Data Scientist" OR "Product Data Scientist" OR "Senior Data Scientist" OR "Staff Data Scientist" OR "Product Analytics") AND (Python OR SQL) AND (experimentation OR "A/B testing" OR "product analytics" OR "metrics" OR "KPI") AND ("data storytelling" OR "stakeholder" OR "business impact" OR "product development") AND (e-commerce OR SaaS OR "tech company" OR fintech OR marketplace)'
            },
            'engineering-manager': { jobTitle: 'Engineering Manager', location: 'Toronto', includeKeywords: 'leadership, agile, team', excludeKeywords: 'recruiter, consultant' },
            'devops': { jobTitle: 'DevOps Engineer', location: 'Toronto', includeKeywords: 'Kubernetes, AWS, CI/CD', excludeKeywords: 'recruiter, junior' },
            'data-engineer': { 
                jobTitle: 'Data Engineer', 
                location: 'Toronto', 
                includeKeywords: 'SQL, Python, dbt, BigQuery, Snowflake, Airflow', 
                excludeKeywords: 'recruiter, intern',
                customQuery: 'site:linkedin.com/in/ ("Data Engineer" OR "Analytics Engineer" OR "Analytical Engineer" OR "BI Engineer" OR "Data Platform Engineer") AND (SQL AND Python) AND (dbt OR "data modeling" OR "dimensional modeling" OR "data transformation") AND (BigQuery OR Snowflake OR Redshift OR "data warehouse") AND (Airflow OR Composer OR "data pipeline" OR orchestration) AND ("data architecture" OR "Star Schema" OR Kimball OR "data quality" OR governance)'
            }
        };

        (function buildJobTitleSuggestionsList() {
            const set = new Set();
            const toTitle = (s) => s.replace(/\w\S*/g, w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase());
            Object.keys(jobTitleSynonyms).forEach(k => set.add(toTitle(k)));
            Object.values(jobTitleSynonyms).flat().forEach(v => set.add(toTitle(v)));
            Object.values(templates).forEach(t => { if (t.jobTitle) set.add(t.jobTitle); });
            jobTitleSuggestionsList = [...set].sort();
        })();

        const countryCodes = { 'us': 'United States', 'ca': 'Canada', 'uk': 'United Kingdom', 'de': 'Germany', 'fr': 'France', 'au': 'Australia', 'in': 'India', 'sg': 'Singapore', 'nl': 'Netherlands', 'ie': 'Ireland' };

        const platformSites = {
            'linkedin': 'site:linkedin.com/in/',
            'reddit': 'site:reddit.com',
            'github': 'site:github.com',
            'stackoverflow': 'site:stackoverflow.com/users/',
            'twitter': 'site:twitter.com OR site:x.com',
            'scholar': 'site:scholar.google.com/citations',
            'dribbble': 'site:dribbble.com',
            'behance': 'site:behance.net',
            'kaggle': 'site:kaggle.com',
            'wellfound': 'site:wellfound.com',
            'substack': 'site:substack.com',
            'devto': 'site:dev.to',
            'producthunt': 'site:producthunt.com',
            'polywork': 'site:polywork.com',
            'bluesky': 'site:bsky.app',
            'quora': 'site:quora.com',
            'speakerdeck': 'site:speakerdeck.com',
            'gitlab': 'site:gitlab.com',
            'bitbucket': 'site:bitbucket.org',
            'codepen': 'site:codepen.io',
            'stackexchange': 'site:stackexchange.com',
            'hackernews': 'site:news.ycombinator.com',
            'hashnode': 'site:hashnode.dev',
            'hired': 'site:hired.com',
            'dice': 'site:dice.com',
            'indeed': 'site:indeed.com',
            'glassdoor': 'site:glassdoor.com',
            'levelsfyi': 'site:levels.fyi',
            'otta': 'site:otta.com',
            'indiehackers': 'site:indiehackers.com',
            'meetup': 'site:meetup.com',
            'eventbrite': 'site:eventbrite.com',
            'twitch': 'site:twitch.tv',
            'youtube': 'site:youtube.com',
            'mastodon': 'site:mastodon.social',
            'leetcode': 'site:leetcode.com',
            'hackerrank': 'site:hackerrank.com',
            'womenwhocode': 'site:womenwhocode.com',
            'sourceforge': 'site:sourceforge.net'
        };

        const platformNames = {
            'linkedin': 'LinkedIn',
            'reddit': 'Reddit',
            'github': 'GitHub',
            'stackoverflow': 'Stack Overflow',
            'twitter': 'X / Twitter',
            'scholar': 'Google Scholar',
            'dribbble': 'Dribbble',
            'behance': 'Behance',
            'kaggle': 'Kaggle',
            'wellfound': 'Wellfound',
            'substack': 'Substack',
            'devto': 'Dev.to',
            'producthunt': 'Product Hunt',
            'polywork': 'Polywork',
            'bluesky': 'Bluesky',
            'quora': 'Quora',
            'speakerdeck': 'Speaker Deck',
            'gitlab': 'GitLab',
            'bitbucket': 'Bitbucket',
            'codepen': 'CodePen',
            'stackexchange': 'Stack Exchange',
            'hackernews': 'Hacker News',
            'hashnode': 'Hashnode',
            'hired': 'Hired',
            'dice': 'Dice',
            'indeed': 'Indeed',
            'glassdoor': 'Glassdoor',
            'levelsfyi': 'Levels.fyi',
            'otta': 'Otta',
            'indiehackers': 'Indie Hackers',
            'meetup': 'Meetup',
            'eventbrite': 'Eventbrite',
            'twitch': 'Twitch',
            'youtube': 'YouTube',
            'mastodon': 'Mastodon',
            'leetcode': 'LeetCode',
            'hackerrank': 'HackerRank',
            'womenwhocode': 'Women Who Code',
            'sourceforge': 'SourceForge'
        };

        const PRIMARY_PLATFORMS = ['linkedin', 'github', 'twitter', 'kaggle'];

        // Guide Modal Functions
        function showGuide() {
            document.getElementById('guideModal').classList.add('visible');
            document.body.style.overflow = 'hidden';
        }

        function closeGuide() {
            const modal = document.getElementById('guideModal');
            const dontShowAgain = document.getElementById('dontShowAgain').checked;
            
            if (dontShowAgain) {
                localStorage.setItem('talentScoutHideGuide', 'true');
            }
            
            modal.classList.remove('visible');
            document.body.style.overflow = '';
        }

        function closeGuideOnOverlay(event) {
            if (event.target.id === 'guideModal') {
                closeGuide();
            }
        }

        function checkFirstVisit() {
            const hideGuide = localStorage.getItem('talentScoutHideGuide');
            if (!hideGuide) {
                showGuide();
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            setupPlatformTabs();
            switchPlatform(currentPlatform);
            updateStats();
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                updateDarkModeIcon();
            }
            checkFirstVisit();
            // Initialize database and load saved searches
            await initDatabase();
            populateIntakeDropdown();
        });

        function setupPlatformTabs() {
            document.querySelectorAll('.platform-tab').forEach(tab => {
                tab.addEventListener('click', () => switchPlatform(tab.dataset.platform));
            });
            const moreSelect = document.getElementById('platformMoreSelect');
            if (moreSelect) {
                moreSelect.addEventListener('change', function() {
                    const val = this.value;
                    if (val) switchPlatform(val);
                });
            }
        }

        function switchPlatform(platform) {
            currentPlatform = platform;
            document.querySelectorAll('.platform-tab').forEach(tab => tab.classList.toggle('active', tab.dataset.platform === platform));
            const moreSelect = document.getElementById('platformMoreSelect');
            const moreWrap = document.getElementById('platformMoreWrap');
            if (moreSelect && moreWrap) {
                moreSelect.value = PRIMARY_PLATFORMS.includes(platform) ? '' : platform;
                moreWrap.classList.toggle('active', !PRIMARY_PLATFORMS.includes(platform));
            }

            const aiSection = document.getElementById('aiSearchSection');
            const searchCard = document.getElementById('searchCard');
            if (aiSection) aiSection.classList.toggle('hidden', false);
            if (searchCard) searchCard.classList.toggle('hidden', false);
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('emailSection').classList.add('hidden');

            const allPlatformFields = ['linkedin', 'reddit', 'github', 'stackoverflow', 'twitter', 'scholar', 'dribbble', 'behance', 'kaggle', 'wellfound', 'substack', 'devto', 'producthunt', 'polywork', 'bluesky', 'quora', 'speakerdeck', 'gitlab', 'bitbucket', 'codepen', 'stackexchange', 'hackernews', 'hashnode', 'hired', 'dice', 'indeed', 'glassdoor', 'levelsfyi', 'otta', 'indiehackers', 'meetup', 'eventbrite', 'twitch', 'youtube', 'mastodon', 'leetcode', 'hackerrank', 'womenwhocode', 'sourceforge'];
            allPlatformFields.forEach(p => document.querySelectorAll(`.${p}-field`).forEach(el => el.classList.add('hidden')));
            document.querySelectorAll(`.${platform}-field`).forEach(el => el.classList.remove('hidden'));

            if (platform === 'linkedin') updateSelectedSkills();

            const titles = { 'linkedin': 'Search LinkedIn Profiles', 'reddit': 'Search Reddit', 'github': 'Search GitHub Developers', 'stackoverflow': 'Search Stack Overflow Users', 'twitter': 'Search X / Twitter Profiles', 'scholar': 'Search Google Scholar Authors', 'dribbble': 'Search Dribbble Designers', 'behance': 'Search Behance Creatives', 'kaggle': 'Search Kaggle Data Scientists', 'wellfound': 'Search Wellfound (AngelList) Talent', 'substack': 'Search Substack Writers', 'devto': 'Search Dev.to Developers', 'producthunt': 'Search Product Hunt Makers', 'polywork': 'Search Polywork Profiles', 'bluesky': 'Search Bluesky Profiles', 'quora': 'Search Quora Experts', 'speakerdeck': 'Search Speaker Deck Presenters', 'gitlab': 'Search GitLab', 'bitbucket': 'Search Bitbucket', 'codepen': 'Search CodePen', 'stackexchange': 'Search Stack Exchange', 'hackernews': 'Search Hacker News', 'hashnode': 'Search Hashnode', 'hired': 'Search Hired', 'dice': 'Search Dice', 'indeed': 'Search Indeed', 'glassdoor': 'Search Glassdoor', 'levelsfyi': 'Search Levels.fyi', 'otta': 'Search Otta', 'indiehackers': 'Search Indie Hackers', 'meetup': 'Search Meetup', 'eventbrite': 'Search Eventbrite', 'twitch': 'Search Twitch', 'youtube': 'Search YouTube', 'mastodon': 'Search Mastodon', 'leetcode': 'Search LeetCode', 'hackerrank': 'Search HackerRank', 'womenwhocode': 'Search Women Who Code', 'sourceforge': 'Search SourceForge' };
            document.getElementById('platform-title').textContent = titles[platform] || 'Search Profiles';

            // If form has search terms (e.g. from "Find similar candidates"), rebuild query for this platform so the same terms work on GitHub, etc.
            const jobTitle = document.getElementById('jobTitle').value.trim();
            if (jobTitle || selectedIncludeKeywords.length > 0) {
                const newQuery = buildQuery(platform);
                if (newQuery) {
                    currentQuery = newQuery;
                    document.getElementById('queryText').value = currentQuery;
                    document.getElementById('resultsSection').classList.remove('hidden');
                    document.getElementById('emailSection').classList.remove('hidden');
                    generateEmailTemplate();
                    updateOpenButton();
                }
            }
        }

        function toggleCompanyList(element, listName) {
            element.classList.toggle('selected');
            const idx = selectedCompanyLists.indexOf(listName);
            if (idx > -1) {
                selectedCompanyLists.splice(idx, 1);
                selectedCompanies = selectedCompanies.filter(c => !companyLists[listName].includes(c));
            } else {
                selectedCompanyLists.push(listName);
                selectedCompanies = [...new Set([...selectedCompanies, ...companyLists[listName]])];
            }
            updateSelectedCompaniesDisplay();
        }

        function updateSelectedCompaniesDisplay() {
            const container = document.getElementById('selectedCompanies');
            if (selectedCompanies.length > 0) {
                container.style.display = 'flex';
                container.innerHTML = '<span style="font-size: 12px; color: var(--text-secondary); width: 100%; margin-bottom: 8px;">Selected companies (used in your boolean search):</span>' + 
                    selectedCompanies.map(c => `<span class="company-chip">${c} <span class="remove" onclick="removeCompany('${c}')">×</span></span>`).join('');
            } else {
                container.style.display = 'none';
            }
        }

        function showToast(message, durationMs) {
            const el = document.getElementById('toast');
            if (!el) return;
            el.textContent = message;
            el.classList.add('show');
            clearTimeout(showToast._tid);
            showToast._tid = setTimeout(() => {
                el.classList.remove('show');
            }, durationMs == null ? 2500 : durationMs);
        }

        function focusTargetCompaniesSection() {
            const section = document.getElementById('targetCompaniesSection');
            const content = document.getElementById('companyContent');
            const icon = document.getElementById('companyIcon');
            if (!section) return;
            if (content && !content.classList.contains('open')) {
                content.classList.add('open');
                if (icon) icon.classList.add('open');
            }
            section.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function removeCompany(company) {
            selectedCompanies = selectedCompanies.filter(c => c !== company);
            updateSelectedCompaniesDisplay();
        }

        let aiSuggestedCompanies = [];
        let techStackSuggestedCompanies = [];  // array of { name, tech } for hover tooltips
        let lastTechStackSearch = null;  // { mode: 'company'|'tech', query: string } for Refresh for more
        let lastPortfolioKeywordQuery = '';
        let lastPortfolioRelatedQuery = '';

        const INTAKE_EXTRACTIONS_KEY = 'talentScoutIntakeExtractions';
        let lastProfileAnalysis = null;

        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }

        async function handleProfilePdfUpload(ev) {
            const file = ev.target.files && ev.target.files[0];
            if (!file || file.type !== 'application/pdf') return;
            if (typeof pdfjsLib === 'undefined') {
                alert('PDF support is loading. Try again in a moment.');
                ev.target.value = '';
                return;
            }
            const textarea = document.getElementById('profilePasteInput');
            textarea.placeholder = 'Extracting text from PDF...';
            textarea.value = '';
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                const numPages = pdf.numPages;
                let fullText = '';
                for (let i = 1; i <= numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    const pageText = content.items.map(item => item.str || '').join(' ');
                    fullText += pageText + '\n';
                }
                textarea.value = fullText.trim();
                textarea.placeholder = 'Or paste profile or resume text here. If you upload a PDF, we’ll fill this for you.';
            } catch (err) {
                console.error(err);
                alert('Could not read PDF. Try pasting the text instead.');
                textarea.placeholder = 'Or paste profile or resume text here.';
            }
            ev.target.value = '';
        }

        async function handleIntakePdfUpload(ev) {
            const file = ev.target.files && ev.target.files[0];
            if (!file || file.type !== 'application/pdf') return;
            if (typeof pdfjsLib === 'undefined') {
                alert('PDF support is loading. Try again in a moment.');
                ev.target.value = '';
                return;
            }
            const textarea = document.getElementById('intakePasteInput');
            textarea.placeholder = 'Extracting text from PDF...';
            textarea.value = '';
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                const numPages = pdf.numPages;
                let fullText = '';
                for (let i = 1; i <= numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    const pageText = content.items.map(item => item.str || '').join(' ');
                    fullText += pageText + '\n';
                }
                textarea.value = fullText.trim();
                textarea.placeholder = 'Paste intake form or role description here, or upload a PDF above.';
            } catch (err) {
                console.error(err);
                alert('Could not read PDF. Try pasting the text instead.');
                textarea.placeholder = 'Paste intake form or role description here, or upload a PDF above.';
            }
            ev.target.value = '';
        }

        async function analyzeProfileFromPaste() {
            const text = document.getElementById('profilePasteInput').value.trim();
            const linkedInUrl = document.getElementById('profileLinkedInUrl').value.trim();
            const linkedInOnlyMsg = document.getElementById('profileLinkedInOnlyMessage');

            if (!text || text.length < 20) {
                if (linkedInUrl) {
                    try {
                        window.open(linkedInUrl, '_blank', 'noopener');
                    } catch (e) {}
                    linkedInOnlyMsg.classList.remove('hidden');
                    document.getElementById('profilePasteInput').focus();
                    return;
                }
                alert('Add a LinkedIn profile URL (we’ll open it so you can save as PDF), or upload a PDF / paste profile text.');
                return;
            }
            linkedInOnlyMsg.classList.add('hidden');
            const btn = document.getElementById('profileAnalyzeBtn');
            const btnText = document.getElementById('profileAnalyzeBtnText');
            const loadingEl = document.getElementById('profileAnalyzeLoading');
            const resultEl = document.getElementById('profileResultBlock');
            btn.disabled = true;
            btnText.textContent = 'Analyzing...';
            loadingEl.classList.remove('hidden');
            resultEl.classList.add('hidden');
            try {
                if (typeof quick === 'undefined' || !quick.ai) {
                    throw new Error('AI is only available when the app is deployed on Quick.');
                }
                const profileSource = linkedInUrl ? `LinkedIn profile (user provided URL for reference): ${linkedInUrl}\n\nProfile or resume content:\n` : 'Profile or resume content:\n';
                const prompt = `You are a recruiting sourcer. Analyze this candidate profile (or resume) and extract search terms to find SIMILAR high-caliber candidates.

${profileSource}
${text.slice(0, 4000)}

Respond in this exact format (use the labels as shown):
JOB_TITLE: [one primary job title that fits this profile, e.g. Senior Software Engineer]
INCLUDE_KEYWORDS: [comma-separated skills, technologies, or keywords to include in a boolean search]
TARGET_COMPANIES: [comma-separated list of 3-6 similar companies or types, or "none"]
FEEDBACK: [1-2 sentences on what makes this profile strong and what to look for in similar candidates]
BOOLEAN_QUERY: [a complete boolean search query starting with site:linkedin.com/in/ to find similar profiles. Use quotes for phrases, OR/AND, exclude recruiter/HR. Keep under 400 characters.]`;

                const response = await quick.ai.ask(prompt);
                const jobTitleMatch = response.match(/JOB_TITLE:\s*(.+?)(?=\n[A-Z_]+:|$)/s);
                const keywordsMatch = response.match(/INCLUDE_KEYWORDS:\s*(.+?)(?=\n[A-Z_]+:|$)/s);
                const companiesMatch = response.match(/TARGET_COMPANIES:\s*(.+?)(?=\n[A-Z_]+:|$)/s);
                const feedbackMatch = response.match(/FEEDBACK:\s*(.+?)(?=\n[A-Z_]+:|$)/s);
                const queryMatch = response.match(/BOOLEAN_QUERY:\s*(.+?)(?=\n|$)/s);

                const jobTitle = jobTitleMatch ? jobTitleMatch[1].trim() : '';
                const includeKeywords = keywordsMatch ? keywordsMatch[1].trim() : '';
                const targetCompaniesRaw = companiesMatch ? companiesMatch[1].trim() : '';
                const targetCompanies = targetCompaniesRaw && targetCompaniesRaw.toLowerCase() !== 'none'
                    ? targetCompaniesRaw.split(',').map(s => s.trim()).filter(Boolean)
                    : [];
                const feedback = feedbackMatch ? feedbackMatch[1].trim() : 'Profile analyzed.';
                const query = queryMatch ? queryMatch[1].trim() : '';

                lastProfileAnalysis = { jobTitle, includeKeywords, targetCompanies, feedback, query };

                document.getElementById('profileFeedback').textContent = feedback;
                document.getElementById('profileSuggestions').innerHTML =
                    (jobTitle ? `<p><strong>Job title:</strong> ${escapeHtml(jobTitle)}</p>` : '') +
                    (includeKeywords ? `<p><strong>Keywords:</strong> ${escapeHtml(includeKeywords)}</p>` : '') +
                    (targetCompanies.length ? `<p><strong>Target companies:</strong> ${escapeHtml(targetCompanies.join(', '))}</p>` : '');
                document.getElementById('profileQueryText').textContent = query || 'No query generated.';
                resultEl.classList.remove('hidden');
            } catch (err) {
                alert(err.message || 'Could not analyze profile. Try again.');
            } finally {
                btn.disabled = false;
                btnText.textContent = 'Analyze & get search terms';
                loadingEl.classList.add('hidden');
            }
        }

        function applyProfileSuggestions() {
            if (!lastProfileAnalysis) return;
            const { jobTitle, includeKeywords, targetCompanies, query } = lastProfileAnalysis;
            if (jobTitle) document.getElementById('jobTitle').value = jobTitle;
            if (includeKeywords) {
                selectedIncludeKeywords = includeKeywords.split(',').map(s => s.trim()).filter(Boolean);
                updateAcDisplay('includeKeywords');
            }
            if (targetCompanies.length) {
                targetCompanies.forEach(c => {
                    if (!selectedCompanies.includes(c)) selectedCompanies.push(c);
                });
                updateSelectedCompaniesDisplay();
            }
            if (query) {
                currentPlatform = 'linkedin';
                document.querySelectorAll('.platform-tab').forEach(tab => tab.classList.toggle('active', tab.dataset.platform === 'linkedin'));
                const allPlatformFields = ['linkedin', 'reddit', 'github', 'stackoverflow', 'twitter', 'scholar', 'dribbble', 'behance', 'kaggle', 'wellfound', 'substack', 'devto', 'producthunt', 'polywork', 'bluesky', 'quora', 'speakerdeck'];
                allPlatformFields.forEach(p => document.querySelectorAll(`.${p}-field`).forEach(el => el.classList.add('hidden')));
                document.querySelectorAll('.linkedin-field').forEach(el => el.classList.remove('hidden'));
                document.getElementById('platform-title').textContent = 'Search LinkedIn Profiles';
                currentQuery = query;
                currentJobTitle = jobTitle || '';
                displayQuery(query);
                generateEmailTemplate();
                document.getElementById('resultsSection').classList.remove('hidden');
                document.getElementById('emailSection').classList.remove('hidden');
            }
        }

        function getIntakeExtractions() {
            try {
                return JSON.parse(localStorage.getItem(INTAKE_EXTRACTIONS_KEY) || '[]');
            } catch (_) { return []; }
        }

        function saveIntakeExtraction(extraction) {
            const list = getIntakeExtractions();
            const id = extraction.id || 'id_' + Date.now();
            const withId = { ...extraction, id, createdAt: extraction.createdAt || new Date().toISOString() };
            const idx = list.findIndex(e => e.id === id);
            if (idx >= 0) list[idx] = withId; else list.unshift(withId);
            localStorage.setItem(INTAKE_EXTRACTIONS_KEY, JSON.stringify(list.slice(0, 50)));
            populateIntakeDropdown();
        }

        function populateIntakeDropdown() {
            const list = getIntakeExtractions();
            const sel = document.getElementById('intakeDropdown');
            if (!sel) return;
            const current = sel.value;
            sel.innerHTML = '<option value="">— Choose a saved extraction —</option>' +
                list.map(e => {
                    const label = (e.name || e.jobTitle || 'Unnamed') + (e.createdAt ? ' (' + new Date(e.createdAt).toLocaleDateString() + ')' : '');
                    return `<option value="${e.id}">${escapeHtml(label)}</option>`;
                }).join('');
            if (list.some(e => e.id === current)) sel.value = current;
        }

        function applyIntakeExtraction(value) {
            if (!value) return;
            const list = getIntakeExtractions();
            const e = list.find(x => x.id === value);
            if (!e) return;
            if (e.jobTitle) document.getElementById('jobTitle').value = e.jobTitle;
            if (e.includeKeywords) {
                selectedIncludeKeywords = (e.includeKeywords || '').split(',').map(s => s.trim()).filter(Boolean);
                updateAcDisplay('includeKeywords');
            }
            if (e.excludeKeywords !== undefined && e.excludeKeywords !== '') {
                selectedExcludeKeywords = (e.excludeKeywords || '').split(',').map(s => s.trim()).filter(Boolean);
                updateAcDisplay('excludeKeywords');
            }
            if (e.query) {
                const site = platformSites[currentPlatform] || platformSites['linkedin'];
                const fullQuery = e.query.toLowerCase().startsWith('site:') ? e.query : (site + ' ' + e.query);
                currentQuery = fullQuery;
                document.getElementById('queryText').value = fullQuery;
                document.getElementById('resultsSection').classList.remove('hidden');
                generateEmailTemplate();
                updateOpenButton();
            } else if (e.jobTitle || e.includeKeywords) {
                generateSearch();
            }
        }

        function parseList(value) {
            if (!value || !(value = value.trim())) return [];
            const none = /^(none|n\/a|na|no|—|–|-)$/i;
            return value
                .split(/[,;|\n]/)
                .map(s => s.trim())
                .filter(s => s && !none.test(s));
        }

        function mapSeniorityToLevels(seniorityText) {
            if (!seniorityText) return ['senior'];
            const lower = seniorityText.toLowerCase();
            if (lower.includes('entry') || lower.includes('junior')) return ['entry'];
            if (lower.includes('mid') || lower.includes('intermediate')) return ['mid'];
            if (lower.includes('staff')) return ['staff'];
            if (lower.includes('principal') || lower.includes('architect')) return ['principal'];
            if (lower.includes('director') || lower.includes('vp') || lower.includes('head of')) return ['director'];
            if (lower.includes('senior') || lower.includes('sr')) return ['senior'];
            return ['senior'];
        }

        function getAiSearchVal(response, label) {
            const re = new RegExp(label + ':\\s*([^\\n]+)(?=\\n[A-Z_]+:|$)', 'ims');
            const m = response.match(re);
            return m ? m[1].trim().replace(/\n/g, ' ').trim() : '';
        }

        async function fillSearchFromDescription() {
            const input = document.getElementById('aiSearchInput');
            const text = (input && input.value ? input.value : '').trim();
            const intakeEl = document.getElementById('aiSearchIntakeNotes');
            const teamEl = document.getElementById('aiSearchTeamContext');
            const intakeNotes = (intakeEl && intakeEl.value ? intakeEl.value : '').trim();
            const teamContext = (teamEl && teamEl.value ? teamEl.value : '').trim();
            const btn = document.getElementById('aiSearchBtn');
            const btnText = document.getElementById('aiSearchBtnText');
            const btnLoading = document.getElementById('aiSearchBtnLoading');
            const errEl = document.getElementById('aiSearchError');
            if (errEl) { errEl.classList.add('hidden'); errEl.textContent = ''; }
            if (!text) {
                if (errEl) { errEl.textContent = 'Please describe who you\'re looking for (e.g. role, company, location).'; errEl.classList.remove('hidden'); }
                return;
            }
            if (typeof quick === 'undefined' || !quick.ai) {
                if (errEl) { errEl.textContent = 'AI search is available when the app is deployed on Quick.'; errEl.classList.remove('hidden'); }
                return;
            }
            if (btn) btn.disabled = true;
            if (btnText) btnText.classList.add('hidden');
            if (btnLoading) btnLoading.classList.remove('hidden');
            try {
                const platform = currentPlatform || 'linkedin';
                let contextBlock = '\n\nUser description:\n' + text.slice(0, 2000);
                if (intakeNotes) contextBlock += '\n\n--- Intake notes ---\n' + intakeNotes.slice(0, 1500);
                if (teamContext) contextBlock += '\n\n--- Team context ---\n' + teamContext.slice(0, 1500);
                const prompt = `You are an expert recruiting sourcer building a boolean search for candidate sourcing. The user described who they want to find in plain language. Use the main description and any optional intake notes or team context below to extract every relevant detail into the structured fields.

RULES:
- Output ONLY the labels and values. No intro, no explanation. One label per line.
- Use official company names (e.g. Meta, not Facebook).
- For locations: include both city and region when relevant (e.g. San Francisco, Bay Area).
- For skills and keywords: be thorough—include 6–12 terms (technologies, methods, domain).
- For similar titles: include 4–8 job title variants people might have (e.g. "Data Scientist", "Senior Data Scientist", "ML Engineer").
- If a field doesn't apply, write "none".

Format (copy the labels exactly):

JOB_TITLE: [primary job title, e.g. Senior Data Scientist]
SIMILAR_TITLES: [comma-separated variants, e.g. Data Scientist, Senior Data Scientist, ML Engineer, Research Scientist]
LOCATIONS: [comma-separated, e.g. San Francisco, Bay Area, Oakland, California]
CURRENT_COMPANIES: [comma-separated, e.g. Meta, Google, Amazon]
SENIORITY: [one of: entry, mid, senior, staff, principal, director]
INDUSTRIES: [comma-separated, e.g. Technology, Fintech, E-commerce]
SKILLS: [comma-separated, e.g. Python, SQL, machine learning, A/B testing, experimentation]
QUALIFICATIONS: [comma-separated, e.g. PhD, 5+ years, PMP]
EDUCATION_LEVELS: [comma-separated, e.g. Bachelor's, Master's, PhD]
FIELDS_OF_STUDY: [comma-separated, e.g. Computer Science, Statistics]
SCHOOLS: [comma-separated if mentioned, or none]
YEARS_EXPERIENCE: [e.g. 5+, 3-7, or none]
INCLUDE_KEYWORDS: [comma-separated, e.g. machine learning, product analytics, SaaS]
EXCLUDE_KEYWORDS: [comma-separated, e.g. recruiter, HR, or none]
${contextBlock}`;
                const response = await quick.ai.ask(prompt);
                const jobTitle = getAiSearchVal(response, 'JOB_TITLE');
                const similarTitlesStr = getAiSearchVal(response, 'SIMILAR_TITLES');
                const locationsStr = getAiSearchVal(response, 'LOCATIONS');
                const companiesStr = getAiSearchVal(response, 'CURRENT_COMPANIES');
                const seniorityStr = getAiSearchVal(response, 'SENIORITY');
                const industriesStr = getAiSearchVal(response, 'INDUSTRIES');
                const skillsStr = getAiSearchVal(response, 'SKILLS');
                const qualStr = getAiSearchVal(response, 'QUALIFICATIONS');
                const educationStr = getAiSearchVal(response, 'EDUCATION_LEVELS');
                const fieldsStr = getAiSearchVal(response, 'FIELDS_OF_STUDY');
                const schoolsStr = getAiSearchVal(response, 'SCHOOLS');
                const yearsExpStr = getAiSearchVal(response, 'YEARS_EXPERIENCE');
                const includeStr = getAiSearchVal(response, 'INCLUDE_KEYWORDS');
                let excludeStr = getAiSearchVal(response, 'EXCLUDE_KEYWORDS');

                if (jobTitle) document.getElementById('jobTitle').value = jobTitle;
                selectedSimilarTitles = parseList(similarTitlesStr);
                if (selectedSimilarTitles.length === 0 && jobTitle) selectedSimilarTitles = [jobTitle];
                selectedLocations = parseList(locationsStr);
                selectedEmployers = parseList(companiesStr);
                selectedSeniorityLevels = mapSeniorityToLevels(seniorityStr);
                selectedSkills = parseList(skillsStr);
                selectedQualifications = parseList(qualStr);
                selectedEducationLevels = parseList(educationStr);
                selectedIncludeKeywords = parseList(includeStr);
                selectedExcludeKeywords = parseList(excludeStr);

                ['location', 'currentEmployer', 'education', 'qualifications', 'includeKeywords', 'excludeKeywords'].forEach(f => updateAcDisplay(f));
                document.querySelectorAll('.seniority-chip').forEach(chip => {
                    chip.classList.toggle('selected', selectedSeniorityLevels.includes(chip.dataset.level));
                });
                updateSelectedSkills();
                updateSelectedTitles();

                const industriesEl = document.getElementById('industries');
                if (industriesEl && parseList(industriesStr).length) industriesEl.value = parseList(industriesStr).join(', ');
                const fieldsEl = document.getElementById('fieldsOfStudy');
                if (fieldsEl && parseList(fieldsStr).length) fieldsEl.value = parseList(fieldsStr).join(', ');
                const schoolsEl = document.getElementById('schools');
                if (schoolsEl && parseList(schoolsStr).length) schoolsEl.value = parseList(schoolsStr).join(', ');
                const yearsExpEl = document.getElementById('yearsExperience');
                if (yearsExpEl && yearsExpStr && !/^\s*none\s*$/i.test(yearsExpStr)) yearsExpEl.value = yearsExpStr.trim();

                switchPlatform(platform);
                generateSearch();
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (e) {
                console.error('AI search error:', e);
                if (errEl) {
                    errEl.textContent = e.message || 'Something went wrong. Try a shorter description or try again.';
                    errEl.classList.remove('hidden');
                }
            } finally {
                if (btn) btn.disabled = false;
                if (btnText) btnText.classList.remove('hidden');
                if (btnLoading) btnLoading.classList.add('hidden');
            }
        }

        async function generateTopCandidates() {
            const input = document.getElementById('aiSearchInput');
            const text = (input && input.value ? input.value : '').trim();
            const intakeEl = document.getElementById('aiSearchIntakeNotes');
            const teamEl = document.getElementById('aiSearchTeamContext');
            const intakeNotes = (intakeEl && intakeEl.value ? intakeEl.value : '').trim();
            const teamContext = (teamEl && teamEl.value ? teamEl.value : '').trim();
            const btn = document.getElementById('aiCandidatesBtn');
            const btnText = document.getElementById('aiCandidatesBtnText');
            const btnLoading = document.getElementById('aiCandidatesBtnLoading');
            const errEl = document.getElementById('aiSearchError');
            if (errEl) { errEl.classList.add('hidden'); errEl.textContent = ''; }
            if (!text) {
                if (errEl) { errEl.textContent = 'Please describe who you\'re looking for first.'; errEl.classList.remove('hidden'); }
                return;
            }
            if (typeof quick === 'undefined' || !quick.ai) {
                if (errEl) { errEl.textContent = 'AI is available when the app is deployed on Quick.'; errEl.classList.remove('hidden'); }
                return;
            }
            if (btn) btn.disabled = true;
            if (btnText) btnText.classList.add('hidden');
            if (btnLoading) btnLoading.classList.remove('hidden');
            try {
                let context = text.slice(0, 2000);
                if (intakeNotes) context += '\n\n--- Intake notes ---\n' + intakeNotes.slice(0, 1500);
                if (teamContext) context += '\n\n--- Team context ---\n' + teamContext.slice(0, 1500);
                const systemPrompt = `You are an expert technical recruiter and talent sourcer at Shopify. Given a role description and context, generate a list of exactly 20 realistic, qualified candidate profiles that would be strong matches.

For each candidate, output EXACTLY this JSON format (no markdown, no code fences, just a raw JSON array):
[
  {
    "rank": 1,
    "name": "Full Name",
    "title": "Current Job Title",
    "company": "Current Company",
    "location": "City, Country",
    "experience_years": 8,
    "score": 94,
    "match_reasons": ["reason 1", "reason 2", "reason 3"],
    "key_skills": ["skill1", "skill2", "skill3", "skill4"],
    "linkedin_url": "https://linkedin.com/in/plausible-handle",
    "signals": "Brief 1-sentence summary of why they're a great fit",
    "risk_flags": "Any concerns or none",
    "reachout_angle": "Suggested personalized outreach angle"
  }
]

Make the candidates realistic and diverse. Include a mix of senior ICs and managers, people at FAANG and startups, different locations. Score 70-98. Order by score descending. Output only the JSON array.`;
                const response = await quick.ai.ask(systemPrompt + '\n\nRole and context:\n\n' + context);
                let parsed = [];
                try {
                    const jsonMatch = response.match(/\[[\s\S]*\]/);
                    if (jsonMatch) parsed = JSON.parse(jsonMatch[0]);
                } catch (e) {
                    const cleaned = response.replace(/```json?\n?/g, '').replace(/```/g, '').trim();
                    const m = cleaned.match(/\[[\s\S]*\]/);
                    if (m) parsed = JSON.parse(m[0]);
                }
                aiGeneratedCandidates = Array.isArray(parsed) ? parsed : [];
                renderCandidatesTable();
                document.getElementById('candidatesSection').classList.remove('hidden');
                document.getElementById('candidatesSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
                if (aiGeneratedCandidates.length === 0) showToast('No candidates could be parsed. Try again or add more context.');
            } catch (e) {
                console.error('Generate candidates error:', e);
                if (errEl) { errEl.textContent = e.message || 'Something went wrong. Try again.'; errEl.classList.remove('hidden'); }
            } finally {
                if (btn) btn.disabled = false;
                if (btnText) btnText.classList.remove('hidden');
                if (btnLoading) btnLoading.classList.add('hidden');
            }
        }

        function renderCandidatesTable() {
            const tbody = document.getElementById('candidatesTableBody');
            const countEl = document.getElementById('candidatesCount');
            if (!tbody) return;
            countEl.textContent = aiGeneratedCandidates.length ? `(${aiGeneratedCandidates.length})` : '';
            tbody.innerHTML = aiGeneratedCandidates.map(c => {
                const score = c.score != null ? Number(c.score) : 0;
                const scoreClass = score >= 90 ? 'high' : score >= 75 ? 'mid' : 'low';
                const link = (c.linkedin_url || '').trim();
                return '<tr><td>' + (c.rank || '') + '</td><td>' + escapeHtml(String(c.name || '')) + '</td><td>' + escapeHtml(String(c.title || '')) + '</td><td>' + escapeHtml(String(c.company || '')) + '</td><td>' + escapeHtml(String(c.location || '')) + '</td><td><span class="candidate-score ' + scoreClass + '">' + score + '</span></td><td>' + (link ? '<a href="' + escapeHtml(link) + '" target="_blank" rel="noopener">Profile</a>' : '—') + '</td></tr>';
            }).join('');
        }

        function exportCandidatesCSV() {
            if (!aiGeneratedCandidates.length) {
                showToast('No candidates to export. Generate top candidates first.');
                return;
            }
            const headers = ['Rank', 'Name', 'Title', 'Company', 'Location', 'Experience (yrs)', 'Score', 'Key Skills', 'Match Reasons', 'LinkedIn', 'Signals', 'Outreach Angle'];
            const rows = aiGeneratedCandidates.map(c => [
                c.rank, c.name, c.title, c.company, c.location, c.experience_years, c.score,
                (c.key_skills || []).join('; '), (c.match_reasons || []).join('; '), c.linkedin_url || '', c.signals || '', c.reachout_angle || ''
            ]);
            const csv = [headers, ...rows].map(r => r.map(v => '"' + String(v ?? '').replace(/"/g, '""') + '"').join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'talent-scout-candidates-' + Date.now() + '.csv';
            a.click();
            URL.revokeObjectURL(url);
            showToast('Exported ' + aiGeneratedCandidates.length + ' candidates to CSV');
        }

        function sendCandidatesToSlack() {
            if (!aiGeneratedCandidates.length) {
                showToast('No candidates to send. Generate top candidates first.');
                return;
            }
            if (typeof quick === 'undefined' || !quick.slack) {
                showToast('Slack is available when the app is deployed on Quick.');
                return;
            }
            const slackId = (quick.id && quick.id.slackId) || (quick.identity && quick.identity.slackId) || (quick.id && quick.id.userId);
            if (!slackId) {
                showToast('Could not find your Slack ID. Make sure you’re signed in on Quick.');
                return;
            }
            try {
                const top5 = aiGeneratedCandidates.slice(0, 5);
                const table = top5.map((c, i) => [i + 1, c.name || '', c.title || '', c.company || '', (c.score != null ? c.score : '')]);
                quick.slack.sendTable(slackId, 'Talent Scout – Top ' + top5.length + ' candidates', ['#', 'Name', 'Title', 'Company', 'Score'], table);
                showToast('Sent top ' + top5.length + ' to your Slack DMs!');
            } catch (e) {
                showToast('Failed to send to Slack: ' + (e.message || e));
            }
        }

        async function extractFromIntakeForm() {
            const text = document.getElementById('intakePasteInput').value.trim();
            if (!text || text.length < 30) {
                alert('Paste intake form or role description text (at least a few sentences) to extract keywords.');
                return;
            }
            const btn = document.getElementById('intakeExtractBtn');
            const btnText = document.getElementById('intakeExtractBtnText');
            const loadingEl = document.getElementById('intakeExtractLoading');
            btn.disabled = true;
            btnText.textContent = 'Extracting...';
            loadingEl.classList.remove('hidden');
            try {
                if (typeof quick === 'undefined' || !quick.ai) {
                    throw new Error('AI is only available when the app is deployed on Quick.');
                }
                const aiPrompt = `You are a recruiting sourcer. Below is text from a hiring intake form or role description. Extract search-ready fields for a boolean candidate search.

Respond in this exact format (use the labels as shown):
JOB_TITLE: [primary job title, e.g. Senior Software Engineer]
INCLUDE_KEYWORDS: [comma-separated skills, technologies, keywords to include]
EXCLUDE_KEYWORDS: [comma-separated terms to exclude, e.g. recruiter, HR, or "none"]
BOOLEAN_QUERY: [a short boolean search snippet: key phrases in quotes, OR/AND, relevant tech. No site: operator. Under 300 characters.]

Intake form / role description:
${text.slice(0, 3500)}`;

                const response = await quick.ai.ask(aiPrompt);
                const jobTitleMatch = response.match(/JOB_TITLE:\s*(.+?)(?=\n[A-Z_]+:|$)/s);
                const includeMatch = response.match(/INCLUDE_KEYWORDS:\s*(.+?)(?=\n[A-Z_]+:|$)/s);
                const excludeMatch = response.match(/EXCLUDE_KEYWORDS:\s*(.+?)(?=\n[A-Z_]+:|$)/s);
                const queryMatch = response.match(/BOOLEAN_QUERY:\s*(.+?)(?=\n|$)/s);

                const jobTitle = jobTitleMatch ? jobTitleMatch[1].trim() : '';
                const includeKeywords = includeMatch ? includeMatch[1].trim() : '';
                let excludeKeywords = excludeMatch ? excludeMatch[1].trim() : '';
                if (excludeKeywords.toLowerCase() === 'none') excludeKeywords = '';
                const query = queryMatch ? queryMatch[1].trim() : '';

                document.getElementById('jobTitle').value = jobTitle;
                selectedIncludeKeywords = includeKeywords ? includeKeywords.split(',').map(s => s.trim()).filter(Boolean) : [];
                selectedExcludeKeywords = excludeKeywords ? excludeKeywords.split(',').map(s => s.trim()).filter(Boolean) : [];
                updateAcDisplay('includeKeywords');
                updateAcDisplay('excludeKeywords');
                if (jobTitle || selectedIncludeKeywords.length) generateSearch();
                if (query) {
                    currentQuery = (platformSites[currentPlatform] || platformSites['linkedin']) + ' ' + query;
                    document.getElementById('queryText').value = currentQuery;
                    document.getElementById('resultsSection').classList.remove('hidden');
                    generateEmailTemplate();
                    updateOpenButton();
                }

                const name = window.prompt('Save this extraction for later? Enter a name (e.g. "Backend Engineer - Q1") or Cancel to skip.', jobTitle || 'Intake extraction');
                if (name != null && name.trim()) {
                    saveIntakeExtraction({ id: 'id_' + Date.now(), name: name.trim(), jobTitle, includeKeywords, excludeKeywords, query, createdAt: new Date().toISOString() });
                }
            } catch (err) {
                alert(err.message || 'Could not extract from intake. Try again.');
            } finally {
                btn.disabled = false;
                btnText.textContent = 'Extract keywords & apply to search';
                loadingEl.classList.add('hidden');
            }
        }

        function toggleIntakeSection() {
            document.getElementById('intakeContent').classList.toggle('open');
            document.getElementById('intakeIcon').classList.toggle('open');
        }

        function copyProfileQuery(ev) {
            if (!lastProfileAnalysis || !lastProfileAnalysis.query) return;
            navigator.clipboard.writeText(lastProfileAnalysis.query).then(() => {
                const btn = ev && ev.target ? ev.target : document.querySelector('.profile-result-actions .btn-secondary');
                if (btn) {
                    const orig = btn.textContent;
                    btn.textContent = 'Copied!';
                    setTimeout(() => { btn.textContent = orig; }, 2000);
                }
            });
        }

        async function getAiCompanySuggestions() {
            const promptInput = document.getElementById('companyAiPrompt').value.trim();
            if (!promptInput) {
                alert('Please describe what kind of companies you\'re looking for.');
                return;
            }
            const btn = document.getElementById('companyAiBtn');
            const btnText = document.getElementById('companyAiBtnText');
            const loadingEl = document.getElementById('companyAiLoading');
            const resultsEl = document.getElementById('companyAiResults');
            btn.disabled = true;
            btnText.textContent = 'Finding...';
            loadingEl.classList.remove('hidden');
            resultsEl.classList.add('hidden');
            try {
                if (typeof quick === 'undefined' || !quick.ai) {
                    throw new Error('AI is only available when the app is deployed on Quick.');
                }
                const systemPrompt = `You are a recruiting sourcer helping identify target companies for candidate sourcing.
Given the user's description, suggest 10–15 well-known companies (or types of companies) that would be good targets.
Return ONLY a comma-separated list of company names. No numbering, no explanation, no bullet points.
Example format: Stripe, Square, Plaid, Brex, Ramp, Mercury, Chime`;
                const userPrompt = `What companies should we target for this search? ${promptInput}`;
                const fullPrompt = `${systemPrompt}\n\n${userPrompt}`;
                const response = await quick.ai.ask(fullPrompt);
                const names = response.split(/[,،、;|\n]/).map(s => s.trim()).filter(s => s.length > 0 && s.length < 80);
                aiSuggestedCompanies = [...new Set(names)];
                const chipsEl = document.getElementById('companyAiResultsChips');
                chipsEl.innerHTML = aiSuggestedCompanies.map(c => 
                    `<div class="company-ai-chip" data-company="${c.replace(/"/g, '&quot;')}"><span>${escapeHtml(c)}</span><button type="button" class="add-company-btn" onclick="addSingleAiCompany(this)">Add</button></div>`
                ).join('');
                document.getElementById('companyAiResults').classList.remove('hidden');
            } catch (err) {
                alert(err.message || 'Could not get AI suggestions. Try again or use the preset lists below.');
            } finally {
                btn.disabled = false;
                btnText.textContent = 'Get company suggestions';
                loadingEl.classList.add('hidden');
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function addSingleAiCompany(btn) {
            const chip = btn.closest('[data-company]');
            if (!chip) return;
            const name = chip.getAttribute('data-company').replace(/&quot;/g, '"');
            if (!selectedCompanies.includes(name)) {
                selectedCompanies.push(name);
                updateSelectedCompaniesDisplay();
            }
        }

        function addAllAiCompanies() {
            aiSuggestedCompanies.forEach(c => {
                if (!selectedCompanies.includes(c)) selectedCompanies.push(c);
            });
            updateSelectedCompaniesDisplay();
        }

        async function getTechStackCompanySuggestions(isRefresh) {
            const companyInput = document.getElementById('techStackCompanyInput').value.trim();
            if (!companyInput && !isRefresh) {
                alert('Please enter a company name to find others with a similar tech stack.');
                return;
            }
            const query = companyInput || (lastTechStackSearch && lastTechStackSearch.mode === 'company' ? lastTechStackSearch.query : '');
            if (!query) return;
            const btn = document.getElementById('techStackBtn');
            const btnText = document.getElementById('techStackBtnText');
            const loadingEl = document.getElementById('techStackLoading');
            const resultsEl = document.getElementById('techStackResults');
            const otherBtn = document.getElementById('techByTechBtn');
            btn.disabled = true;
            if (otherBtn) otherBtn.disabled = true;
            btnText.textContent = 'Finding...';
            loadingEl.textContent = isRefresh ? 'Finding more companies (different set)...' : 'Finding companies with similar tech stack...';
            loadingEl.classList.remove('hidden');
            resultsEl.classList.add('hidden');
            try {
                if (typeof quick === 'undefined' || !quick.ai) {
                    throw new Error('AI is only available when the app is deployed on Quick.');
                }
                const avoidList = (isRefresh && techStackSuggestedCompanies.length) ? techStackSuggestedCompanies.map(c => c.name).join(', ') : '';
                const systemPrompt = `You are a recruiting sourcer. Given a company name, identify 10–15 OTHER companies that use a similar tech stack. Prioritize companies that recruiters often overlook: scale-ups, product-led tech companies, strong regional players, and great engineering cultures—NOT the usual FAANG/mega-cap list (avoid defaulting to Google, Meta, Amazon, Apple, Microsoft, Netflix unless the reference company is in that tier).

Think: Canva, Atlassian, Figma, Notion, Linear, Vercel, Zapier, GitLab, HashiCorp, Datadog, Twilio, Okta, Snowflake, MongoDB, Elastic, etc. For EACH company, list key technologies (languages, frameworks, infrastructure, tools).

Return one company per line. Format each line exactly as: CompanyName | Tech1, Tech2, Tech3
Example:
Figma | TypeScript, WebAssembly, C++, React
Linear | TypeScript, Go, React, PostgreSQL
Vercel | Node.js, React, Next.js, Edge

No numbering, no extra explanation. Only lines in that format.`;
                const excludeLine = avoidList ? `\n\nIMPORTANT: Return a DIFFERENT set. Do NOT include any of these (user already saw them): ${avoidList}. Suggest other companies instead.` : '';
                const userPrompt = `Find companies with a similar tech stack to: ${query}. For each company, include the technologies they use.${excludeLine}`;
                const response = await quick.ai.ask(`${systemPrompt}\n\n${userPrompt}`);
                lastTechStackSearch = { mode: 'company', query };
                techStackSuggestedCompanies = [];
                response.split(/\n/).forEach(line => {
                    const lineTrim = line.trim();
                    if (!lineTrim) return;
                    const pipeIdx = lineTrim.indexOf(' | ');
                    if (pipeIdx > 0) {
                        const name = lineTrim.slice(0, pipeIdx).trim();
                        const tech = lineTrim.slice(pipeIdx + 3).trim();
                        if (name.length > 0 && name.length < 80) techStackSuggestedCompanies.push({ name, tech });
                    } else {
                        const name = lineTrim.replace(/^[-*•]\s*/, '').trim();
                        if (name.length > 0 && name.length < 80) techStackSuggestedCompanies.push({ name, tech: '' });
                    }
                });
                const chipsEl = document.getElementById('techStackResultsChips');
                chipsEl.innerHTML = techStackSuggestedCompanies.map(c => {
                    const techHtml = c.tech ? `<span class="chip-tech-tooltip"><strong>Technologies</strong>${escapeHtml(c.tech)}</span>` : '';
                    const chipClass = c.tech ? 'company-ai-chip chip-with-tech' : 'company-ai-chip';
                    return `<div class="${chipClass}" data-company="${c.name.replace(/"/g, '&quot;')}"><span>${escapeHtml(c.name)}</span>${techHtml}<button type="button" class="add-company-btn" onclick="addSingleTechStackCompany(this)">Add</button></div>`;
                }).join('');
                document.getElementById('techStackResults').classList.remove('hidden');
            } catch (err) {
                alert(err.message || 'Could not get tech stack suggestions. Make sure the app is on Quick and try again.');
            } finally {
                btn.disabled = false;
                if (otherBtn) otherBtn.disabled = false;
                btnText.textContent = 'Find similar companies';
                loadingEl.classList.add('hidden');
            }
        }

        async function getCompaniesByTechSuggestions(isRefresh) {
            const techInput = document.getElementById('techStackTechInput').value.trim();
            if (!techInput && !isRefresh) {
                alert('Please enter technologies (e.g. Ruby, Python, React) to find companies that use them.');
                return;
            }
            const techList = techInput ? techInput.split(/[,،、;\n]+/).map(s => s.trim()).filter(Boolean) : (lastTechStackSearch && lastTechStackSearch.mode === 'tech' ? lastTechStackSearch.query.split(/[,،、;\n]+/).map(s => s.trim()).filter(Boolean) : []);
            if (techList.length === 0 && !isRefresh) {
                alert('Please enter at least one technology.');
                return;
            }
            if (techList.length === 0) return;
            const btn = document.getElementById('techByTechBtn');
            const btnText = document.getElementById('techByTechBtnText');
            const loadingEl = document.getElementById('techStackLoading');
            const resultsEl = document.getElementById('techStackResults');
            const otherBtn = document.getElementById('techStackBtn');
            btn.disabled = true;
            if (otherBtn) otherBtn.disabled = true;
            btnText.textContent = 'Finding...';
            loadingEl.textContent = isRefresh ? 'Finding more companies (different set)...' : 'Finding companies that use this tech...';
            loadingEl.classList.remove('hidden');
            resultsEl.classList.add('hidden');
            try {
                if (typeof quick === 'undefined' || !quick.ai) {
                    throw new Error('AI is only available when the app is deployed on Quick.');
                }
                const techStr = techList.join(', ');
                const avoidList = (isRefresh && techStackSuggestedCompanies.length) ? techStackSuggestedCompanies.map(c => c.name).join(', ') : '';
                const systemPrompt = `You are a recruiting sourcer. The user wants companies that use these technologies: ${techStr}.

List 10–15 companies that use these technologies. Prioritize companies recruiters often overlook: scale-ups, product-led tech, strong regional players—NOT the usual FAANG/mega-cap default (avoid defaulting to Google, Meta, Amazon, Apple, Microsoft, Netflix unless they're clearly top of mind for that stack).

Think: Stripe, Shopify, Figma, Notion, Linear, Vercel, Zapier, GitLab, HashiCorp, Datadog, Twilio, Okta, MongoDB, Elastic, etc. For EACH company, list key technologies they use.

Return one company per line. Format each line exactly as: CompanyName | Tech1, Tech2, Tech3
Example:
Vercel | Node.js, React, Next.js, AWS
Figma | TypeScript, WebAssembly, React
Linear | TypeScript, Go, React, PostgreSQL

No numbering, no extra explanation. Only lines in that format.`;
                const excludeLine = avoidList ? `\n\nIMPORTANT: Return a DIFFERENT set. Do NOT include any of these (user already saw them): ${avoidList}. Suggest other companies instead.` : '';
                const userPrompt = `Find companies that use: ${techStr}. For each company, include the technologies they use.${excludeLine}`;
                const response = await quick.ai.ask(`${systemPrompt}\n\n${userPrompt}`);
                lastTechStackSearch = { mode: 'tech', query: techStr };
                techStackSuggestedCompanies = [];
                response.split(/\n/).forEach(line => {
                    const lineTrim = line.trim();
                    if (!lineTrim) return;
                    const pipeIdx = lineTrim.indexOf(' | ');
                    if (pipeIdx > 0) {
                        const name = lineTrim.slice(0, pipeIdx).trim();
                        const tech = lineTrim.slice(pipeIdx + 3).trim();
                        if (name.length > 0 && name.length < 80) techStackSuggestedCompanies.push({ name, tech });
                    } else {
                        const name = lineTrim.replace(/^[-*•]\s*/, '').trim();
                        if (name.length > 0 && name.length < 80) techStackSuggestedCompanies.push({ name, tech: '' });
                    }
                });
                const chipsEl = document.getElementById('techStackResultsChips');
                chipsEl.innerHTML = techStackSuggestedCompanies.map(c => {
                    const techHtml = c.tech ? `<span class="chip-tech-tooltip"><strong>Technologies</strong>${escapeHtml(c.tech)}</span>` : '';
                    const chipClass = c.tech ? 'company-ai-chip chip-with-tech' : 'company-ai-chip';
                    return `<div class="${chipClass}" data-company="${c.name.replace(/"/g, '&quot;')}"><span>${escapeHtml(c.name)}</span>${techHtml}<button type="button" class="add-company-btn" onclick="addSingleTechStackCompany(this)">Add</button></div>`;
                }).join('');
                document.getElementById('techStackResults').classList.remove('hidden');
            } catch (err) {
                alert(err.message || 'Could not get suggestions. Make sure the app is on Quick and try again.');
            } finally {
                btn.disabled = false;
                if (otherBtn) otherBtn.disabled = false;
                btnText.textContent = 'Find companies';
                loadingEl.classList.add('hidden');
            }
        }

        function refreshTechStackSuggestions() {
            if (!lastTechStackSearch) return;
            if (lastTechStackSearch.mode === 'company') getTechStackCompanySuggestions(true);
            else getCompaniesByTechSuggestions(true);
        }

        function addSingleTechStackCompany(btn) {
            const chip = btn.closest('[data-company]');
            if (!chip) return;
            const name = chip.getAttribute('data-company').replace(/&quot;/g, '"');
            if (!selectedCompanies.includes(name)) {
                selectedCompanies.push(name);
                updateSelectedCompaniesDisplay();
                focusTargetCompaniesSection();
                showToast('Added to Target Companies');
            }
        }

        function addAllTechStackCompanies() {
            let added = 0;
            techStackSuggestedCompanies.forEach(c => {
                const name = typeof c === 'string' ? c : c.name;
                if (!selectedCompanies.includes(name)) {
                    selectedCompanies.push(name);
                    added++;
                }
            });
            updateSelectedCompaniesDisplay();
            if (added > 0) {
                focusTargetCompaniesSection();
                showToast(added === 1 ? 'Added to Target Companies' : added + ' companies added to Target Companies');
            }
        }

        function toggleTechStackSection() {
            document.getElementById('techStackContent').classList.toggle('open');
            document.getElementById('techStackIcon').classList.toggle('open');
        }

        function togglePortfolioSection() {
            document.getElementById('portfolioSimilarContent').classList.toggle('open');
            document.getElementById('portfolioSimilarIcon').classList.toggle('open');
        }

        function toggleExperience() {
            document.getElementById('experienceContent').classList.toggle('open');
            document.getElementById('experienceIcon').classList.toggle('open');
        }
        function toggleEducation() {
            document.getElementById('educationContent').classList.toggle('open');
            document.getElementById('educationIcon').classList.toggle('open');
        }

        async function findSimilarPortfolios() {
            const raw = document.getElementById('portfolioUrlsInput').value.trim();
            const urls = raw.split(/\n/).map(s => s.trim()).filter(s => s.length > 0 && /^https?:\/\//i.test(s));
            if (urls.length === 0) {
                alert('Please paste at least one portfolio URL (e.g. Dribbble, Behance, or a personal site).');
                return;
            }
            const btn = document.getElementById('portfolioSimilarBtn');
            const btnText = document.getElementById('portfolioSimilarBtnText');
            const loadingEl = document.getElementById('portfolioSimilarLoading');
            const resultEl = document.getElementById('portfolioSimilarResult');
            btn.disabled = true;
            btnText.textContent = 'Finding...';
            loadingEl.classList.remove('hidden');
            resultEl.classList.add('hidden');
            try {
                const urlList = urls.join('\n');
                const prompt = `You are helping recruiters find designer portfolios similar to people they've already hired.

Portfolio URLs of designers we hired (we cannot fetch page content; use domain and path hints only):
${urlList}

From these URLs, infer the type of designers (e.g. product design, brand, motion, UI/UX) and portfolio platforms (Dribbble, Behance, etc.). Generate a single Google boolean search query to find similar designer portfolios. Use site: operators where useful (e.g. site:dribbble.com site:behance.net) and keywords for roles/skills. Keep the query concise and pasteable.

Reply with ONLY the search query, no explanation or quotes.`;
                const response = await quick.ai.ask(prompt);
                const keywordQuery = (response || '').trim().replace(/^["']|["']$/g, '');
                lastPortfolioKeywordQuery = keywordQuery;

                const relatedParts = urls.map(u => `related:${u}`).filter(Boolean);
                lastPortfolioRelatedQuery = relatedParts.join(' OR ');

                document.getElementById('portfolioSimilarQuery').textContent = keywordQuery || '(no query generated)';
                document.getElementById('portfolioRelatedQuery').textContent = lastPortfolioRelatedQuery || '';
                resultEl.classList.remove('hidden');
            } catch (e) {
                console.error(e);
                alert('Could not generate portfolio search. Check the console or try again.');
            } finally {
                btn.disabled = false;
                btnText.textContent = 'Find similar portfolios';
                loadingEl.classList.add('hidden');
            }
        }

        function openPortfolioSearch(type) {
            const query = type === 'related' ? lastPortfolioRelatedQuery : lastPortfolioKeywordQuery;
            if (!query) return;
            const encoded = encodeURIComponent(query);
            window.open('https://www.google.com/search?q=' + encoded, '_blank', 'noopener');
        }

        function updateSearchTips() {
            // Search Quality Tips section removed
        }

        function onTemplateSelect(selectEl) {
            const value = selectEl.value;
            if (value) loadTemplate(value);
        }

        function loadTemplate(templateName) {
            const template = templates[templateName];
            if (!template) return;
            document.getElementById('jobTitle').value = template.jobTitle || '';
            selectedLocations = template.location ? [template.location] : [];
            selectedIncludeKeywords = template.includeKeywords ? template.includeKeywords.split(',').map(s => s.trim()).filter(Boolean) : [];
            selectedExcludeKeywords = template.excludeKeywords ? template.excludeKeywords.split(',').map(s => s.trim()).filter(Boolean) : [];
            ['location', 'includeKeywords', 'excludeKeywords'].forEach(f => updateAcDisplay(f));
            updateSearchTips();
            const selectEl = document.getElementById('quickTemplatesSelect');
            if (selectEl) selectEl.value = templateName;
            
            // Use custom query if available, otherwise generate normally
            if (template.customQuery) {
                currentJobTitle = template.jobTitle || '';
                currentQuery = template.customQuery;
                displayQuery(currentQuery);
                generateEmailTemplate();
                searchCount++;
                localStorage.setItem('talentScoutSearchCount', searchCount.toString());
                updateStats();
            } else {
                generateSearch();
            }
        }

        function getSelectedDiversityTerms() {
            const selected = [];
            document.querySelectorAll('.diversity-checkbox:checked').forEach(checkbox => {
                const terms = diversityTerms[checkbox.value];
                if (terms) selected.push(...terms);
            });
            return selected;
        }

        function toggleDiversityOption(element) {
            element.classList.toggle('selected');
        }

        function toggleSeniority(element) {
            const level = element.dataset.level;
            element.classList.toggle('selected');
            
            if (element.classList.contains('selected')) {
                if (!selectedSeniorityLevels.includes(level)) {
                    selectedSeniorityLevels.push(level);
                }
            } else {
                selectedSeniorityLevels = selectedSeniorityLevels.filter(l => l !== level);
            }
            updateSearchTips();
        }

        function toggleSignalsSection() {
            const content = document.getElementById('signalsContent');
            const icon = document.getElementById('signalsIcon');
            content.classList.toggle('open');
            icon.classList.toggle('open');
        }

        function toggleSignalOption(element) {
            element.classList.toggle('selected');
            const checkbox = element.querySelector('.signal-checkbox');
            const value = checkbox.value;
            
            if (element.classList.contains('selected')) {
                checkbox.checked = true;
                if (!selectedSignals.includes(value)) {
                    selectedSignals.push(value);
                }
            } else {
                checkbox.checked = false;
                selectedSignals = selectedSignals.filter(s => s !== value);
            }
        }

        function getSelectedSignalTerms() {
            const terms = [];
            selectedSignals.forEach(signal => {
                if (candidateSignals[signal]) {
                    terms.push(...candidateSignals[signal]);
                }
            });
            return terms;
        }

        // Specialized GitHub search builder - uses GitHub's native search, not Google X-Ray
        // GitHub's search is much more effective at finding developer profiles
        function buildGitHubQuery(jobTitle, location, skills, includeKeywords, excludeKeywords) {
            // Build GitHub native search query using their search qualifiers
            // See: https://docs.github.com/en/search-github/searching-on-github/searching-users
            let queryParts = [];
            queryParts.push('type:user'); // Only search for users, not orgs
            
            // Add hireable filter if checked
            const githubHireable = document.getElementById('githubHireable')?.checked;
            if (githubHireable) {
                queryParts.push('is:hireable');
            }
            
            // Add programming languages/skills using GitHub's language qualifier
            if (skills) {
                const skillList = skills.split(',').map(s => s.trim()).filter(s => s);
                // GitHub supports language: qualifier for user's repo languages
                skillList.forEach(skill => {
                    queryParts.push(`language:${skill.replace(/\s+/g, '-')}`);
                });
            }
            
            // Add location using GitHub's location qualifier
            if (location) {
                queryParts.push(`location:"${location}"`);
            }
            
            // Handle countries - use location qualifier
            const countrySelect = document.getElementById('country');
            const selectedCountries = Array.from(countrySelect.selectedOptions).map(opt => opt.value);
            if (selectedCountries.length > 0 && !location) {
                // Only add country if no specific location
                const countryNames = selectedCountries
                    .filter(c => countryCodes[c])
                    .map(c => countryCodes[c]);
                if (countryNames.length === 1) {
                    queryParts.push(`location:"${countryNames[0]}"`);
                } else if (countryNames.length > 1) {
                    // GitHub search doesn't support OR for location, use first one
                    queryParts.push(`location:"${countryNames[0]}"`);
                }
            }
            
            // Add job title / bio keywords using fullname or general search
            if (jobTitle) {
                // GitHub searches user bio, name, and readme with plain text
                queryParts.push(`"${jobTitle}"`);
            }
            
            // Add include keywords to search bio/readme
            if (includeKeywords) {
                const keywords = includeKeywords.split(',').map(k => k.trim()).filter(k => k);
                keywords.forEach(kw => {
                    queryParts.push(`"${kw}"`);
                });
            }
            
            // Add repos qualifier based on activity preference
            const githubActiveContributor = document.getElementById('githubActiveContributor')?.checked;
            if (githubActiveContributor) {
                queryParts.push('repos:>10'); // Users with more than 10 repos
                queryParts.push('followers:>5'); // With some followers
            }
            
            // Add selected companies to search (company field or bio)
            if (selectedCompanies.length > 0) {
                // Take first company for GitHub search
                queryParts.push(`"${selectedCompanies[0]}"`);
            }
            
            const query = queryParts.join(' ');
            
            // Store the GitHub-native query for display, but we'll generate a special URL
            return query;
        }
        
        // Check if current platform uses native search (not Google)
        function usesNativeSearch(platform) {
            return platform === 'github';
        }
        
        // Get the native search URL for platforms that support it
        function getNativeSearchUrl(platform, query) {
            if (platform === 'github') {
                // GitHub's native user search URL
                return `https://github.com/search?q=${encodeURIComponent(query)}&type=users`;
            }
            return null;
        }

        function buildQuery(platform) {
            const jobTitle = document.getElementById('jobTitle').value.trim();
            const skills = document.getElementById('skills').value.trim();

            // Special handling for GitHub to find developer profiles like Octohunt
            if (platform === 'github') {
                const location = selectedLocations.length > 0 ? selectedLocations.join(' ') : '';
                const includeKeywords = selectedIncludeKeywords.length > 0 ? selectedIncludeKeywords.join(',') : '';
                const excludeKeywords = selectedExcludeKeywords.length > 0 ? selectedExcludeKeywords.join(',') : '';
                return buildGitHubQuery(jobTitle, location, skills, includeKeywords, excludeKeywords);
            }

            let query = platformSites[platform] || platformSites['linkedin'];

            // Use job title input and/or selected titles from dropdown (multiple titles always included)
            if (jobTitle || selectedSimilarTitles.length > 0) {
                let titles = [];
                const baseTitle = jobTitle || selectedSimilarTitles[0] || '';

                if (jobTitle) {
                    // Apply seniority level prefixes to the typed title
                    if (selectedSeniorityLevels.length > 0) {
                    selectedSeniorityLevels.forEach(level => {
                        const prefixes = seniorityPrefixes[level] || [];
                        // Add the base title with seniority prefixes
                        if (level === 'mid') {
                            // Mid-level often doesn't have a prefix, just the title
                            titles.push(`"${baseTitle}"`);
                        }
                        prefixes.forEach(prefix => {
                            // Handle prefixes that go before vs after
                            if (prefix.endsWith(' ')) {
                                titles.push(`"${prefix}${baseTitle}"`);
                            } else if (prefix.startsWith(' ')) {
                                titles.push(`"${baseTitle}${prefix}"`);
                            } else {
                                titles.push(`"${prefix} ${baseTitle}"`);
                            }
                        });
                    });
                } else {
                    titles.push(`"${baseTitle}"`);
                }
                
                if (document.getElementById('includeSimilar').checked) {
                    const lowerTitle = jobTitle.toLowerCase();
                    let foundMatch = false;
                    
                    // Check each synonym group for matches
                    for (const [key, synonyms] of Object.entries(jobTitleSynonyms)) {
                        // Check if entered title contains the key OR key contains the entered title
                        // Also check if any synonym matches
                        const keyMatches = lowerTitle.includes(key) || key.includes(lowerTitle);
                        const synonymMatches = synonyms.some(s => 
                            lowerTitle.includes(s.toLowerCase()) || s.toLowerCase().includes(lowerTitle)
                        );
                        
                        if (keyMatches || synonymMatches) {
                            // Add the key if not already present
                            if (!titles.includes(`"${key}"`)) titles.push(`"${key}"`);
                            // Add all synonyms
                            synonyms.forEach(syn => { 
                                if (!titles.includes(`"${syn}"`)) titles.push(`"${syn}"`); 
                            });
                            foundMatch = true;
                            break;
                        }
                    }
                    
                    // If no match found, add common variations based on selected seniority
                    if (!foundMatch && jobTitle.length > 3 && selectedSeniorityLevels.length === 0) {
                        const variations = [
                            `Senior ${jobTitle}`,
                            `Staff ${jobTitle}`,
                            `Lead ${jobTitle}`
                        ];
                        variations.forEach(v => {
                            if (!titles.includes(`"${v}"`)) titles.push(`"${v}"`);
                        });
                    }
                }
                }

                // Always add every title from the dropdown (selected chips) — works with or without "Include similar"
                selectedSimilarTitles.forEach(title => { if (!titles.includes(`"${title}"`)) titles.push(`"${title}"`); });
                
                // Deduplicate titles
                titles = [...new Set(titles)];
                query += ' (' + titles.join(' OR ') + ')';
            }

            if (selectedLocations.length > 0) {
                const locTerms = selectedLocations.map(l => `"${l}"`).join(' OR ');
                query += ` (${locTerms})`;
            }

            // Handle multiple countries from multi-select dropdown (all platforms)
            const countrySelect = document.getElementById('country');
            const selectedOptions = Array.from(countrySelect.selectedOptions).map(opt => opt.value);
            if (selectedOptions.length > 0) {
                const countryTerms = selectedOptions
                    .filter(c => countryCodes[c])
                    .map(c => `"${countryCodes[c]}"`);
                if (countryTerms.length === 1) {
                    query += ` ${countryTerms[0]}`;
                } else if (countryTerms.length > 1) {
                    query += ` (${countryTerms.join(' OR ')})`;
                }
            }

            if (platform === 'linkedin' || platform === 'reddit') {
                if (selectedEmployers.length > 0) {
                    const employers = selectedEmployers.map(e => `"${e}"`).join(' OR ');
                    query += ` (${employers})`;
                }
                if (selectedEducationLevels.length > 0) {
                    const eduSet = new Set();
                    selectedEducationLevels.forEach(ed => {
                        const lower = (ed || '').toLowerCase();
                        if (lower.includes('bachelor') || lower.includes('b.s.') || lower.includes('b.a.') || lower.includes('beng')) {
                            ['Bachelor', 'B.S.', 'B.A.', 'BEng', 'undergraduate degree'].forEach(t => eduSet.add(t));
                        } else if (lower.includes('master') || lower.includes('m.s.') || lower.includes('m.a.') || lower.includes('mba')) {
                            ['Master', 'M.S.', 'M.A.', 'MBA', 'graduate degree'].forEach(t => eduSet.add(t));
                        } else if (lower.includes('phd') || lower.includes('doctor')) {
                            ['PhD', 'Ph.D.', 'doctorate'].forEach(t => eduSet.add(t));
                        } else eduSet.add(ed);
                    });
                    if (eduSet.size) query += ' (' + [...eduSet].map(t => `"${t}"`).join(' OR ') + ')';
                }
            }

            // LinkedIn Recruiter–style fields (skills, qualifications, education & experience)
            if (platform === 'linkedin') {
                if (selectedSkills.length > 0) {
                    const terms = selectedSkills.map(k => `"${k}"`).join(' ');
                    query += ` ${terms}`;
                }
                if (selectedQualifications.length > 0) {
                    selectedQualifications.forEach(q => { query += ` "${q}"`; });
                }
                const yearsPosition = document.getElementById('yearsCurrentPosition') && document.getElementById('yearsCurrentPosition').value.trim();
                if (yearsPosition) query += ` "${yearsPosition} years"`;
                const yearsExp = document.getElementById('yearsExperience') && document.getElementById('yearsExperience').value.trim();
                if (yearsExp) query += ` "${yearsExp} years"`;
                const yearsCompany = document.getElementById('yearsCurrentCompany') && document.getElementById('yearsCurrentCompany').value.trim();
                if (yearsCompany) query += ` "${yearsCompany} years"`;
                const industriesEl = document.getElementById('industries');
                if (industriesEl && industriesEl.value.trim()) {
                    const terms = industriesEl.value.trim().split(/[,;]/).map(t => `"${t.trim()}"`).filter(Boolean);
                    if (terms.length) query += ' (' + terms.join(' OR ') + ')';
                }
                const schoolsEl = document.getElementById('schools');
                if (schoolsEl && schoolsEl.value.trim()) {
                    const terms = schoolsEl.value.trim().split(/[,;]/).map(t => `"${t.trim()}"`).filter(Boolean);
                    if (terms.length) query += ' (' + terms.join(' OR ') + ')';
                }
                const fieldsEl = document.getElementById('fieldsOfStudy');
                if (fieldsEl && fieldsEl.value.trim()) {
                    const terms = fieldsEl.value.trim().split(/[,;]/).map(t => `"${t.trim()}"`).filter(Boolean);
                    if (terms.length) query += ' (' + terms.join(' OR ') + ')';
                }
                const gradYearEl = document.getElementById('graduationYear');
                if (gradYearEl && gradYearEl.value.trim()) query += ` "${gradYearEl.value.trim()}"`;
            }

            // Add selected companies (from Target Companies)
            if (selectedCompanies.length > 0) {
                const companyQuery = selectedCompanies.map(c => `"${c}"`).join(' OR ');
                query += ` (${companyQuery})`;
            }

            if (selectedIncludeKeywords.length > 0) {
                const keywords = selectedIncludeKeywords.map(k => `"${k}"`).join(' ');
                query += ` ${keywords}`;
            }

            // Add candidate activity signals
            const signalTerms = getSelectedSignalTerms();
            if (signalTerms.length > 0) {
                const signalQuery = signalTerms.join(' OR ');
                query += ` (${signalQuery})`;
            }

            const diversitySelected = getSelectedDiversityTerms();
            if (diversitySelected.length > 0) {
                const diversityQuery = diversitySelected.map(t => `"${t}"`).join(' OR ');
                query += ` (${diversityQuery})`;
            }

            if (selectedExcludeKeywords.length > 0) {
                const exclusions = selectedExcludeKeywords.map(k => `-"${k}"`).join(' ');
                query += ` ${exclusions}`;
            }

            return query;
        }

        function generateSearch() {
            currentJobTitle = document.getElementById('jobTitle').value.trim();
            currentQuery = buildQuery(currentPlatform);
            displayQuery(currentQuery);
            generateEmailTemplate();
            searchCount++;
            localStorage.setItem('talentScoutSearchCount', searchCount.toString());
            updateStats();
            updateSearchTips();
            updateOpenButton();
        }
        
        function updateOpenButton() {
            const btn = document.getElementById('openSearchBtn');
            if (usesNativeSearch(currentPlatform)) {
                const platformLabel = platformNames[currentPlatform] || currentPlatform;
                btn.innerHTML = `
                    Open in ${platformLabel}
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/>
                        <polyline points="15,3 21,3 21,9"/>
                        <line x1="10" y1="14" x2="21" y2="3"/>
                    </svg>
                `;
            } else {
                btn.innerHTML = `
                    Open in Google
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/>
                        <polyline points="15,3 21,3 21,9"/>
                        <line x1="10" y1="14" x2="21" y2="3"/>
                    </svg>
                `;
            }
        }

        // AI Query Optimization
        let optimizedQuery = '';

        async function optimizeQueryWithAI() {
            if (!currentQuery) {
                alert('Please generate a search query first.');
                return;
            }

            const btn = document.getElementById('aiOptimizeBtn');
            const btnText = document.getElementById('aiOptimizeBtnText');
            
            // Show loading state
            btn.classList.add('loading');
            btnText.textContent = 'Optimizing...';

            try {
                if (typeof quick === 'undefined' || !quick.ai) {
                    throw new Error('AI not available - please deploy to Quick first');
                }

                const jobTitle = document.getElementById('jobTitle').value.trim();
                const platform = currentPlatform;

                const prompt = `You are an expert at Boolean search queries for recruiting. 
                
Analyze this search query and improve it to find better candidates:

Current Query: ${currentQuery}

Job Title: ${jobTitle}
Platform: ${platform}

Please provide:
1. An improved Boolean search query that will find more relevant candidates
2. Keep the site: operator for the platform
3. Add relevant skills, technologies, or keywords that are commonly associated with this role
4. Use proper Boolean operators (AND, OR, NOT, quotes for exact phrases)
5. Make sure the query is not too long (under 500 characters ideally)

Respond in this exact format:
QUERY: [your optimized query here]
EXPLANATION: [2-3 sentences explaining what you improved]`;

                const response = await quick.ai.ask(prompt);
                
                // Parse the response
                const queryMatch = response.match(/QUERY:\s*(.+?)(?=EXPLANATION:|$)/s);
                const explanationMatch = response.match(/EXPLANATION:\s*(.+)/s);

                if (queryMatch) {
                    optimizedQuery = queryMatch[1].trim();
                    document.getElementById('aiOptimizedQuery').textContent = optimizedQuery;
                    document.getElementById('aiExplanation').innerHTML = explanationMatch 
                        ? `<strong>What AI improved:</strong> ${explanationMatch[1].trim()}`
                        : '<strong>Query optimized by AI</strong>';
                    document.getElementById('aiOptimizedResult').classList.remove('hidden');
                } else {
                    // If parsing fails, use the whole response as the query
                    optimizedQuery = response.trim();
                    document.getElementById('aiOptimizedQuery').textContent = optimizedQuery;
                    document.getElementById('aiExplanation').innerHTML = '<strong>Query optimized by AI</strong>';
                    document.getElementById('aiOptimizedResult').classList.remove('hidden');
                }

            } catch (error) {
                console.error('AI optimization error:', error);
                alert('AI optimization failed: ' + error.message);
            } finally {
                btn.classList.remove('loading');
                btnText.textContent = 'AI Optimize Query';
            }
        }

        function useOptimizedQuery() {
            if (optimizedQuery) {
                currentQuery = optimizedQuery;
                document.getElementById('queryText').value = optimizedQuery;
                document.getElementById('aiOptimizedResult').classList.add('hidden');
                // Scroll to the query
                document.getElementById('queryDisplay').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function openPlatformSearch(platform) {
            const query = buildQuery(platform);
            let url;
            
            // Use native search for platforms that support it (like GitHub)
            if (usesNativeSearch(platform)) {
                url = getNativeSearchUrl(platform, query);
            } else {
                url = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
            }
            
            window.open(url, '_blank');
        }

        function displayQuery(query) {
            document.getElementById('queryText').value = query;
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function updateCurrentQuery(value) {
            currentQuery = value;
        }

        function generateEmailTemplate() {
            if (!currentJobTitle) {
                document.getElementById('emailSection').classList.add('hidden');
                return;
            }
            const template = emailTemplates[currentEmailTone](currentJobTitle);
            document.getElementById('emailTemplate').textContent = template;
            document.getElementById('emailSection').classList.remove('hidden');
        }

        function setEmailTone(tone) {
            currentEmailTone = tone;
            document.querySelectorAll('.tone-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.tone === tone));
            generateEmailTemplate();
        }

        function regenerateEmail() {
            const variations = {
                professional: [
                    `Dear [Candidate Name],\n\nYour profile caught my attention while researching talented ${currentJobTitle}s. At Shopify, we're constantly seeking exceptional individuals.\n\nWould you be available for a brief conversation?\n\nWarm regards,\n[Your Name]\nShopify`,
                    `Hello [Candidate Name],\n\nI hope this message finds you well. I came across your profile and was impressed by your experience as a ${currentJobTitle}.\n\nShopify is currently expanding our team, and I believe your background aligns well with our needs. Would you be open to exploring this opportunity?\n\nBest regards,\n[Your Name]\nShopify`,
                    `Dear [Candidate Name],\n\nI'm reaching out from Shopify's Talent team. Your ${currentJobTitle} experience and career trajectory are exactly what we look for.\n\nI'd welcome the chance to discuss how your skills could contribute to our mission of making commerce better for everyone.\n\nLooking forward to connecting,\n[Your Name]\nShopify`,
                    `Hi [Candidate Name],\n\nYour background as a ${currentJobTitle} stood out to me during my search for exceptional talent. At Shopify, we're building the future of commerce and are always looking for people like you.\n\nWould you have 15 minutes for a quick call this week?\n\nBest,\n[Your Name]\nShopify`
                ],
                casual: [
                    `Hey [Candidate Name]!\n\nJust saw your profile and thought — this person would be awesome at Shopify! Want to grab a virtual coffee?\n\n[Your Name]\nShopify`,
                    `Hi [Candidate Name]!\n\nI stumbled across your profile and had to reach out. Your ${currentJobTitle} work looks really impressive!\n\nWe're hiring at Shopify and I think you'd be a great fit. Open to chatting?\n\nCheers,\n[Your Name]\nShopify`,
                    `Hey there!\n\nSaw your profile and got excited — your ${currentJobTitle} experience is exactly what we need at Shopify.\n\nNo pressure, but would love to tell you about what we're building. Coffee chat?\n\n[Your Name]\nShopify`,
                    `Hi [Candidate Name]!\n\nQuick note — your background caught my eye and I think Shopify could be a great next step for you.\n\nWant to hear more? I promise to keep it brief!\n\n[Your Name]\nShopify`
                ],
                enthusiastic: [
                    `Hi [Candidate Name]!\n\nWOW — your ${currentJobTitle} experience is incredible! I couldn't pass up the opportunity to reach out.\n\nLet's chat?\n\n[Your Name]\nShopify`,
                    `Hey [Candidate Name]!\n\nI'm so excited to reach out! Your work as a ${currentJobTitle} is seriously impressive, and I immediately thought of Shopify.\n\nWe're doing amazing things here and I'd LOVE to tell you about it. Are you up for a call?\n\n[Your Name]\nShopify`,
                    `Hi [Candidate Name]!\n\nOkay, I have to be honest — your profile made my day! Finding talented ${currentJobTitle}s like you is exactly why I love my job.\n\nShopify would be lucky to have you. Can we talk?\n\n[Your Name]\nShopify`,
                    `[Candidate Name]!\n\nJust found your profile and I'm genuinely thrilled! Your ${currentJobTitle} journey is exactly the kind of story we love at Shopify.\n\nI'd be SO happy to share what we're working on. Interested?\n\n[Your Name]\nShopify`
                ],
                concise: [
                    `[Candidate Name],\n\nHiring ${currentJobTitle}s at Shopify. Saw your background — interested?\n\n[Your Name]`,
                    `Hi [Candidate Name],\n\nShopify. ${currentJobTitle} role. Your profile fits. Quick call?\n\n[Your Name]`,
                    `[Candidate Name],\n\nImpressive ${currentJobTitle} background. We're hiring at Shopify. Worth a conversation?\n\n[Your Name]`,
                    `Hi,\n\nSaw your profile. Looking for ${currentJobTitle}s at Shopify. Open to chat?\n\n[Your Name]`
                ]
            };
            const toneVariations = variations[currentEmailTone];
            const randomVariation = toneVariations[Math.floor(Math.random() * toneVariations.length)];
            document.getElementById('emailTemplate').textContent = randomVariation;
        }

        // AI Email Generation
        function generateAIEmail() {
            // Toggle AI options panel
            const aiOptions = document.getElementById('aiEmailOptions');
            aiOptions.classList.toggle('hidden');
            
            // Deselect other tone buttons
            document.querySelectorAll('.tone-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.tone-btn.ai-tone').classList.add('active');
        }

        async function generateAIEmailWithOptions() {
            const candidateName = document.getElementById('candidateName').value.trim() || '[Candidate Name]';
            const specificSkill = document.getElementById('specificSkill').value.trim();
            const tone = document.getElementById('aiEmailTone').value;
            
            const btn = document.getElementById('aiEmailBtn');
            const btnText = document.getElementById('aiEmailBtnText');
            
            // Show loading state
            btn.classList.add('loading');
            btnText.textContent = 'Generating...';
            
            try {
                if (typeof quick === 'undefined' || !quick.ai) {
                    throw new Error('AI not available - please deploy to Quick first');
                }
                
                const prompt = `Write a recruiting outreach email for a ${currentJobTitle} position at Shopify.

Context:
- Candidate name: ${candidateName}
- Job title being recruited for: ${currentJobTitle}
- Tone: ${tone}
${specificSkill ? `- Specific skill to mention: ${specificSkill}` : ''}

Requirements:
- Keep it concise (under 150 words)
- Be genuine and personable, not generic
- Mention Shopify and what makes it an exciting place to work
- Include a clear call to action
- Use the specified tone (${tone})
- Sign off with [Your Name] as a placeholder

Write only the email, no explanations or subject lines.`;

                const result = await quick.ai.ask(prompt);
                
                if (result && result.trim()) {
                    document.getElementById('emailTemplate').textContent = result.trim();
                } else {
                    throw new Error('AI returned empty response');
                }
            } catch (error) {
                console.error('AI email generation error:', error);
                alert(error.message || 'Failed to generate AI email. Please try again.');
            } finally {
                btn.classList.remove('loading');
                btnText.textContent = 'Generate with AI';
            }
        }

        function copyEmail() {
            navigator.clipboard.writeText(document.getElementById('emailTemplate').textContent).then(() => alert('Email copied!'));
        }

        function openSearch() {
            let url;
            if (usesNativeSearch(currentPlatform)) {
                url = getNativeSearchUrl(currentPlatform, currentQuery);
            } else {
                url = `https://www.google.com/search?q=${encodeURIComponent(currentQuery)}`;
            }
            window.open(url, '_blank');
        }

        function copyQuery() {
            navigator.clipboard.writeText(currentQuery).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.classList.add('copied');
                btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg> Copied!';
                setTimeout(() => {
                    btn.classList.remove('copied');
                    btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg> Copy';
                }, 2000);
            });
        }

        function onJobTitleInput() {
            updateSearchTips();
            const val = document.getElementById('jobTitle').value.trim().toLowerCase();
            const dropdown = document.getElementById('jobTitleDropdown');
            if (!val) {
                dropdown.classList.remove('show');
                return;
            }
            const filtered = jobTitleSuggestionsList.filter(t => t.toLowerCase().includes(val)).slice(0, 12);
            dropdown.innerHTML = filtered.map(t => `<li role="option" tabindex="-1" data-title="${t.replace(/"/g, '&quot;')}">${escapeHtml(t)}</li>`).join('');
            if (filtered.length) {
                dropdown.classList.add('show');
                dropdown.querySelectorAll('li').forEach((li, i) => {
                    li.addEventListener('click', () => selectJobTitleSuggestion(li.getAttribute('data-title').replace(/&quot;/g, '"')));
                });
            } else {
                dropdown.classList.remove('show');
            }
        }

        function onJobTitleFocus() {
            const val = document.getElementById('jobTitle').value.trim().toLowerCase();
            if (val) onJobTitleInput();
        }

        function onJobTitleKeydown(e) {
            const dropdown = document.getElementById('jobTitleDropdown');
            if (!dropdown.classList.contains('show')) return;
            const items = dropdown.querySelectorAll('li');
            if (e.key === 'Escape') { dropdown.classList.remove('show'); return; }
            if (e.key === 'ArrowDown' && items.length) {
                e.preventDefault();
                const cur = dropdown.querySelector('li[aria-selected="true"]');
                const idx = cur ? [...items].indexOf(cur) + 1 : 0;
                items.forEach((el, i) => el.setAttribute('aria-selected', i === idx ? 'true' : 'false'));
                if (items[idx]) items[idx].focus();
            }
            if (e.key === 'ArrowUp' && items.length) {
                e.preventDefault();
                const cur = dropdown.querySelector('li[aria-selected="true"]');
                const idx = cur ? [...items].indexOf(cur) - 1 : items.length - 1;
                items.forEach((el, i) => el.setAttribute('aria-selected', i === idx ? 'true' : 'false'));
                if (items[idx]) items[idx].focus();
            }
            if (e.key === 'Enter') {
                e.preventDefault();
                const cur = dropdown.querySelector('li[aria-selected="true"]');
                const first = items[0];
                if (cur) selectJobTitleSuggestion(cur.getAttribute('data-title').replace(/&quot;/g, '"'));
                else if (first) selectJobTitleSuggestion(first.getAttribute('data-title').replace(/&quot;/g, '"'));
                else {
                    const raw = document.getElementById('jobTitle').value.trim();
                    if (raw) selectJobTitleSuggestion(raw);
                }
            }
        }

        function selectJobTitleSuggestion(title) {
            if (!selectedSimilarTitles.includes(title)) {
                selectedSimilarTitles.push(title);
                updateSelectedTitles();
            }
            document.getElementById('jobTitle').value = title;
            document.getElementById('jobTitleDropdown').classList.remove('show');
            if (currentQuery) generateSearch();
        }

        document.addEventListener('click', (e) => {
            const wrap = document.querySelector('.job-title-autocomplete-wrap');
            if (wrap && !wrap.contains(e.target)) document.getElementById('jobTitleDropdown').classList.remove('show');
        });

        function escapeAttr(str) {
            return (str || '').replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;');
        }

        function renderSuggestionChips(containerId, items, type) {
            const el = document.getElementById(containerId);
            if (!el) return;
            if (!items || items.length === 0) {
                el.innerHTML = '<span style="color: var(--text-secondary); font-size: 12px;">None suggested.</span>';
                return;
            }
            const typeAttr = type === 'title' ? 'title' : type === 'qual' ? 'qual' : 'skill';
            el.innerHTML = items.map(s => {
                const val = (s || '').trim();
                if (!val) return '';
                const safe = escapeAttr(val);
                return `<button type="button" class="suggestion-chip" data-suggestion-type="${typeAttr}" data-value="${safe}">${escapeHtml(val)}</button>`;
            }).join('');
            el.querySelectorAll('.suggestion-chip').forEach(btn => {
                btn.addEventListener('click', function() {
                    const value = (this.getAttribute('data-value') || '').replace(/&quot;/g, '"').replace(/&amp;/g, '&').replace(/&lt;/g, '<');
                    addSuggestionFromEl(value, this.getAttribute('data-suggestion-type'));
                });
            });
        }

        function addSuggestionFromEl(value, type) {
            if (!value) return;
            if (type === 'title') {
                if (!selectedSimilarTitles.includes(value)) {
                    selectedSimilarTitles.push(value);
                    updateSelectedTitles();
                }
            } else if (type === 'qual') {
                if (!selectedQualifications.includes(value)) {
                    selectedQualifications.push(value);
                    updateAcDisplay('qualifications');
                }
            } else if (type === 'skill') {
                if (!selectedSkills.includes(value)) {
                    selectedSkills.push(value);
                    updateSelectedSkills();
                }
            }
            if (currentQuery) generateSearch();
        }

        async function getAISuggestions() {
            const jobTitleInput = document.getElementById('jobTitle').value.trim();
            const jobTitle = jobTitleInput.toLowerCase();
            if (!jobTitle) { alert('Please enter a job title first.'); return; }
            const btn = document.getElementById('aiSuggest');
            const panel = document.getElementById('suggestionsPanel');
            if (btn) { btn.classList.add('loading'); btn.disabled = true; }

            let titleSuggestions = [];
            let qualSuggestions = [];
            let skillSuggestions = [];

            if (typeof quick !== 'undefined' && quick.ai) {
                try {
                    const prompt = `You are a recruiting sourcer. For the job title "${jobTitleInput}", suggest search terms in three categories. Reply in this exact format (comma-separated, no numbering):
SIMILAR_TITLES: [5-8 alternative or related job titles people might have]
QUALIFICATIONS: [5-8 certifications, credentials, or qualifications e.g. PMP, CPA, AWS Certified, years experience]
SKILLS: [5-10 skills or assessment areas e.g. Python, Leadership, System design, Agile]

Job title: ${jobTitleInput}`;
                    const response = await quick.ai.ask(prompt);
                    const titleMatch = response.match(/SIMILAR_TITLES?:\s*([^\n]+)/i);
                    const qualMatch = response.match(/QUALIFICATIONS?:\s*([^\n]+)/i);
                    const skillMatch = response.match(/SKILLS?:\s*([^\n]+)/i);
                    if (titleMatch) titleSuggestions = titleMatch[1].split(',').map(s => s.trim()).filter(Boolean);
                    if (qualMatch) qualSuggestions = qualMatch[1].split(',').map(s => s.trim()).filter(Boolean);
                    if (skillMatch) skillSuggestions = skillMatch[1].split(',').map(s => s.trim()).filter(Boolean);
                } catch (e) {
                    console.error('AI suggestions error:', e);
                    titleSuggestions = getFallbackTitleSuggestions(jobTitle);
                    qualSuggestions = getFallbackQualSuggestions(jobTitle);
                    skillSuggestions = getFallbackSkillSuggestions(jobTitle);
                }
            } else {
                titleSuggestions = getFallbackTitleSuggestions(jobTitle);
                qualSuggestions = getFallbackQualSuggestions(jobTitle);
                skillSuggestions = getFallbackSkillSuggestions(jobTitle);
            }

            titleSuggestions = [...new Set(titleSuggestions)].filter(s => s.toLowerCase() !== jobTitle);
            qualSuggestions = [...new Set(qualSuggestions)];
            skillSuggestions = [...new Set(skillSuggestions)];

            renderSuggestionChips('suggestionChips', titleSuggestions, 'title');
            renderSuggestionChips('suggestionQualChips', qualSuggestions, 'qual');
            renderSuggestionChips('suggestionSkillChips', skillSuggestions, 'skill');

            panel.classList.remove('hidden');
            panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            if (btn) { btn.classList.remove('loading'); btn.disabled = false; }
        }

        function getFallbackTitleSuggestions(jobTitle) {
            let suggestions = [];
            for (const [key, synonyms] of Object.entries(jobTitleSynonyms)) {
                if (jobTitle.includes(key) || synonyms.some(s => jobTitle.includes(s))) {
                    suggestions = [...synonyms, key];
                    break;
                }
            }
            if (suggestions.length === 0) {
                if (jobTitle.includes('engineer')) suggestions = ['software engineer', 'senior engineer', 'staff engineer', 'principal engineer'];
                else if (jobTitle.includes('developer')) suggestions = ['software developer', 'web developer', 'full stack developer', 'senior developer'];
                else if (jobTitle.includes('manager')) suggestions = ['engineering manager', 'product manager', 'project manager', 'technical program manager'];
                else if (jobTitle.includes('design')) suggestions = ['product designer', 'ux designer', 'ui designer', 'visual designer', 'senior designer'];
                else if (jobTitle.includes('data')) suggestions = ['data scientist', 'data analyst', 'data engineer', 'analytics engineer'];
                else if (jobTitle.includes('analyst')) suggestions = ['business analyst', 'data analyst', 'product analyst', 'systems analyst'];
                else suggestions = ['senior ' + jobTitle, 'lead ' + jobTitle, 'staff ' + jobTitle, 'principal ' + jobTitle];
            }
            return [...new Set(suggestions)].filter(s => s.toLowerCase() !== jobTitle);
        }

        function getFallbackQualSuggestions(jobTitle) {
            const all = acSuggestions.qualifications || [];
            const roleBased = [];
            if (jobTitle.includes('engineer') || jobTitle.includes('developer')) roleBased.push('PMP', 'Technical leadership', '5+ years experience', 'Scaled systems', 'Open source contributor');
            else if (jobTitle.includes('manager')) roleBased.push('PMP', 'PMP certified', 'Leadership experience', 'Cross-functional', '10+ years');
            else if (jobTitle.includes('design')) roleBased.push('Leadership experience', 'Cross-functional', 'Public speaking', 'Design systems');
            else if (jobTitle.includes('data')) roleBased.push('5+ years experience', 'Technical leadership', 'Data analysis', 'Public speaking');
            return [...new Set([...roleBased, ...all.slice(0, 6)])].slice(0, 10);
        }

        function getFallbackSkillSuggestions(jobTitle) {
            const all = skillSuggestionsList || [];
            const roleBased = [];
            if (jobTitle.includes('engineer') || jobTitle.includes('developer')) roleBased.push('Python', 'System design', 'API design', 'Microservices', 'Leadership', 'Agile');
            else if (jobTitle.includes('manager')) roleBased.push('Agile', 'Scrum', 'Product management', 'Leadership', 'Cross-functional', 'Mentorship');
            else if (jobTitle.includes('design')) roleBased.push('Figma', 'User research', 'Design systems', 'UX design', 'UI design');
            else if (jobTitle.includes('data')) roleBased.push('Python', 'SQL', 'Data analysis', 'A/B testing', 'Machine learning');
            return [...new Set([...roleBased, ...all.slice(0, 8)])].slice(0, 12);
        }

        function addSuggestion(title) {
            if (!selectedSimilarTitles.includes(title)) {
                selectedSimilarTitles.push(title);
                updateSelectedTitles();
            }
            generateSearch();
        }

        function updateSelectedTitles() {
            const container = document.getElementById('similarTitlesContainer');
            const chipsEl = document.getElementById('selectedTitles');
            if (selectedSimilarTitles.length > 0) {
                container.classList.remove('hidden');
                chipsEl.innerHTML = selectedSimilarTitles.map(title => {
                    const safeAttr = (title || '').replace(/"/g, '&quot;');
                    return `<span class="chip selected">${escapeHtml(title)}<span class="remove" onclick="removeSimilarTitleFromEl(this)" data-title="${safeAttr}">×</span></span>`;
                }).join('');
            } else {
                container.classList.add('hidden');
            }
        }

        function removeSimilarTitle(title) {
            selectedSimilarTitles = selectedSimilarTitles.filter(t => t !== title);
            updateSelectedTitles();
            if (currentQuery) generateSearch();
        }

        function removeSimilarTitleFromEl(el) {
            const title = el.getAttribute('data-title');
            if (title != null) removeSimilarTitle(title);
        }

        function onSkillsInput() {
            const val = document.getElementById('linkedinSkillsInput').value.trim().toLowerCase();
            const dropdown = document.getElementById('skillsDropdown');
            if (!val) {
                dropdown.classList.remove('show');
                return;
            }
            const filtered = skillSuggestionsList.filter(s => s.toLowerCase().includes(val)).slice(0, 12);
            dropdown.innerHTML = filtered.map(s => `<li role="option" tabindex="-1" data-skill="${(s || '').replace(/"/g, '&quot;')}">${escapeHtml(s)}</li>`).join('');
            if (filtered.length) {
                dropdown.classList.add('show');
                dropdown.querySelectorAll('li').forEach(li => {
                    li.addEventListener('click', () => selectSkillSuggestion(li.getAttribute('data-skill').replace(/&quot;/g, '"')));
                });
            } else {
                dropdown.classList.remove('show');
            }
        }

        function onSkillsFocus() {
            const val = document.getElementById('linkedinSkillsInput').value.trim().toLowerCase();
            if (val) onSkillsInput();
        }

        function onSkillsKeydown(e) {
            const dropdown = document.getElementById('skillsDropdown');
            if (!dropdown.classList.contains('show')) return;
            const items = dropdown.querySelectorAll('li');
            if (e.key === 'Escape') { dropdown.classList.remove('show'); return; }
            if (e.key === 'ArrowDown' && items.length) {
                e.preventDefault();
                const cur = dropdown.querySelector('li[aria-selected="true"]');
                const idx = cur ? [...items].indexOf(cur) + 1 : 0;
                items.forEach((el, i) => el.setAttribute('aria-selected', i === idx ? 'true' : 'false'));
                if (items[idx]) items[idx].focus();
            }
            if (e.key === 'ArrowUp' && items.length) {
                e.preventDefault();
                const cur = dropdown.querySelector('li[aria-selected="true"]');
                const idx = cur ? [...items].indexOf(cur) - 1 : items.length - 1;
                items.forEach((el, i) => el.setAttribute('aria-selected', i === idx ? 'true' : 'false'));
                if (items[idx]) items[idx].focus();
            }
            if (e.key === 'Enter') {
                e.preventDefault();
                const cur = dropdown.querySelector('li[aria-selected="true"]');
                const first = items[0];
                if (cur) selectSkillSuggestion(cur.getAttribute('data-skill').replace(/&quot;/g, '"'));
                else if (first) selectSkillSuggestion(first.getAttribute('data-skill').replace(/&quot;/g, '"'));
                else {
                    const raw = document.getElementById('linkedinSkillsInput').value.trim();
                    if (raw) selectSkillSuggestion(raw);
                }
            }
        }

        function selectSkillSuggestion(skill) {
            if (!skill) return;
            if (!selectedSkills.includes(skill)) {
                selectedSkills.push(skill);
                updateSelectedSkills();
            }
            document.getElementById('linkedinSkillsInput').value = '';
            document.getElementById('skillsDropdown').classList.remove('show');
            if (currentQuery) generateSearch();
        }

        function updateSelectedSkills() {
            const container = document.getElementById('similarSkillsContainer');
            const chipsEl = document.getElementById('selectedSkills');
            if (selectedSkills.length > 0 && currentPlatform === 'linkedin') {
                container.classList.remove('hidden');
                chipsEl.innerHTML = selectedSkills.map(skill => {
                    const safeAttr = (skill || '').replace(/"/g, '&quot;');
                    return `<span class="chip selected">${escapeHtml(skill)}<span class="remove" onclick="removeSkillFromEl(this)" data-skill="${safeAttr}">×</span></span>`;
                }).join('');
            } else {
                container.classList.add('hidden');
            }
        }

        function removeSkill(skill) {
            selectedSkills = selectedSkills.filter(s => s !== skill);
            updateSelectedSkills();
            if (currentQuery) generateSearch();
        }

        function removeSkillFromEl(el) {
            const skill = el.getAttribute('data-skill');
            if (skill != null) removeSkill(skill);
        }

        document.addEventListener('click', (e) => {
            const wrap = document.querySelector('.skills-autocomplete-wrap');
            if (wrap && !wrap.contains(e.target)) document.getElementById('skillsDropdown').classList.remove('show');
            document.querySelectorAll('[id$="Dropdown"]').forEach(el => { if (el.id !== 'jobTitleDropdown' && el.id !== 'skillsDropdown') el.classList.remove('show'); });
        });

        function onAcInput(field) {
            currentAcField = field;
            const cfg = acFieldConfig[field];
            const list = acSuggestions[field] || [];
            const val = document.getElementById(cfg.inputId).value.trim().toLowerCase();
            const dropdown = document.getElementById(cfg.dropdownId);
            if (!val) { dropdown.classList.remove('show'); return; }
            const filtered = list.filter(s => (s || '').toLowerCase().includes(val)).slice(0, 12);
            const attr = field === 'excludeKeywords' ? 'data-ac-val' : 'data-ac-val';
            dropdown.innerHTML = filtered.map(s => `<li role="option" tabindex="-1" data-ac-val="${(s || '').replace(/"/g, '&quot;')}">${escapeHtml(s)}</li>`).join('');
            if (filtered.length) {
                dropdown.classList.add('show');
                dropdown.querySelectorAll('li').forEach(li => {
                    li.addEventListener('click', () => selectAcSuggestion(field, (li.getAttribute('data-ac-val') || '').replace(/&quot;/g, '"')));
                });
            } else dropdown.classList.remove('show');
        }

        function onAcFocus(field) {
            currentAcField = field;
            const cfg = acFieldConfig[field];
            const val = document.getElementById(cfg.inputId).value.trim().toLowerCase();
            if (val) onAcInput(field);
        }

        function onAcKeydown(field, e) {
            const cfg = acFieldConfig[field];
            const dropdown = document.getElementById(cfg.dropdownId);
            if (!dropdown.classList.contains('show')) return;
            const items = dropdown.querySelectorAll('li');
            if (e.key === 'Escape') { dropdown.classList.remove('show'); return; }
            if (e.key === 'ArrowDown' && items.length) {
                e.preventDefault();
                const cur = dropdown.querySelector('li[aria-selected="true"]');
                const idx = cur ? [...items].indexOf(cur) + 1 : 0;
                items.forEach((el, i) => el.setAttribute('aria-selected', i === idx ? 'true' : 'false'));
                if (items[idx]) items[idx].focus();
            }
            if (e.key === 'ArrowUp' && items.length) {
                e.preventDefault();
                const cur = dropdown.querySelector('li[aria-selected="true"]');
                const idx = cur ? [...items].indexOf(cur) - 1 : items.length - 1;
                items.forEach((el, i) => el.setAttribute('aria-selected', i === idx ? 'true' : 'false'));
                if (items[idx]) items[idx].focus();
            }
            if (e.key === 'Enter') {
                e.preventDefault();
                const cur = dropdown.querySelector('li[aria-selected="true"]');
                const first = items[0];
                if (cur) selectAcSuggestion(field, (cur.getAttribute('data-ac-val') || '').replace(/&quot;/g, '"'));
                else if (first) selectAcSuggestion(field, (first.getAttribute('data-ac-val') || '').replace(/&quot;/g, '"'));
                else {
                    const input = document.getElementById(cfg.inputId);
                    const raw = input.value.trim();
                    if (raw) selectAcSuggestion(field, raw);
                }
            }
        }

        function selectAcSuggestion(field, value) {
            if (!value) return;
            const arr = getAcSelected(field);
            if (!arr.includes(value)) { arr.push(value); updateAcDisplay(field); }
            const cfg = acFieldConfig[field];
            document.getElementById(cfg.inputId).value = '';
            document.getElementById(cfg.dropdownId).classList.remove('show');
            if (currentQuery) generateSearch();
        }

        function updateAcDisplay(field) {
            const cfg = acFieldConfig[field];
            const arr = getAcSelected(field);
            const container = document.getElementById(cfg.containerId);
            const chipsEl = document.getElementById(cfg.chipsId);
            if (arr.length > 0) {
                container.classList.remove('hidden');
                chipsEl.innerHTML = arr.map(val => {
                    const safe = (val || '').replace(/"/g, '&quot;');
                    return `<span class="chip selected">${escapeHtml(val)}<span class="remove" onclick="removeAcValueFromEl('${field}', this)" data-ac-val="${safe}">×</span></span>`;
                }).join('');
            } else container.classList.add('hidden');
        }

        function removeAcValue(field, value) {
            const arr = getAcSelected(field);
            const idx = arr.indexOf(value);
            if (idx !== -1) { arr.splice(idx, 1); updateAcDisplay(field); }
            if (currentQuery) generateSearch();
        }

        function removeAcValueFromEl(field, el) {
            const val = (el.getAttribute('data-ac-val') || '').replace(/&quot;/g, '"');
            removeAcValue(field, val);
        }

        function clearForm() {
            document.querySelectorAll('.form-input, .form-select').forEach(el => {
                el.value = '';
            });
            document.getElementById('includeSimilar').checked = true;
            
            // Reset countries to just Canada
            const countrySelect = document.getElementById('country');
            Array.from(countrySelect.options).forEach(opt => {
                opt.selected = opt.value === 'ca';
            });
            
            // Reset seniority to just Senior
            document.querySelectorAll('.seniority-chip').forEach(chip => {
                chip.classList.toggle('selected', chip.dataset.level === 'senior');
            });
            selectedSeniorityLevels = ['senior'];
            
            // Reset GitHub filters
            const githubHireable = document.getElementById('githubHireable');
            const githubActiveContributor = document.getElementById('githubActiveContributor');
            const githubHasWebsite = document.getElementById('githubHasWebsite');
            if (githubHireable) githubHireable.checked = true;
            if (githubActiveContributor) githubActiveContributor.checked = false;
            if (githubHasWebsite) githubHasWebsite.checked = false;
            
            // Reset signals
            document.querySelectorAll('.signal-checkbox').forEach(cb => { cb.checked = false; cb.closest('.signal-option').classList.remove('selected'); });
            selectedSignals = [];
            
            document.querySelectorAll('.diversity-checkbox').forEach(cb => { cb.checked = false; cb.closest('.diversity-option').classList.remove('selected'); });
            document.querySelectorAll('.company-list-card').forEach(c => c.classList.remove('selected'));
            selectedCompanyLists = [];
            selectedCompanies = [];
            updateSelectedCompaniesDisplay();
            selectedSimilarTitles = [];
            updateSelectedTitles();
            selectedSkills = [];
            updateSelectedSkills();
            selectedLocations = [];
            selectedEmployers = [];
            selectedEducationLevels = [];
            selectedQualifications = [];
            selectedIncludeKeywords = [];
            selectedExcludeKeywords = [];
            ['location', 'currentEmployer', 'education', 'qualifications', 'includeKeywords', 'excludeKeywords'].forEach(f => updateAcDisplay(f));
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('emailSection').classList.add('hidden');
            document.getElementById('aiEmailOptions').classList.add('hidden');
            document.getElementById('suggestionsPanel').classList.add('hidden');
            
            // Reset AI email inputs
            document.getElementById('candidateName').value = '';
            document.getElementById('specificSkill').value = '';
            document.getElementById('aiEmailTone').value = 'professional';
            
            // Reset tone buttons
            document.querySelectorAll('.tone-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.tone-btn[data-tone="professional"]').classList.add('active');
            currentEmailTone = 'professional';
            
            currentQuery = '';
            currentJobTitle = '';
        }

        async function saveSearch() {
            if (!currentQuery) return;
            const searchData = {
                platform: currentPlatform,
                title: document.getElementById('jobTitle').value.trim() || 'Untitled Search',
                query: currentQuery,
                savedBy: 'anonymous',
                // Save all form fields for restoration
                formData: {
                    jobTitle: document.getElementById('jobTitle').value.trim(),
                    selectedLocations: [...selectedLocations],
                    selectedCountries: Array.from(document.getElementById('country').selectedOptions).map(opt => opt.value),
                    selectedEmployers: [...selectedEmployers],
                    selectedEducationLevels: [...selectedEducationLevels],
                    selectedQualifications: [...selectedQualifications],
                    selectedIncludeKeywords: [...selectedIncludeKeywords],
                    selectedExcludeKeywords: [...selectedExcludeKeywords],
                    skills: document.getElementById('skills').value.trim(),
                    tags: document.getElementById('tags').value.trim(),
                    bio: document.getElementById('bio').value.trim(),
                    includeSimilar: document.getElementById('includeSimilar').checked,
                    selectedCompanies: [...selectedCompanies],
                    selectedSimilarTitles: [...selectedSimilarTitles],
                    selectedSeniorityLevels: [...selectedSeniorityLevels],
                    selectedSignals: [...selectedSignals],
                    githubHireable: document.getElementById('githubHireable')?.checked,
                    githubActiveContributor: document.getElementById('githubActiveContributor')?.checked,
                    githubHasWebsite: document.getElementById('githubHasWebsite')?.checked
                }
            };
            
            try {
                if (searchesDB) {
                    // Get current user info if available
                    if (typeof quick !== 'undefined' && quick.id && quick.id.fullName) {
                        searchData.savedBy = quick.id.fullName;
                    }
                    await searchesDB.create(searchData);
                    await loadSavedSearches();
                } else {
                    // Fallback to localStorage
                    savedSearches.unshift({ id: Date.now(), ...searchData, timestamp: new Date().toISOString() });
                    if (savedSearches.length > 20) savedSearches = savedSearches.slice(0, 20);
                    localStorage.setItem('talentScoutSearches', JSON.stringify(savedSearches));
                    renderSavedSearches();
                }
                updateStats();
            } catch (error) {
                console.error('Save search error:', error);
                alert('Failed to save search. Please try again.');
            }
        }

        function renderSavedSearches() {
            const container = document.getElementById('savedSearchesList');
            if (savedSearches.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); font-size: 14px;">No saved searches yet. Generate a search and click "Save" to add it here!</p>';
                return;
            }
            container.innerHTML = savedSearches.map(s => `
                <div class="saved-search-item" onclick="loadSavedSearch('${s.id}')">
                    <div class="saved-search-info">
                        <div class="saved-search-platform">${getPlatformIcon(s.platform)}</div>
                        <div style="display: flex; flex-direction: column; gap: 2px;">
                            <span class="saved-search-text">${s.title}</span>
                            <span style="font-size: 11px; color: var(--text-secondary);">by ${s.savedBy || 'anonymous'}</span>
                        </div>
                    </div>
                    <button class="saved-search-delete" onclick="event.stopPropagation(); deleteSavedSearch('${s.id}')" title="Delete">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
                    </button>
                </div>
            `).join('');
        }

        function getPlatformIcon(platform) {
            const icons = { linkedin: '🔗', reddit: '🤖', github: '🐙', stackoverflow: '📚', twitter: '🐦', scholar: '🎓', dribbble: '🏀', behance: '🎨', kaggle: '📊', wellfound: '🚀', substack: '📝', devto: '💻', producthunt: '🔶', polywork: '◇', bluesky: '🦋', quora: '❓', speakerdeck: '📽️', gitlab: '🦊', bitbucket: '🪣', codepen: '🖊️', stackexchange: '📋', hackernews: '🟠', hashnode: '📘', hired: '💼', dice: '🎲', indeed: '📄', glassdoor: '🚪', levelsfyi: '📊', otta: '○', indiehackers: '🛠️', meetup: '👥', eventbrite: '🎫', twitch: '🎮', youtube: '▶️', mastodon: '🐘', leetcode: '📝', hackerrank: '✔️', womenwhocode: '👩‍💻', sourceforge: '🔧' };
            return icons[platform] || '🔍';
        }

        function loadSavedSearch(id) {
            const search = savedSearches.find(s => s.id === id || s.id === parseInt(id));
            if (search) { 
                // Switch to the saved platform
                switchPlatform(search.platform);
                
                // Restore form fields if we have them
                if (search.formData) {
                    document.getElementById('jobTitle').value = search.formData.jobTitle || '';
                    selectedLocations = Array.isArray(search.formData.selectedLocations) ? [...search.formData.selectedLocations] : (search.formData.location ? [search.formData.location] : []);
                    selectedEmployers = Array.isArray(search.formData.selectedEmployers) ? [...search.formData.selectedEmployers] : (search.formData.currentEmployer ? [search.formData.currentEmployer] : []);
                    selectedEducationLevels = Array.isArray(search.formData.selectedEducationLevels) ? [...search.formData.selectedEducationLevels] : (search.formData.education ? [search.formData.education] : []);
                    selectedQualifications = Array.isArray(search.formData.selectedQualifications) ? [...search.formData.selectedQualifications] : [];
                    selectedIncludeKeywords = Array.isArray(search.formData.selectedIncludeKeywords) ? [...search.formData.selectedIncludeKeywords] : (search.formData.includeKeywords ? search.formData.includeKeywords.split(',').map(s => s.trim()).filter(Boolean) : []);
                    selectedExcludeKeywords = Array.isArray(search.formData.selectedExcludeKeywords) ? [...search.formData.selectedExcludeKeywords] : (search.formData.excludeKeywords ? search.formData.excludeKeywords.split(',').map(s => s.trim()).filter(Boolean) : []);
                    ['location', 'currentEmployer', 'education', 'qualifications', 'includeKeywords', 'excludeKeywords'].forEach(f => updateAcDisplay(f));
                    document.getElementById('skills').value = search.formData.skills || '';
                    document.getElementById('tags').value = search.formData.tags || '';
                    document.getElementById('bio').value = search.formData.bio || '';
                    document.getElementById('includeSimilar').checked = search.formData.includeSimilar !== false;
                    
                    // Restore selected countries
                    if (search.formData.selectedCountries) {
                        const countrySelect = document.getElementById('country');
                        Array.from(countrySelect.options).forEach(opt => {
                            opt.selected = search.formData.selectedCountries.includes(opt.value);
                        });
                    }
                    
                    // Restore selected companies
                    if (search.formData.selectedCompanies) {
                        selectedCompanies = [...search.formData.selectedCompanies];
                        updateSelectedCompaniesDisplay();
                    }
                    
                    // Restore selected similar titles
                    if (search.formData.selectedSimilarTitles) {
                        selectedSimilarTitles = [...search.formData.selectedSimilarTitles];
                        updateSelectedTitles();
                    }
                    
                    // Restore seniority levels
                    if (search.formData.selectedSeniorityLevels) {
                        selectedSeniorityLevels = [...search.formData.selectedSeniorityLevels];
                        document.querySelectorAll('.seniority-chip').forEach(chip => {
                            chip.classList.toggle('selected', selectedSeniorityLevels.includes(chip.dataset.level));
                        });
                    }
                    
                    // Restore selected signals
                    if (search.formData.selectedSignals) {
                        selectedSignals = [...search.formData.selectedSignals];
                        document.querySelectorAll('.signal-checkbox').forEach(cb => {
                            const isSelected = selectedSignals.includes(cb.value);
                            cb.checked = isSelected;
                            cb.closest('.signal-option').classList.toggle('selected', isSelected);
                        });
                    }
                    
                    // Restore GitHub filters
                    if (search.formData.githubHireable !== undefined) {
                        const githubHireable = document.getElementById('githubHireable');
                        if (githubHireable) githubHireable.checked = search.formData.githubHireable;
                    }
                    if (search.formData.githubActiveContributor !== undefined) {
                        const githubActiveContributor = document.getElementById('githubActiveContributor');
                        if (githubActiveContributor) githubActiveContributor.checked = search.formData.githubActiveContributor;
                    }
                    if (search.formData.githubHasWebsite !== undefined) {
                        const githubHasWebsite = document.getElementById('githubHasWebsite');
                        if (githubHasWebsite) githubHasWebsite.checked = search.formData.githubHasWebsite;
                    }
                    
                    // Set job title for email template
                    currentJobTitle = search.formData.jobTitle || '';
                }
                
                // Display the query
                currentQuery = search.query; 
                displayQuery(search.query);
                generateEmailTemplate();
                updateSearchTips();
                
                // Scroll to top of form first, then results
                document.querySelector('.search-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        async function deleteSavedSearch(id) {
            if (!confirm('Delete this saved search?')) return;
            
            try {
                if (searchesDB) {
                    await searchesDB.delete(id);
                    await loadSavedSearches();
                } else {
                    savedSearches = savedSearches.filter(s => s.id !== id && s.id !== parseInt(id));
                    localStorage.setItem('talentScoutSearches', JSON.stringify(savedSearches));
                    renderSavedSearches();
                }
                updateStats();
            } catch (error) {
                console.error('Delete search error:', error);
                alert('Failed to delete search. Please try again.');
            }
        }

        function updateStats() {
            document.getElementById('searchCount').textContent = searchCount;
            document.getElementById('savedCount').textContent = savedSearches.length;
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            localStorage.setItem('talentScoutDarkMode', isDarkMode.toString());
            updateDarkModeIcon();
        }

        function updateDarkModeIcon() {
            const icon = document.getElementById('darkModeIcon');
            icon.innerHTML = isDarkMode ? '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>' : '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>';
        }

        function showFieldHelp(field) {
            const helpTexts = {
                jobTitle: `<strong>Job Title Tips:</strong>
                <ul style="margin: 8px 0 0 16px; line-height: 1.6;">
                    <li>Use the exact title candidates would have (e.g., "Software Engineer" not "coder")</li>
                    <li>Try variations: "Senior Software Engineer", "Staff Engineer"</li>
                    <li>Enable "Include Similar Titles" to auto-expand with related roles</li>
                    <li>Use the AI Suggestions button for related titles</li>
                </ul>`,
                seniority: `<strong>Seniority Level Tips:</strong>
                <ul style="margin: 8px 0 0 16px; line-height: 1.6;">
                    <li>Select multiple levels to broaden your search (e.g., Senior + Staff)</li>
                    <li><strong>Entry/Junior:</strong> 0-2 years experience, new grads</li>
                    <li><strong>Mid-Level:</strong> 2-5 years experience</li>
                    <li><strong>Senior:</strong> 5-8 years experience, independent contributor</li>
                    <li><strong>Staff:</strong> 8+ years, technical leadership</li>
                    <li><strong>Principal:</strong> 10+ years, domain expertise</li>
                    <li><strong>Director+:</strong> Leadership and management roles</li>
                </ul>`
            };
            
            const text = helpTexts[field] || 'Enter the relevant information for better search results.';
            
            // Create a temporary tooltip
            const existingTooltip = document.querySelector('.field-help-tooltip');
            if (existingTooltip) existingTooltip.remove();
            
            const tooltip = document.createElement('div');
            tooltip.className = 'field-help-tooltip';
            tooltip.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                    <span style="font-size: 16px;">💡</span>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; cursor: pointer; font-size: 18px; color: var(--text-secondary);">×</button>
                </div>
                ${text}
            `;
            tooltip.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: var(--surface);
                border: 1px solid var(--border);
                border-radius: 12px;
                padding: 16px 20px;
                max-width: 360px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                z-index: 1001;
                font-size: 13px;
                color: var(--text-primary);
                line-height: 1.5;
            `;
            document.body.appendChild(tooltip);
            
            // Auto-remove after 10 seconds
            setTimeout(() => { if (tooltip.parentElement) tooltip.remove(); }, 10000);
        }

        function toggleCheatsheet() {
            document.getElementById('cheatsheetContent').classList.toggle('open');
            document.getElementById('cheatsheetIcon').classList.toggle('open');
        }

        function toggleDiversitySection() {
            document.getElementById('diversityContent').classList.toggle('open');
            document.getElementById('diversityIcon').classList.toggle('open');
        }

        function toggleProfileSimilarSection() {
            document.getElementById('profileSimilarContent').classList.toggle('open');
            document.getElementById('profileSimilarIcon').classList.toggle('open');
        }

        function toggleCompanySection() {
            document.getElementById('companyContent').classList.toggle('open');
            document.getElementById('companyIcon').classList.toggle('open');
        }
    </script>
        <div class="toast-message" id="toast" aria-live="polite"></div>
    </body>
</html>
